<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.1/firebase-firestore.js"></script>
    <script src="theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@4.6.2/dist/emoji-button.min.js"></script>
    <style>
     :root {
        --primary-color: #6C63FF;
            --secondary-color: #3F3D56;
            --accent-color: #F50057;
            --text-color: #F8F9FA;
            --bg-color: #121212;
            --card-bg: #1E1E1E;
    --glass-bg: rgba(255, 255, 255, 0.1); /* Frosted Glass Effect */
    --hover-bg: rgba(255, 255, 255, 0.1); /* Slightly Darker Hover Background */
    --border-radius: 15px;
    --svg-size: 50px; /* Default size */

}


* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    line-height: 1.6;
    color: var(--text-color);
    background-color: var(--bg-color); /* Solid dark background */
    backdrop-filter: blur(10px); /* Optional: keeps the frosted glass effect */
}


body.night-mode {
    background-color: #333333;
    primary-color: #121212; /* Darker background */
    secondary-color: #1E1E1E; /* Darker grayish background */
    accent-color: #009bf5; /* Adjust if necessary */
    text-color: #e0e0e0; /* Lighter text color for dark mode */
    --bg-color: rgba(18, 18, 18, 0.8); /* Darker background */
    --card-bg: rgba(30, 30, 30, 0.8); /* Darker card background */
    --glass-bg: rgba(18, 18, 18, 0.8); /* Darker frosted glass effect */
    --hover-bg: rgba(30, 30, 30, 0.9); /* Darker hover background */
}
}

.menu-item {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 8px 16px;
    border-radius: 4px;
    transition: background-color 0.3s;
}

.menu-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.theme-icon {
    margin-right: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
}

.theme-icon.active {
    animation: rotate 0.5s ease-in-out;
}

@keyframes rotate {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}



.container {
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 250px;
    min-width: 250px; /* Ensure minimum width is always maintained */
    max-width: 250px; /* Ensure maximum width is always maintained */
    background: inherit;
    padding: 20px;
    display: flex;
    flex-direction: column;
    height: 100%;
    border-radius: var(--border-radius);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
}

.sidebar h1 {
    font-size: 24px;
    margin-bottom: 20px;
}

.sidebar ul {
    list-style: none;
    padding: 0;
}

.sidebar ul li {
    margin-bottom: 20px;
}

.sidebar ul li a {
    text-decoration: none;
    color: var(--secondary-color);
    font-size: 18px;
    transition: color 0.3s ease;
}

.sidebar ul li a:hover {
    color: var(--primary-color);
}

.logo {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    margin-bottom: 30px;
}

.logo svg {
    width: 30px;
    height: 30px;
    margin-right: 10px;
}

.menu-item {
    margin-bottom: 15px;
    color: var(--text-color);
    cursor: pointer;
    transition: color 0.3s ease;
    display: flex;
    align-items: center;
    transition: transform 0.3s ease;
}

.menu-item svg {
    width: 20px;
    height: 20px;
    margin-right: 10px;
}

.menu-item:hover {
    color: var(--primary-color);
    transform: scale(1.1);
}

.upgrade-btn {
    background: linear-gradient(45deg, var(--accent-color), #FF1493);
    color: var(--text-color);
    border: none;
    padding: 10px 20px;
    border-radius: 50px;
    cursor: pointer;
    margin-top: 20px;
    font-weight: 600;
    display: flex;
    align-items: center;
    transition: background-color 0.3s ease, transform 0.3s ease;
    backdrop-filter: blur(10px);
    background-color: rgba(255, 255, 255, 0.1);
}

.upgrade-btn svg {
    width: 20px;
    height: 20px;
    margin-right: 10px;
}

.upgrade-btn:hover {
    transform: scale(1.05);
}

.main-content {
    flex-grow: 1;
    padding: 20px;
    overflow-y: auto;
    background: transparent;
}

.dashboard-header {
    display: flex;
    align-items: center;
    margin-bottom: 30px;
}

.dashboard-header h1 {
    display: flex;
    align-items: center;
    font-size: 2.5rem; /* Adjust as needed */
}

.dashboard-header svg {
    width: var(--svg-size); /* Use the variable for size */
    height: var(--svg-size); /* Maintain aspect ratio */
    margin-left: 8px; /* Adjust space between text and icon */
}


.friends-list, .add-friend, .chat-window {
    margin-bottom: 20px; /* Reduced margin for more compact spacing */
}

.friends-list h2, .chat-window h2 {
    font-size: 24px;
    font-weight: 500;
    margin-bottom: 15px;
}

.unfriend-button {
    padding: 5px;
    background-color: var(--accent-color);
    color: #fff;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s;
    margin-left: 10px; /* Space between name and button */
    display: flex;
    align-items: center;
    justify-content: center;
}

.unfriend-button:hover {
    background-color: #c0392b;
}

.unfriend-button svg {
    width: 20px; /* Adjust size as needed */
    height: 20px; /* Adjust size as needed */
}



#onlineFriends {
    list-style: none;
    padding: 0;
    margin: 0;
}

#onlineFriends li {
    background: var(--glass-bg);
    padding: 10px;
    margin-bottom: 10px;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    justify-content: space-between; /* Ensure the friend name and unfriend button are spaced out */
    align-items: center; /* Align items in the center vertically */
}

#onlineFriends li:hover {
    background: var(--hover-bg);
}

#pinnedFriends {
    list-style: none;
    padding: 0;
    margin: 0;
}

#pinnedFriends .friend-item {
    background: var(--glass-bg);
    padding: 10px;
    margin-bottom: 10px;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    justify-content: space-between; /* Ensure the friend name and buttons are spaced out */
    align-items: center; /* Align items in the center vertically */
}

#pinnedFriends .friend-item:hover {
    background: var(--hover-bg);
}


.friend-name {
    flex-grow: 1; /* Make the friend name take up remaining space */
    margin-right: 10px; /* Add some spacing between the name and the button */
}

.add-friend {
    display: flex;
    align-items: center;
    gap: 10px; /* Improved spacing between input and button */
    margin-bottom: 20px;
}

.add-friend input[type="text"] {
    padding: 10px;
    border: 3px solid var(--primary-color);
    border-radius: var(--border-radius);
    width: calc(100% - 130px); /* Adjusted width to ensure proper spacing */
    box-sizing: border-box;
    font-size: 16px;
    background-color: var(--card-bg);
    color: var(--text-color);
}

.add-friend button {
    background-color: var(--primary-color); /* or any color */
    border: none;
    padding: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 80px; /* Longer width */
    height: 40px; /* Height to keep it balanced */
    border-radius: 20px; /* Creates the squircle effect */
    transition: background-color 0.3s;
}

.add-friend button:hover {
    background-color: #3b7bce;
}

.add-friend button svg {
    width: 30px; /* Adjusted SVG size */
    height: 30px;
    fill: #ffffff; /* Ensures the SVG color is white */
    margin: 0; /* Reset margin if needed */
    transform: translateX(0); /* Adjust the X-axis if needed */
    transform: translateY(0px); /* Adjust the X-axis if needed */

}

.message-container {
    position: relative; /* Allows absolute positioning of child elements */
    padding: 5px;
    margin-bottom: 10px; /* Adjust as needed */
}
        
.add-friend-icon-button {
    padding: 0 !important; /* Ensure no padding is applied */
    background-color: var(--primary-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    position: absolute;
    right: -90px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1;
}

.add-friend-icon-button svg {
    width: 24px;
    height: 24px;
    fill: none; /* Set fill to none */
    stroke: #ffffff; /* Set stroke color to white */
}


/* Ensures the chat window is styled correctly */
.chat-window {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 200px); /* Adjust height as needed */
    background: var(--glass-bg);
    border-radius: var(--border-radius);
    padding: 15px;
    max-height: 600px; /* Limits the height of the chat window */
    position: relative; /* Allows absolute positioning of child elements */
}

/* Style for the no-chat-selected message */
.no-chat-message {
    display: flex;
    justify-content: center;
    align-items: center;
    padding-top: -50px; /* Moves the message slightly upwards */
    height: calc(100vh + 50px); /* Adjust height as needed */
    color: white; /* Change text color to primary */
    font-size: 2.5rem;
    text-align: center;
    background: rgba(255, 255, 255, 0.1); /* Keeps the glass background */
    border-radius: var(--border-radius);
    margin-bottom: 15px;
    margin-top: -25px;
}

/* SVG size and color */
.no-chat-message .chat-svg {
    width: 2.5rem; /* Same size as the text */
    height: 2.5rem;
    margin-right: 10px;
    fill: white;
}

/* Style for the no-chat-selected message */
.no-chat-message {
    display: flex;
    flex-direction: column; /* Make the content stack vertically */
    justify-content: center;
    align-items: center;
    padding-top: -50px;
    height: calc(100vh + 50px); /* Adjust height as needed */
    color: white; /* Change text color to primary */
    font-size: 2.5rem;
    text-align: center;
    background: rgba(255, 255, 255, 0.1); /* Keeps the glass background */
    border-radius: var(--border-radius);
    margin-bottom: 15px;
    margin-top: -25px;
}

/* SVG size and color */
.no-chat-message .chat-svg {
    width: 2.5rem; /* Same size as the text */
    height: 2.5rem;
    margin-right: 900px;
    margin-bottom: -50px;
    fill: white;
}

/* Need help section */
.need-help {
    display: flex;
    align-items: center;
    margin-top: 5px;
    color: var(--primary-color);
    font-size: 1.2rem;
    cursor: pointer; /* Pointer for the whole section */
    transition: color 0.3s ease, transform 0.3s ease; /* Smooth transition for text and icon */
}

/* SVG for the help icon */
.need-help .help-svg {
    width: 1.5rem;
    height: 1.5rem;
    margin-right: 5px;
    stroke: var(--primary-color);
    transition: stroke 0.3s ease, transform 0.3s ease; /* Smooth transition */
}

/* Hover effect for the whole Need help section */
.need-help:hover {
    color: var(--primary-color); /* Change text color to the accent color */
    transform: scale(1.1); /* Slightly enlarge the icon on hover */
}

.need-help:hover .help-svg {
    stroke: var(--primary-color); /* Change SVG color to the accent color */
    transform: scale(1.1); /* Slightly enlarge the icon on hover */
}

#chatMessages {
    flex: 1;
    overflow-y: auto;
    padding-right: 10px;
    margin-bottom: 15px;
    /* Provides the main container for chat messages with scrolling enabled */
}

#chatMessages .message {
    max-width: 70%;
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    clear: both;
    position: relative; /* Allows positioning of the reaction relative to the message */
    /* Styles for individual message bubbles, including padding, border radius, and shadows */
}

#chatMessages .message.sent {
    background: var(--primary-color);
    color: #fff;
    align-self: flex-end;
    float: right;
    text-align: right;
    border-top-right-radius: 0;
    /* Styles for messages sent by the user, including background color and text alignment */
}

#chatMessages .message.received {
    background: var(--accent-color);
    color: var(--text-color);
    align-self: flex-start;
    float: left;
    text-align: left;
    border-top-left-radius: 0;
    /* Styles for messages received from others, including background color and text alignment */
}

/* Container for the reply count and text */
.message-container-2 {
    position: relative; /* Allows positioning of child elements */
    padding: 5px;
    margin-bottom: 10px; /* Adjust as needed */
}

/* Reply count styling */
.reply-count {
    display: inline; /* Ensure text is displayed inline */
    font-size: 12px;
    color: #fff; /* Make the text color white */
    text-align: center; /* Center text within the container */
    margin-top: 5px; /* Space from the message bubble */
    position: absolute; /* Position it absolutely relative to the container */
    left: 0; /* Align to the left */
    bottom: -30px; /* Position it below the message bubble */
    width: 100%; /* Full width of the container */
    text-align: center; /* Center the text within the width */
    white-space: nowrap; /* Prevent text from wrapping */
}



#chatMessages .message-reaction {
    position: absolute;
    top: -8px; /* Slightly raised above the message bubble */
    right: -10px; /* Positioned on the right side of the message bubble */
    font-size: 18px;
    background-color: var(--primary-color); /* Primary color background */
    color: #fff; /* White color for the reaction icon */
    border-radius: 50%; /* Makes the background a circle */
    padding: 5px; /* Adds padding inside the circle */
    width: 24px; /* Set width for a perfect circle */
    height: 24px; /* Set height for a perfect circle */
    display: flex; /* Align icon inside the circle */
    align-items: center; /* Center the icon vertically */
    justify-content: center; /* Center the icon horizontally */
    /* Styles for the reaction icon, with primary color background and circular shape */
}

/* Input and button container styling */
.chat-input-container {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    position: relative; /* Ensures emoji picker is positioned relative to this container */
}

.chat-input-container input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: var(--border-radius);
    font-size: 16px;
}

.chat-input-container button {
    background-color: var(--primary-color); /* Adjust as needed */
    border: none;
    border-radius: var(--border-radius);
    padding: 8px; /* Adjust padding as needed */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s;
    margin-left: 1px; /* Space between input and button */
    width: 40px; /* Adjust width as needed */
    height: 40px; /* Adjust height as needed */
}

.chat-input-container button:hover {
    background-color: #3b7bce; /* Adjust hover color as needed */
}

.chat-input-container button svg {
    width: 24px; /* Adjust size as needed */
    height: 24px; /* Adjust size as needed */
    stroke: #ffffff; /* Ensures the SVG stroke color is white */
}

#chatInput {
    padding: 10px;
    border: 1px solid var(--secondary-color);
    border-radius: var(--border-radius);
    font-size: 16px;
    flex: 1;
    box-sizing: border-box;
    background-color: var(--card-bg);
    color: var(--text-color);
    margin-right: 10px;
}

.chat-window button {
    padding: 10px;
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
    width: 80px;
}

.chat-window button:hover {
    background-color: #3b7bce;
}

/* Common styles for emojis */
.emoji-list span, .emoji-picker span {
    font-size: 24px; /* Emoji size */
    cursor: pointer; /* Pointer cursor on hover */
    transition: transform 0.3s ease; /* Smooth scaling effect */
    display: inline-block; /* Ensure scaling effect is applied */
    margin: 4px; /* Add margin for spacing between emojis */
}

/* Pop-up effect on hover for both emoji list and picker */
.emoji-list span:hover, .emoji-picker span:hover {
    transform: scale(1.2); /* Scale up on hover */
}

/* Emoji dropdown styling */
.emoji-dropdown {
    background-color: var(--primary-color); /* Background color */
    border: none !important; /* Remove any border */
    padding: 0 !important; /* No padding */
    cursor: pointer !important; /* Pointer cursor */
    border-radius: 50% !important; /* Round shape */
    width: 40px !important; /* Fixed width */
    height: 40px !important; /* Fixed height */
    display: flex !important; /* Flexbox layout */
    align-items: center !important; /* Center vertically */
    justify-content: center !important; /* Center horizontally */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important; /* Optional shadow */
    transition: background-color 0.3s, box-shadow 0.3s !important; /* Smooth transitions */
}

.emoji-dropdown:hover {
    background-color: #3b7bce; /* Change color on hover */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important; /* Enhanced shadow on hover */
}

.emoji-dropdown svg {
    width: 24px; /* SVG size */
    height: 24px;
}

/* Emoji picker styling */
.emoji-picker {
    display: flex;
    flex-wrap: wrap;
    padding: 5px;
    background-color: var(--card-bg); /* Matches the chat input background */
    border: 1px solid var(--secondary-color);
    border-radius: 10px;
    position: absolute;
    top: 100%; /* Position below the emoji dropdown */
    left: 0;
    z-index: 100; /* Ensure it appears above other content */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Optional shadow for visibility */
    max-height: 200px; /* Adjust based on the number of emojis */
    overflow-y: auto; /* Adds scroll if needed */
}

.emoji-picker.hidden {
    display: none;
}

/* Emoji container styling */
#emoji-container {
    display: flex;
    align-items: center;
}

/* Clear emojis button styling */
.clear-emojis {
    background-color: var(--primary-color); /* Matches the emoji dropdown */
    border: none !important; /* Remove any border */
    padding: 0 !important; /* No padding */
    cursor: pointer !important; /* Pointer cursor */
    border-radius: 50% !important; /* Round shape */
    width: 40px !important; /* Fixed width */
    height: 40px !important; /* Fixed height */
    display: flex !important; /* Flexbox layout */
    align-items: center !important; /* Center vertically */
    justify-content: center !important; /* Center horizontally */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important; /* Optional shadow */
    transition: background-color 0.3s, box-shadow 0.3s !important; /* Smooth transitions */
    margin-left: 10px; /* Space between emoji dropdown and clear button */
}

.clear-emojis:hover {
    background-color: #3b7bce; /* Change color on hover */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important; /* Enhanced shadow on hover */
}

.clear-emojis svg {
    width: 24px; /* SVG size to match the emoji dropdown */
    height: 24px;
}

#deleteMessagesButton {
    background-color: var(--accent-color); /* Matches the emoji dropdown and clear button */
    border: none !important; /* Remove any border */
    padding: 0 !important; /* No padding */
    cursor: pointer !important; /* Pointer cursor */
    border-radius: 50% !important; /* Round shape */
    width: 40px !important; /* Fixed width */
    height: 40px !important; /* Fixed height */
    display: flex !important; /* Flexbox layout */
    align-items: center !important; /* Center vertically */
    justify-content: center !important; /* Center horizontally */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important; /* Optional shadow */
    transition: background-color 0.3s, box-shadow 0.3s, transform 0.2s !important; /* Smooth transitions including transform */
    margin-left: 10px; /* Adjust margin if necessary */
}

#deleteMessagesButton:hover {
    background-color: #c0392b; /* Change color on hover */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important; /* Enhanced shadow on hover */
}

#deleteMessagesButton svg {
    width: 24px; /* SVG size to match the clear button */
    height: 24px;
    transition: transform 0.2s; /* Add a hover effect */
}

#deleteMessagesButton:hover svg {
    transform: scale(1.1); /* Slightly enlarge the SVG on hover */
}



#groupList {
    list-style: none;
    padding: 0;
    margin: 0;
}

#groupList .group-item {
    background: var(--glass-bg);
    padding: 10px;
    margin-bottom: 10px;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    justify-content: space-between; /* Ensure the group name and other elements are spaced out */
    align-items: center; /* Align items in the center vertically */
}

#groupList .group-item:hover {
    background: var(--hover-bg);
}


.group-name {
    font-weight: bold;
    /* You can add more styles here if needed */
}

.add-to-group {
    display: flex;
    align-items: center;
    gap: 10px; /* Spacing between input and button */
    margin-bottom: 20px;
}

.add-to-group input[type="text"] {
    padding: 10px;
    border: 3px solid var(--primary-color);
    border-radius: var(--border-radius);
    width: calc(100% - 130px); /* Adjust width for proper spacing */
    box-sizing: border-box;
    font-size: 16px;
    background-color: var(--card-bg);
    color: var(--text-color);
}

.add-to-group-button {
    background-color: var(--primary-color); /* or any color */
    border: none;
    padding: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 80px; /* Longer width */
    height: 40px; /* Height to keep it balanced */
    border-radius: 20px; /* Creates the squircle effect */
    transition: background-color 0.3s;
}

.add-to-group-button:hover {
    background-color: #2980b9; /* Add a hover effect */
}

.add-to-group-button svg {
    width: 64px; /* Adjusted SVG size */
    height: 64px;
    fill: #ffffff; /* Ensures the SVG color is white */
    margin: 0; /* Reset margin if needed */
    transform: translateX(0); /* Adjust the X-axis if needed */
    transform: translateY(7px); /* Adjust the X-axis if needed */

}

.group-item {
    background: var(--glass-bg);
    padding: 10px;
    margin-bottom: 10px;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    justify-content: space-between; /* Space out items in the group item */
    align-items: center; /* Align items in the center vertically */
}

.group-item .buttons {
    display: flex;
    gap: 5px; /* Space between the buttons */
}
        
.group-avatar {
    flex-shrink: 0; /* Prevent the avatar from shrinking */
}

.group-name {
    flex-grow: 1;
    font-size: 16px;
    font-weight: bold;
}

.group-item .edit-button,
.group-item .delete-button {
    padding: 5px 10px;
    color: #fff;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s;
}

.group-item .edit-button {
    background-color: var(--primary-color); /* Background color */
}

.group-item .edit-button:hover {
    background-color: #2980b9;
}

.group-item .delete-button {
    background-color: var(--accent-color); 
}

.group-item .delete-button:hover {
    background-color: #c0392b;
}


/* Additional styles for responsiveness and better integration with the chat window */

@media (max-width: 768px) {
    .group-chats h2 {
        font-size: 20px;
    }

    .add-to-group input[type="text"] {
        width: calc(100% - 110px); /* Adjust input width for smaller screens */
    }

    .add-to-group button {
        font-size: 14px;
        padding: 8px 16px;
    }
}


.create-new {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.item {
    background-color: var(--glass-bg);
    padding: 15px;
    border-radius: var(--border-radius);
    margin-bottom: 10px;
    transition: background-color 0.3s ease, transform 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
    backdrop-filter: blur(10px);
}

.item:hover {
    background-color: var(--hover-bg);
    transform: scale(1.05);
    backdrop-filter: blur(10px);
}

.user-profile {
    display: flex;
    align-items: center;
    margin-top: auto;
    padding-top: 20px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--primary-color);
    margin-right: 10px;
    transition: transform 0.3s ease, background-color 0.3s ease;
}

.user-avatar:hover {
    transform: scale(1.1);
    color: var(--text-color);
}

.account-button {
    background: none;
    border: none;
    color: var(--text-color);
    cursor: pointer;
    display: flex;
    align-items: center;
    padding: 0;
    transition: color 0.3s ease, transform 0.3s ease, background-color 0.3s ease;
}

.account-button:hover {
    transform: scale(1.05);
}

.account-button:focus {
    outline: none;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--accent-color); /* Initial color is accent color */
    margin-right: 10px;
    transition: transform 0.3s ease, background-color 0.3s ease;
}

.user-avatar:hover {
    transform: scale(1.1);
}

/* Existing styles */
.sidebar-toggle {
    display: none;
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: var(--hover-bg);
    color: var(--text-color);
    border: none;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    z-index: 1000;
}

.sidebar-toggle svg {
    width: 24px;
    height: 24px;
}

/* Mobile styles */
@media (max-width: 768px) {
    .sidebar {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        height: 100%;
        width: 250px; /* Adjust width as needed */
        background-color: #333; /* Solid color, adjust as needed */
        color: var(--text-color);
        padding: 20px; /* Adjust padding as needed */
        z-index: 1000;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2); /* Optional shadow for better depth */
        border-radius: 0; /* No rounded corners */
    }
    .sidebar.active {
        display: flex;
    }
    .sidebar-toggle {
        display: block;
    }
    .main-content {
        padding-left: 20px;
        margin-left: 0;
    }
}

/* Animation for SVG */
@keyframes rotateIcon {
    0% {
        transform: rotate(0deg);
    }
    50% {
        transform: rotate(180deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.theme-icon {
    display: inline-block;
    transition: transform 0.5s;
}

.theme-icon svg {
    transition: fill 0.5s;
}

.theme-icon.active svg {
    animation: rotateIcon 0.5s;
}


/* General Modal Styles */
.modal2 {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
}

/* Specific Modal Content Styles */
.modal2 .modal-content {
    background-color: #333; /* Set modal background to gray */
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    width: 80%; /* Could be more or less, depending on screen size */
    border-radius: var(--border-radius);
    position: relative; /* Position relative to align buttons */
}

/* Close Button */
.modal2 .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.modal2 .close:hover,
.modal2 .close:focus {
    color: white;
    text-decoration: none;
}

/* View Members Button */
.view-members-button,
.remove-member-button {
    background-color: var(--primary-color); /* Background color */
    border: none;
    padding: 5px;
    border-radius: 50%;
    cursor: pointer;
    transition: background-color 0.3s;
}

.view-members-button:hover,
.remove-member-button:hover {
    background-color: #2980b9;
}

/* Member Item Styles */
.member-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    border-bottom: 1px solid #ccc;
}

/* SVG Icons for Modal Buttons */
.modal2 .modal-content .view-members-button svg,
.modal2 .modal-content .remove-member-button svg,
.modal2 .modal-content .close svg {
    width: 24px;
    height: 24px;
}

/* Ensure no interference with other modals */
#viewMembersModal .modal-content {
    /* If additional specific styles needed for this modal, add them here */
}

/* Style for the modal buttons */
.modal2 .modal-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 5px;
    color: #fff;
    display: flex;
    align-items: center;
    position: relative; /* Changed from absolute to relative for better alignment */
}

/* Ensure SVG icons are appropriately sized */
.modal2 .modal-btn svg {
    width: 24px;
    height: 24px;
}

/* Modal Styles */
.modal {
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
}

.modal-content {
    background: #333;
    color: #fff;
    padding: 20px;
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 600px;
    position: relative;
}

/* Center the title text and ensure proper alignment */
.modal-header {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 15px;
    position: relative; /* Position relative to align the buttons */
}

/* Center title text */
.modal-title {
    font-size: 18px;
    font-weight: bold;
    margin: 0; /* Remove default margin */
}

/* Style for the modal buttons */
.modal-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 5px;
    color: #fff;
    display: flex;
    align-items: center;
    position: absolute; /* Absolute positioning for proper alignment */
}

#disableModal {
    left: 10px; /* Position disable button on the left */
}

#closeModal {
    right: 10px; /* Position close button on the right */
}

/* Ensure SVG icons are appropriately sized */
.modal-btn svg {
    width: 24px;
    height: 24px;
}

/* Style for the bug list */
.bug-list {
    list-style: disc; /* Restore default bullet points */
    padding-left: 20px; /* Default padding for bullets */
    margin: 0; /* Remove default margin */
    font-weight: bold; /* Make the text bold */
}

.bug-list li {
    margin-bottom: 10px;
    position: relative; /* For positioning the custom bullet */
}

/* Style for the fix item */
.bug-list .fix-item {
    color: green; /* Color the text in green */
    padding-left: 40px; /* Add space for the larger SVG bullet */
    position: relative; /* Ensure proper positioning */
}

/* Add SVG before the fix item */
.bug-list .fix-item::before {
    content: ""; /* Empty content for the pseudo-element */
    position: absolute;
    left: 0; /* Align to the left edge */
    top: 50%; /* Center vertically */
    transform: translateY(-50%); /* Adjust for centering */
    width: 24px; /* Increased width of the SVG */
    height: 24px; /* Increased height of the SVG */
    background: url('data:image/svg+xml,%3Csvg%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20id%3D%22SVGRepo_bgCarrier%22%20stroke-width%3D%220%22%3E%3C%2Fg%3E%3Cg%20id%3D%22SVGRepo_tracerCarrier%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C%2Fg%3E%3Cg%20id%3D%22SVGRepo_iconCarrier%22%3E%20%3Crect%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22white%22%3E%3C%2Frect%3E%20%3Cpath%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%20d%3D%22M9.55879%203.6972C10.7552%202.02216%2013.2447%202.02216%2014.4412%203.6972L14.6317%203.96387C14.8422%204.25867%2015.1958%204.41652%2015.5558%204.37652L16.4048%204.28218C18.3156%204.06988%2019.9301%205.68439%2019.7178%207.59513L19.6235%208.44415C19.5835%208.8042%2019.7413%209.15774%2020.0361%209.36831L20.3028%209.55879C21.9778%2010.7552%2021.9778%2013.2447%2020.3028%2014.4412L20.0361%2014.6317C19.7413%2014.8422%2019.5835%2015.1958%2019.6235%2015.5558L19.7178%2016.4048C19.9301%2018.3156%2018.3156%2019.9301%2016.4048%2019.7178L15.5558%2019.6235C15.1958%2019.5835%2014.8422%2019.7413%2014.6317%2020.0361L14.4412%2020.3028C13.2447%2021.9778%2010.7553%2021.9778%209.55879%2020.3028L9.36831%2020.0361C9.15774%2019.7413%208.8042%2019.5835%208.44414%2019.6235L7.59513%2019.7178C5.68439%2019.9301%204.06988%2018.3156%204.28218%2016.4048L4.37652%2015.5558C4.41652%2015.1958%204.25867%2014.8422%203.96387%2014.6317L3.6972%2014.4412C2.02216%2013.2447%202.02216%2010.7553%203.6972%209.55879L3.96387%209.36831C4.25867%209.15774%204.41652%208.8042%204.37652%208.44414L4.28218%207.59513C4.06988%205.68439%205.68439%204.06988%207.59513%204.28218L8.44415%204.37652C8.8042%204.41652%209.15774%204.25867%209.36831%203.96387L9.55879%203.6972ZM15.7071%209.29289C16.0976%209.68342%2016.0976%2010.3166%2015.7071%2010.7071L11.8882%2014.526C11.3977%2015.0166%2010.6023%2015.0166%2010.1118%2014.526L8.29289%2012.7071C7.90237%2012.3166%207.90237%2011.6834%208.29289%2011.2929C8.68342%2010.9024%209.31658%2010.9024%209.70711%2011.2929L11%2012.5858L14.2929%209.29289C14.6834%208.90237%2015.3166%208.90237%2015.7071%209.29289Z%22%20fill%3D%22%23000000%22%3E%3C%2Fpath%3E%20%3C%2Fg%3E%3C%2Fsvg%3E') no-repeat center center; /* SVG as background */
    background-size: contain; /* Ensure the SVG scales properly */
    background-color: transparent; /* Remove background color */
}




.view-friend-info-button {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--primary-color); /* Background color */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border: none;
    padding: 0;
    margin-left: 10px;
}

.view-friend-info-button svg {
    width: 24px;
    height: 24px;
}

.view-friend-info-button:hover {
    background-color: #3b7bce; /* Change to hover color */
}

/* General Modal Styles */
.modal3 {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
}

/* Specific Modal Content Styles */
.modal3 .modal-content {
    background-color: #333; /* Set modal background to gray */
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    width: 80%; /* Could be more or less, depending on screen size */
    border-radius: var(--border-radius);
    position: relative; /* Position relative to align buttons */
}

/* Close Button */
.modal3 .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.modal3 .close:hover,
.modal3 .close:focus {
    color: white;
    text-decoration: none;
}

/* Input and Button Styling */
.modal3 #editFriendName {
    width: calc(100% - 20px);
    padding: 10px;
    margin: 10px 0;
    border-radius: var(--border-radius);
    border: 1px solid #ccc;
    background-color: #444;
    color: #fff;
}

.modal3 #saveFriendName {
    background-color: var(--accent-color);
    border: none;
    padding: 10px 20px;
    border-radius: var(--border-radius);
    cursor: pointer;
    color: #fff;
    transition: background-color 0.3s;
}

.modal3 #saveFriendName:hover {
    background-color: #2980b9;
}


/* Ensure SVG icons are appropriately sized */
.modal3 .close svg {
    width: 24px;
    height: 24px;
}

.friends-list h2 {
    display: flex;
    align-items: center;
}

#refreshButton, #refreshPinnedButton {
    background-color: transparent;
    border: none;
    padding: 0;
    margin-left: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease-in-out;
}

#refreshButton svg, #refreshPinnedButton svg {
    width: 24px;
    height: 24px;
}

#refreshButton:active, #refreshPinnedButton:active {
    transform: scale(1.2);
}

#refreshButton:active svg path, #refreshPinnedButton:active svg path {
    stroke: #ffffff;
}

#refreshButton:hover, #refreshPinnedButton:hover {
    background-color: transparent;
}

#hideButton {
    background-color: transparent;
    border: none;
    padding: 0;
    margin-left: 1px; /* Reduced to make it closer */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease-in-out;
    color: #ff0000;
}

#hideButton svg {
    width: 42px;  /* Reduced size for better alignment */
    height: 42px; /* Reduced size for better alignment */
}

#hideButton:active {
    transform: scale(1.2);
}

#hideButton:active svg path {
    stroke: #ff0000;
}

#hideButton:hover {
    background-color: transparent;
}

#hideButton2 {
    background-color: transparent;
    border: none;
    padding: 0;
    margin-left: 1px; /* Reduced to make it closer */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease-in-out;
    color: #ff0000;
}

#hideButton2 svg {
    width: 42px;  /* Reduced size for better alignment */
    height: 42px; /* Reduced size for better alignment */
}

#hideButton2:active {
    transform: scale(1.2);
}

#hideButton2:active svg path {
    stroke: #ff0000;
}

#hideButton2:hover {
    background-color: transparent;
}

        
.message-options {
    display: flex;
    justify-content: space-around;
    margin-top: 5px;
}

.reaction-button, .remove-reaction-button, .reply-option {
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 16px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 5px;
    cursor: pointer;
}

.reaction-button:hover, .remove-reaction-button:hover, .reply-option:hover {
    background-color: var(--accent-color);
}


.reaction-current-user {
    background-color: var(--accent-color); /* Accent color */
}


/* The Modal (background) */
.modal4 {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; /* Enable scroll if needed */
    background-color: var(--card-bg); /* Black with opacity */
}

/* The Modal (background) */
.modal4 {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; /* Enable scroll if needed */
    background-color: var(--glass-bg); /* Black with opacity */
}

/* Modal Content */
.modal4-content {
    background-color: var(--card-bg);
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: none;
    border-radius: 20px; /* Rounded corners for the modal */
    width: 40%; /* Could be more or less, depending on screen size */
    position: relative;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); /* Subtle shadow for depth */
}

/* Remove Close Button */
.modal4-close {
    display: none;
}

/* Text Area and Button */
#replyInput {
    width: 100%;
    height: 100px;
    margin-top: 10px;
    padding: 10px;
    font-size: 14px;
    border-radius: 10px;
    border: 1px solid #ccc;
}

/* Send Reply Button as a Squricle */
#sendReplyButton {
    background-color: var(--primary-color);
    color: white;
    padding: 15px;
    border: none;
    border-radius: 20px; /* Rounded corners (squricle) */
    cursor: pointer;
    margin-top: 10px;
    width: 100%;
    font-size: 16px;
}

#sendReplyButton:hover {
    background-color: #3b7bce;
}

.scrollable-content {
    overflow: auto; /* Ensure content is still scrollable */
}

/* WebKit Browsers */
.scrollable-content::-webkit-scrollbar {
    display: none; /* Hide scrollbar */
}

/* Firefox */
.scrollable-content {
    scrollbar-width: none; /* Hide scrollbar in Firefox 64+ */
    -ms-overflow-style: none; /* Hide scrollbar in IE 10+ and Edge */
}

/* Internet Explorer and Edge */
.scrollable-content {
    -ms-overflow-style: none; /* Hide scrollbar in IE 10+ and Edge */
}

.friend-item {
    display: flex;
    align-items: center;
}

.friend-item .status-icon {
    margin-right: 8px; /* Space between the icon and the display name */
    width: 24px;
    height: 24px;
}

.friend-item .status-icon.online {
    fill: green;
}

.friend-item .status-icon.offline {
    fill: red;
}

.friend-name {
    font-size: 16px;
}

.dev-tag {
    background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
    color: #ffffff;
    padding: 2px 4px;
    font-size: 0.75em;
    border-radius: 3px;
    margin-left: 5px;
}

.basic-tag {
    background: var(--primary-color);
    color: #ffffff;
    padding: 2px 4px;
    font-size: 0.75em;
    border-radius: 3px;
    margin-left: 5px;
    font-weight: 600; /* Semi-bold */
}


    #defaultGroupAvatar {
        background-color: var(--accent-color); /* Accent color background */
        border-radius: 50%; /* Circular style */
        padding: 4px; /* Padding to create a circle around the SVG */
        width: 60px; /* Adjust width for a larger circle */
        height: 60px; /* Adjust height to match the width */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #defaultGroupAvatar svg {
        width: 40px; /* Size of the SVG inside the circle */
        height: 40px;
    }


/* Avatar container styling */
.avatar-container {
    display: flex;
    flex-direction: column; /* Stack profile picture and button vertically */
    align-items: center; /* Center horizontally */
    margin-top: 10px; /* Reduced space above the avatar container */
    margin-bottom: 10px; /* Reduced space below the avatar container */
}

/* Profile picture styling */
.avatar-container .profile-picture {
    width: 80px; /* Smaller size for the profile picture */
    height: 80px; /* Smaller size for the profile picture */
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px; /* Space between image and button */
}

/* Edit image button styling */
.avatar-container .edit-image-button {
    padding: 8px 16px; /* Adjust padding to match smaller profile picture */
    border: none;
    border-radius: 20px; /* More circular shape */
    background-color: var(--accent-color); /* Initial color for button */
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

/* Hover effect for edit image button */
.avatar-container .edit-image-button:hover {
    background-color: #2980b9; /* Hover effect */
}

/* Modal background overlay */
#modal7 {
    position: fixed; /* Fixed position to stay in place when scrolling */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
    display: flex;
    justify-content: center; /* Center horizontally */
    align-items: center; /* Center vertically */
    z-index: 1000; /* Ensure it appears above other content */
    overflow: auto; /* Ensure content doesn't overflow */
}

/* Modal content for modal7 */
#modal7 .modal-content {
    background: var(--card-bg); /* Background color of the card */
    padding: 20px;
    border-radius: 10px;
    width: 400px;
    max-width: 100%;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Optional: add a shadow for better visibility */
    display: flex;
    flex-direction: column; /* Stack content vertically */
}

/* Modal body image for modal7 */
#modal7 .modal-body img {
    max-width: 50%; /* Set a maximum width for the image */
    max-height: 300px; /* Set a maximum height for the image */
    object-fit: cover; /* Ensure the image covers the area without distortion */
    display: block; /* Ensure the image is a block element for proper margin/padding */
    margin: 0 auto; /* Center the image horizontally if it is smaller */
}


/* Profile picture styling for modal7 */
#modal7 .profile-picture {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
}

/* Modal footer for modal7 */
#modal7 .modal-footer {
    display: flex;
    justify-content: space-between; /* Ensures buttons are placed at the two ends */
    padding-top: 20px;
}

/* Done button styling for modal7 */
#modal7 .done-button {
    padding: 10px 20px;
    border: none;
    border-radius: 20px; /* More circular shape */
    background-color: var(--primary-color); /* Initial color for buttons */
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
}
    
#modal7 .cancel-button {
    padding: 10px 20px;
    border: none;
    border-radius: 20px; /* More circular shape */
    background-color: var(--accent-color); /* Initial color for buttons */
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

/* Hover effect for done button */
#modal7 .done-button:hover {
    background-color: #2980b9; /* Add a hover effect */
}

/* Cancel button styling for modal7 */
#modal7 .cancel-button {
    background-color: var(--accent-color); /* Initial color for Cancel button */
}

/* Hover effect for cancel button */
#modal7 .cancel-button:hover {
    background-color: var(--danger-hover-color, #c9302c); /* Custom hover color for Cancel button */
}

/* Text input styling for group name */
#modal7 #groupNameInput {
    width: calc(100% - 22px); /* Full width minus padding */
    padding: 10px;
    margin-top: 10px;
    border: 1px solid #ddd; /* Light border for the input box */
    border-radius: 5px; /* Rounded corners */
    font-size: 1rem; /* Font size for better readability */
    box-sizing: border-box; /* Ensure padding and border are included in the width */
}

/* Edit group image button styling */
#modal7 #editGroupImageBtn {
    margin-top: 10px; /* Reduced space above the button */
    padding: 8px 16px; /* Adjust padding to match smaller profile picture */
    border: none;
    border-radius: 20px; /* More circular shape */
    background-color: var(--primary-color); /* Initial color for button */
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

/* Hover effect for edit group image button */
#modal7 #editGroupImageBtn:hover {
    background-color: #2980b9; /* Add a hover effect */
}

/* Hide scrollbars but keep scrolling functional */
.modal9 {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 999; /* On top of other content */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
    overflow: hidden; /* Hide scrollbars */
}

/* Center modal content and handle overflow */
.modal9-content {
    background-color: var(--card-bg); /* Background color for modal */
    margin: 5% auto; /* Centered vertically and horizontally */
    padding: 20px;
    border-radius: var(--border-radius);
    width: 60%; /* Adjust as needed */
    height: 80%; /* Adjust as needed */
    overflow: auto; /* Allow scrolling if needed */
    display: flex;
    flex-direction: column; /* Stack content vertically */
    align-items: center; /* Center content horizontally */
}

/* Hide scrollbars but keep scrolling functional */
.modal9-content::-webkit-scrollbar {
    display: none; /* Hides the scrollbar in WebKit browsers (Chrome, Safari) */
}

.modal9-content {
    -ms-overflow-style: none;  /* Hides scrollbar in IE and Edge */
    scrollbar-width: none;  /* Hides scrollbar in Firefox */
}

/* Close button */
.close {
    color: var(--primary-color);
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    margin-left: auto; /* Push button to the right */
    margin-top: -10px;
}


.close:hover,
.close:focus {
    color: var(--accent-color);
}

/* Video section styles */
.video-section {
    margin-bottom: 20px; /* Space between sections */
    flex: 1; /* Allow sections to grow and fill the available space */
    width: 100%; /* Make sections take full width */
    text-align: left;
}

.video-section h2 {
    color: var(--primary-color);
    font-weight: bold; /* Make headers bold */
    margin-bottom: auto;
}

.video-section video {
    width: 100%; /* Make videos responsive */
    height: auto; /* Maintain aspect ratio */
    display: block;
    margin-bottom: 10px;
}

.video-section p {
    font-size: 1rem;
    color: var(--text-color);
}


.modal9-content::-webkit-scrollbar {
    display: none;
}

.modal9-content {
    -ms-overflow-style: none;
}

.modal9-content {
    scrollbar-width: none;
}

/* Hide scrollbars for all browsers */
* {
    scrollbar-width: none; /* For Firefox */
    -ms-overflow-style: none; /* For Internet Explorer and Edge */
}

*::-webkit-scrollbar {
    display: none; /* For Chrome, Safari, and Opera */
}


.latest-message {
    background-color: var(--primary-color); /* Use the primary color */
    color: var(--text-color); /* Ensure the text is readable */
    padding: 4px 8px;
    border-radius: 12px;
    text-align: center;
    max-width: 200px; /* Adjust this to prevent overflow */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
    margin-left: -50px; /* Adjust this value to move it left */
}





        
    </style>
</head>
<body>
    <button class="sidebar-toggle">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>
    <div class="container">
        <div class="sidebar">
            <div class="logo" onclick="window.location.href='index.html'">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
  <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
  <g id="SVGRepo_iconCarrier"> 
    <path d="M12.37 8.87988H17.62" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> 
    <path d="M6.38 8.87988L7.13 9.62988L9.38 7.37988" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> 
    <path d="M12.37 15.8799H17.62" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> 
    <path d="M6.38 15.8799L7.13 16.6299L9.38 14.3799" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> 
    <path d="M9 22H15C20 22 22 20 22 15V9C22 4 20 2 15 2H9C4 2 2 4 2 9V15C2 20 4 22 9 22Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> 
  </g>
</svg>
                TaskMaster AI
            </div>
             <div class="menu-item" onclick="window.location.href='dashboard.html'">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Dashboard
            </div>
             <div class="menu-item" onclick="window.location.href='account.html'">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M15 12C15 13.6569 13.6569 15 12 15C10.3431 15 9 13.6569 9 12C9 10.3431 10.3431 9 12 9C13.6569 9 15 10.3431 15 12Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12.9046 3.06005C12.6988 3 12.4659 3 12 3C11.5341 3 11.3012 3 11.0954 3.06005C10.7942 3.14794 10.5281 3.32808 10.3346 3.57511C10.2024 3.74388 10.1159 3.96016 9.94291 4.39272C9.69419 5.01452 9.00393 5.33471 8.36857 5.123L7.79779 4.93281C7.3929 4.79785 7.19045 4.73036 6.99196 4.7188C6.70039 4.70181 6.4102 4.77032 6.15701 4.9159C5.98465 5.01501 5.83376 5.16591 5.53197 5.4677C5.21122 5.78845 5.05084 5.94882 4.94896 6.13189C4.79927 6.40084 4.73595 6.70934 4.76759 7.01551C4.78912 7.2239 4.87335 7.43449 5.04182 7.85566C5.30565 8.51523 5.05184 9.26878 4.44272 9.63433L4.16521 9.80087C3.74031 10.0558 3.52786 10.1833 3.37354 10.3588C3.23698 10.5141 3.13401 10.696 3.07109 10.893C3 11.1156 3 11.3658 3 11.8663C3 12.4589 3 12.7551 3.09462 13.0088C3.17823 13.2329 3.31422 13.4337 3.49124 13.5946C3.69158 13.7766 3.96395 13.8856 4.50866 14.1035C5.06534 14.3261 5.35196 14.9441 5.16236 15.5129L4.94721 16.1584C4.79819 16.6054 4.72367 16.829 4.7169 17.0486C4.70875 17.3127 4.77049 17.5742 4.89587 17.8067C5.00015 18.0002 5.16678 18.1668 5.5 18.5C5.83323 18.8332 5.99985 18.9998 6.19325 19.1041C6.4258 19.2295 6.68733 19.2913 6.9514 19.2831C7.17102 19.2763 7.39456 19.2018 7.84164 19.0528L8.36862 18.8771C9.00393 18.6654 9.6942 18.9855 9.94291 19.6073C10.1159 20.0398 10.2024 20.2561 10.3346 20.4249C10.5281 20.6719 10.7942 20.8521 11.0954 20.94C11.3012 21 11.5341 21 12 21C12.4659 21 12.6988 21 12.9046 20.94C13.2058 20.8521 13.4719 20.6719 13.6654 20.4249C13.7976 20.2561 13.8841 20.0398 14.0571 19.6073C14.3058 18.9855 14.9961 18.6654 15.6313 18.8773L16.1579 19.0529C16.605 19.2019 16.8286 19.2764 17.0482 19.2832C17.3123 19.2913 17.5738 19.2296 17.8063 19.1042C17.9997 18.9999 18.1664 18.8333 18.4996 18.5001C18.8328 18.1669 18.9994 18.0002 19.1037 17.8068C19.2291 17.5743 19.2908 17.3127 19.2827 17.0487C19.2759 16.8291 19.2014 16.6055 19.0524 16.1584L18.8374 15.5134C18.6477 14.9444 18.9344 14.3262 19.4913 14.1035C20.036 13.8856 20.3084 13.7766 20.5088 13.5946C20.6858 13.4337 20.8218 13.2329 20.9054 13.0088C21 12.7551 21 12.4589 21 11.8663C21 11.3658 21 11.1156 20.9289 10.893C20.866 10.696 20.763 10.5141 20.6265 10.3588C20.4721 10.1833 20.2597 10.0558 19.8348 9.80087L19.5569 9.63416C18.9478 9.26867 18.6939 8.51514 18.9578 7.85558C19.1262 7.43443 19.2105 7.22383 19.232 7.01543C19.2636 6.70926 19.2003 6.40077 19.0506 6.13181C18.9487 5.94875 18.7884 5.78837 18.4676 5.46762C18.1658 5.16584 18.0149 5.01494 17.8426 4.91583C17.5894 4.77024 17.2992 4.70174 17.0076 4.71872C16.8091 4.73029 16.6067 4.79777 16.2018 4.93273L15.6314 5.12287C14.9961 5.33464 14.3058 5.0145 14.0571 4.39272C13.8841 3.96016 13.7976 3.74388 13.6654 3.57511C13.4719 3.32808 13.2058 3.14794 12.9046 3.06005Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                Settings
            </div>
            <div class="menu-item toggle-night-mode" onclick="toggleNightMode()">
                <div class="theme-icon">
                    <svg id="theme-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                </div>
                Theme
            </div>
             <div class="menu-item" onclick="window.location.href='notes.html'">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M10 12H14M12 10V14M19.9592 15H16.6C16.0399 15 15.7599 15 15.546 15.109C15.3578 15.2049 15.2049 15.3578 15.109 15.546C15 15.7599 15 16.0399 15 16.6V19.9592M20 14.1031V7.2C20 6.07989 20 5.51984 19.782 5.09202C19.5903 4.71569 19.2843 4.40973 18.908 4.21799C18.4802 4 17.9201 4 16.8 4H7.2C6.0799 4 5.51984 4 5.09202 4.21799C4.71569 4.40973 4.40973 4.71569 4.21799 5.09202C4 5.51984 4 6.0799 4 7.2V16.8C4 17.9201 4 18.4802 4.21799 18.908C4.40973 19.2843 4.71569 19.5903 5.09202 19.782C5.51984 20 6.0799 20 7.2 20H14.1031C14.5923 20 14.8369 20 15.067 19.9447C15.2711 19.8957 15.4662 19.8149 15.6451 19.7053C15.847 19.5816 16.0199 19.4086 16.3658 19.0627L19.0627 16.3658C19.4086 16.0199 19.5816 15.847 19.7053 15.6451C19.8149 15.4662 19.8957 15.2711 19.9447 15.067C20 14.8369 20 14.5923 20 14.1031Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                Notes
            </div>
            <div class="menu-item" onclick="window.location.href='calendar.html'">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M3 9H21M7 3V5M17 3V5M6 12H8M11 12H13M16 12H18M6 15H8M11 15H13M16 15H18M6 18H8M11 18H13M16 18H18M6.2 21H17.8C18.9201 21 19.4802 21 19.908 20.782C20.2843 20.5903 20.5903 20.2843 20.782 19.908C21 19.4802 21 18.9201 21 17.8V8.2C21 7.07989 21 6.51984 20.782 6.09202C20.5903 5.71569 20.2843 5.40973 19.908 5.21799C19.4802 5 18.9201 5 17.8 5H6.2C5.0799 5 4.51984 5 4.09202 5.21799C3.71569 5.40973 3.40973 5.71569 3.21799 6.09202C3 6.51984 3 7.07989 3 8.2V17.8C3 18.9201 3 19.4802 3.21799 19.908C3.40973 20.2843 3.71569 20.5903 4.09202 20.782C4.51984 21 5.07989 21 6.2 21Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round"></path> </g></svg>
                Calendar
            </div>
            <div class="menu-item" onclick="window.location.href='academics.html'">
                <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" stroke-width="4.672" stroke="#ffffff" fill="none"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><circle cx="29.22" cy="16.28" r="11.14"></circle><path d="M41.32,35.69c-2.69-1.95-8.34-3.25-12.1-3.25h0A22.55,22.55,0,0,0,6.67,55h29.9"></path><circle cx="45.38" cy="46.92" r="11.94"></circle><line x1="45.98" y1="39.8" x2="45.98" y2="53.8"></line><line x1="38.98" y1="46.8" x2="52.98" y2="46.8"></line></g></svg>
                Friends
            </div>
            <div class="menu-item" onclick="window.location.href='community.html'">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 164 164" x="0px" y="0px" fill="#ffffff" width="74" height="74" style="margin-right: 8px;">
    <g transform="scale(2.75)"> <!-- Scaling the actual SVG content -->
        <path d="M11.63,37.02A20.1565,20.1565,0,0,1,11.04,32.82H22.59A56.55887,56.55887,0,0,0,22.97,38.8,25.89175,25.89175,0,0,0,18.58,40.53,6.1486,6.1486,0,0,0,11.63,37.02ZM19.11,42.45a5.88844,5.88844,0,0,1-.3,2.67A9.91165,9.91165,0,0,1,22.5,50.7a20.04038,20.04038,0,0,0,4.83,1.75c-1.85-2.58-3.3-6.68005-4.09-11.67A22.112,22.112,0,0,0,19.11,42.45Zm8.22-30.9a20.9854,20.9854,0,0,0-11.78,7.44,18.31507,18.31507,0,0,0,7.69,4.23C24.03,18.23,25.48,14.13,27.33,11.55ZM22.97,25.2a21.16733,21.16733,0,0,1-8.56-4.62A20.757,20.757,0,0,0,11.06,30.82H22.59C22.63,28.86,22.76,26.98,22.97,25.2ZM32,24.45a31.61622,31.61622,0,0,0,6.82-.73c-2.701-17.05245-10.94371-17.03506-13.64,0A31.61622,31.61622,0,0,0,32,24.45Zm9.28-1.39a9.848,9.848,0,0,1,3.91-6.95,5.00891,5.00891,0,0,1-.17-.55,20.71311,20.71311,0,0,0-8.35-4.01c1.85,2.58,3.3,6.68,4.09,11.67C40.94,23.17,41.11,23.11,41.28,23.06Zm-2.2,2.64a34.10132,34.10132,0,0,1-14.16,0c-.18,1.61-.29,3.32-.33,5.12H39.41C39.37,29.02,39.26,27.31,39.08,25.7Zm2.33,5.12H52.94A20.53863,20.53863,0,0,0,52.37,26.96H44.24A3.00339,3.00339,0,0,1,41.45,25.07c-.14.04-.28.09-.42.13C41.24,26.98,41.37,28.86,41.41,30.82ZM24.92,38.3a34.10132,34.10132,0,0,1,14.16,0c.19-1.71.31-3.55.33-5.48H24.59C24.61,34.75,24.73,36.59,24.92,38.3ZM32,39.55a31.62006,31.62006,0,0,0-6.82.73c2.70094,17.05249,10.94373,17.0351,13.64,0A31.62006,31.62006,0,0,0,32,39.55Zm4.67,12.9a20.9854,20.9854,0,0,0,11.78-7.44,18.31512,18.31512,0,0,0-7.69-4.23C39.97,45.77,38.52,49.87,36.67,52.45ZM41.03,38.8a21.16726,21.16726,0,0,1,8.56,4.62,20.8109,20.8109,0,0,0,3.37-10.6H41.41A56.55887,56.55887,0,0,1,41.03,38.8ZM58.77,23.96a1.00291,1.00291,0,0,1-1,1H52.04c-2.17352.001-5.73834-.01069-7.8,0a.99286.99286,0,0,1-.89015-.56c-.52331-3.122,1.75543-6.38334,4.60017-7.57C45.431,14.26381,47.58273,9.77221,51,9.89A4.17084,4.17084,0,0,1,54.07,16.83,7.77635,7.77635,0,0,1,58.77,23.96ZM50.99991,16.2c2.95419.00217,2.72218-4.65995-.24991-4.29A2.15468,2.15468,0,0,0,50.99991,16.2ZM56.69,22.96c-1.14169-6.4101-10.38395-6.08342-11.36,0Zm-35.92,30a1.00291,1.00291,0,0,1-1,1c-1.58735.00006-6.43744,0-7.94,0H6.24a1.00291,1.00291,0,0,1-1-1,7.76949,7.76949,0,0,1,4.71-7.13,4.17685,4.17685,0,0,1,2.24992-6.87986c3.75273-.81649,6.53182,3.9936,3.95009,6.77988C18.77011,47.238,20.85191,49.76531,20.77,52.96ZM13,45.2c2.76954-.0062,2.8617-4.28654,0-4.31A2.15516,2.15516,0,0,0,13,45.2Zm5.69,6.76c-1.15159-6.29025-10.24749-6.25506-11.36,0Z"></path>
    </g>
</svg>

                Community
            </div>
            <div class="menu-item" onclick="window.location.href='features.html'">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                  </svg>
                Distraction Control
            </div>
            <div class="menu-item" onclick="window.location.href='workschedule.html'">
    <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" stroke="none">
        <g id="SVGRepo_bgCarrier" stroke-width="0" fill="none"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier" fill="#ffffff">
            <title>ai</title>
            <g id="Layer_2" data-name="Layer 2">
                <g id="invisible_box" data-name="invisible box">
                    <rect width="48" height="48" fill="none"></rect>
                </g>
                <g id="Q3_icons" data-name="Q3 icons">
                    <g>
                        <path d="M45.6,18.7,41,14.9V7.5a1,1,0,0,0-.6-.9L30.5,2.1h-.4l-.6.2L24,5.9,18.5,2.2,17.9,2h-.4L7.6,6.6a1,1,0,0,0-.6.9v7.4L2.4,18.7a.8.8,0,0,0-.4.8v9H2a.8.8,0,0,0,.4.8L7,33.1v7.4a1,1,0,0,0,.6.9l9.9,4.5h.4l.6-.2L24,42.1l5.5,3.7.6.2h.4l9.9-4.5a1,1,0,0,0,.6-.9V33.1l4.6-3.8a.8.8,0,0,0,.4-.7V19.4h0A.8.8,0,0,0,45.6,18.7Zm-5.1,6.8H42v1.6l-3.5,2.8-.4.3-.4-.2a1.4,1.4,0,0,0-2,.7,1.5,1.5,0,0,0,.6,2l.7.3h0v5.4l-6.6,3.1-4.2-2.8-.7-.5V25.5H27a1.5,1.5,0,0,0,0-3H25.5V9.7l.7-.5,4.2-2.8L37,9.5v5.4h0l-.7.3a1.5,1.5,0,0,0-.6,2,1.4,1.4,0,0,0,1.3.9l.7-.2.4-.2.4.3L42,20.9v1.6H40.5a1.5,1.5,0,0,0,0,3ZM21,25.5h1.5V38.3l-.7.5-4.2,2.8L11,38.5V33.1h0l.7-.3a1.5,1.5,0,0,0,.6-2,1.4,1.4,0,0,0-2-.7l-.4.2-.4-.3L6,27.1V25.5H7.5a1.5,1.5,0,0,0,0-3H6V20.9l3.5-2.8.4-.3.4.2.7.2a1.4,1.4,0,0,0,1.3-.9,1.5,1.5,0,0,0-.6-2L11,15h0V9.5l6.6-3.1,4.2,2.8.7.5V22.5H21a1.5,1.5,0,0,0,0,3Z"></path>
                        <path d="M13.9,9.9a1.8,1.8,0,0,0,0,2.2l2.6,2.5v2.8l-4,4v5.2l4,4v2.8l-2.6,2.5a1.8,1.8,0,0,0,0,2.2,1.5,1.5,0,0,0,1.1.4,1.5,1.5,0,0,0,1.1-.4l3.4-3.5V29.4l-4-4V22.6l4-4V13.4L16.1,9.9A1.8,1.8,0,0,0,13.9,9.9Z"></path>
                        <path d="M31.5,14.6l2.6-2.5a1.8,1.8,0,0,0,0-2.2,1.8,1.8,0,0,0-2.2,0l-3.4,3.5v5.2l4,4v2.8l-4,4v5.2l3.4,3.5a1.7,1.7,0,0,0,2.2,0,1.8,1.8,0,0,0,0-2.2l-2.6-2.5V30.6l4-4V21.4l-4-4Z"></path>
                    </g>
                </g>
            </g>
        </g>
    </svg>
    AI Chat Bot
</div>

            <button class="upgrade-btn" onclick="window.location.href='pricing.html'">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2 8l10 14L22 8l-4-6H6L2 8z"/>
                    <path d="M2 8h20"/>
                    <path d="M12 2v20"/>
                  </svg>
                Upgrade to Premium
            </button>
<div class="user-profile" onclick="window.location.href='account.html'">
    <button class="account-button">
        <div class="user-avatar" id="smallProfilePictureContainer">
            <!-- SVG will be replaced with the profile picture -->
            <svg id="defaultAvatar" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 4C14.21 4 16 5.79 16 8C16 10.21 14.21 12 12 12C9.79 12 8 10.21 8 8C8 5.79 9.79 4 12 4ZM12 20C9.33 20 6.34 18.87 4.63 16.74C5.91 15.43 8.39 14.5 12 14.5C15.61 14.5 18.09 15.43 19.37 16.74C17.66 18.87 14.67 20 12 20Z" fill="currentColor"/>
            </svg>
        </div>
                <div id="username">User Name</div>
                <div class="menu-dots">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M19 13C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11C18.4477 11 18 11.4477 18 12C18 12.5523 18.4477 13 19 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5 13C5.55228 13 6 12.5523 6 12C6 11.4477 5.55228 11 5 11C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>  
<div class="main-content">
    <div class="dashboard-header">
        <h1>
            Friends
            <!-- SVG Icon -->
            <svg xmlns:x="http://ns.adobe.com/Extensibility/1.0/" xmlns:i="http://ns.adobe.com/AdobeIllustrator/10.0/" xmlns:graph="http://ns.adobe.com/Graphs/1.0/" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve" style="width: 1em; height: 1em; vertical-align: middle; margin-left: 5px;">
                <path d="M68,69.4H32c2.2,2.1,3.6,4.8,4.5,7h3.9l1.6,16.1c0,1.7,1.3,3.2,3.1,3.4c1.6,0.2,3.1,0.3,4.8,0.3c1.6,0,3.2-0.1,4.8-0.3     c1.7-0.2,3-1.7,3.1-3.4l1.4-16.1h4.2C64.4,74.2,65.8,71.5,68,69.4z" fill="#FFFFFF"/>
                <path d="M41.8,59.3c0,4.5,3.7,8.2,8.2,8.2c4.5,0,8.2-3.7,8.2-8.2c0-4.5-3.7-8.2-8.2-8.2C45.5,51,41.8,54.7,41.8,59.3z" fill="#FFFFFF"/>
                <path d="M35.1,80.9c-0.1-0.4-0.3-0.8-0.5-1.3c-1.3-3.6-3.7-10.2-9.9-10.2h-9.4c-6.2,0-8.6,6.6-9.9,10.2c-0.2,0.5-0.3,0.9-0.5,1.3     c-0.8,1.9-1.7,5.5-2.3,8.4c-0.4,1.7,0.5,3.4,2.1,4c0,0,0.1,0,0.1,0c2,0.8,4.2-0.4,4.7-2.5c0.6-2.9,1.4-6,1.9-7.3     c0.2-0.4,0.4-0.9,0.6-1.5l0.2,10.4c0,1.7,1.3,3.2,3.1,3.4c1.6,0.2,3.2,0.3,4.8,0.3c1.6,0,3.2-0.1,4.8-0.3c1.7-0.2,3-1.7,3.1-3.4     l0.2-10.4c0.2,0.5,0.4,1.1,0.6,1.5c0.5,1.3,1.3,4.4,1.9,7.3c0.5,2.1,2.7,3.3,4.7,2.5c0,0,0,0,0.1,0c1.6-0.6,2.4-2.3,2.1-4     C36.8,86.4,35.9,82.8,35.1,80.9z" fill="#FFFFFF"/>
                <path d="M20,67.5c4.5,0,8.2-3.7,8.2-8.2c0-4.5-3.7-8.2-8.2-8.2c-4.5,0-8.2,3.7-8.2,8.2C11.8,63.8,15.5,67.5,20,67.5z" fill="#FFFFFF"/>
                <path d="M97.4,89.3c-0.6-2.9-1.5-6.5-2.3-8.4c-0.1-0.4-0.3-0.8-0.5-1.3c-1.3-3.6-3.7-10.2-9.9-10.2h-0.3h-8.9h-0.3     c-6.2,0-8.6,6.6-9.9,10.2c-0.2,0.5-0.3,0.9-0.5,1.3c-0.8,1.9-1.7,5.5-2.3,8.4c-0.4,1.7,0.5,3.4,2.1,4c0,0,0.1,0,0.1,0     c2,0.8,4.2-0.4,4.7-2.5c0.6-2.9,1.4-6,1.9-7.3c0.2-0.4,0.4-0.9,0.6-1.5l0.2,10.4c0,1.7,1.3,3.2,3.1,3.4c1.6,0.2,3.2,0.3,4.8,0.3     c1.6,0,3.2-0.1,4.8-0.3c1.7-0.2,3-1.7,3.1-3.4l0.2-10.4c0.2,0.5,0.4,1.1,0.6,1.5c0.5,1.3,1.3,4.4,1.9,7.3     c0.5,2.1,2.7,3.3,4.7,2.5c0,0,0,0,0.1,0C96.9,92.7,97.8,91,97.4,89.3z" fill="#FFFFFF"/>
                <path d="M80,51c-4.5,0-8.2,3.7-8.2,8.2c0,4.5,3.7,8.2,8.2,8.2c4.5,0,8.2-3.7,8.2-8.2C88.2,54.7,84.5,51,80,51z" fill="#FFFFFF"/>
                <path d="M20.2,37.3H24v7.9c0,1.4,1.6,2,2.6,1.1l9-9h8.8l3.9,8.9c0.6,1.5,2.7,1.5,3.4,0l3.9-8.9h8.8l9,9c1,1,2.6,0.3,2.6-1.1v-7.9     h3.8c3.7,0,6.7-3,6.7-6.7v-20c0-3.7-3-6.7-6.7-6.7H20.2c-3.7,0-6.7,3-6.7,6.7v20C13.5,34.3,16.5,37.3,20.2,37.3z M66.3,15.7     c2.7,0,4.8,2.2,4.8,4.8c0,2.7-2.2,4.8-4.8,4.8c-2.7,0-4.8-2.2-4.8-4.8C61.4,17.9,63.6,15.7,66.3,15.7z M50,15.7     c2.7,0,4.8,2.2,4.8,4.8c0,2.7-2.2,4.8-4.8,4.8c-2.7,0-4.8-2.2-4.8-4.8C45.2,17.9,47.3,15.7,50,15.7z M33.7,15.7     c2.7,0,4.8,2.2,4.8,4.8c0,2.7-2.2,4.8-4.8,4.8c-2.7,0-4.8-2.2-4.8-4.8C28.9,17.9,31.1,15.7,33.7,15.7z" fill="#FFFFFF"/>
            </svg>
        </h1>
    </div>
<div class="add-friend">
    <input type="text" id="friendEmail" placeholder="Enter friend's email">
    <button onclick="addFriend()">
        <svg viewBox="0 -64 640 640" xmlns="http://www.w3.org/2000/svg" fill="#ffffff">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
                <path d="M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path>
            </g>
        </svg>
    </button>
</div>
<div class="group-chats">
    <div class="add-to-group">
        <input type="text" id="groupEmails" placeholder="Enter friends' emails, separated by commas">
        <button onclick="addToGroup()" class="add-to-group-button">
            <svg xmlns="http://www.w3.org/2000/svg" data-name="Layer 1" viewBox="0 0 100 125" x="0px" y="0px" fill="#ffffff">
                <path d="m32.0225989,46.9052016c-2.2088058-2.3237093-5.3751412-3.7792324-8.8862264-3.7792324h-6.0199104c-6.6902396,0-12.1164621,5.2794078-12.1164621,11.7908825v2.451354c0,1.4236119,1.1873758,2.5790766,2.6492889,2.5790766h17.1723748c.2425872-5.3560101,3.0259497-10.0736411,7.2009351-13.0420807Z"/>
                <ellipse cx="20.1268654" cy="32.6188973" rx="8.6428599" ry="8.4079875"/>
                <ellipse cx="76.2191311" cy="32.6188973" rx="8.6428599" ry="8.4079875"/>
                <ellipse cx="48.1729982" cy="28.9672316" rx="12.5627508" ry="12.221391"/>
                <path d="m90.2488603,55.7175141c-2.9106565-2.8988895-6.920904-4.6923047-11.3603741-4.6923047-1.6287941,0-3.1987921.2410676-4.6806156.6879408-1.522969.4645626-2.9459186,1.1407754-4.239548,2.0051432-.3939606.2587571-.7761933.5409702-1.1407754.8349893-3.6926943,2.951841-6.0564972,7.4912527-6.0564972,12.5834794,0,.5350867.023534,1.0642899.0764465,1.581765.0764465.7702708.2057666,1.5170466.3880771,2.2520553,1.7170076,7.0561465,8.0675239,12.2835769,15.6529125,12.2835769,8.8966297,0,16.1115137-7.2090395,16.1115137-16.1173972,0-4.4630431-1.8169492-8.502669-4.7511397-11.419248Zm-5.0745373,13.5831288h-4.121956v4.1278395c0,1.1995714-.9761153,2.1638808-2.1638808,2.1638808-1.1936879,0-2.1639197-.9643094-2.1639197-2.1638808v-4.1278395h-4.1278395c-1.1936879,0-2.1579973-.9643483-2.1579973-2.1638808,0-1.1936879.9643094-2.1580362,2.1579973-2.1580362h4.1278395v-4.1278005c0-.0647185,0-.1235145.0058835-.1823105.0764465-.8820183.6820962-1.6111825,1.499474-1.8699006.2116501-.0646795.4292227-.1058251.6585622-.1058251,1.1230859,0,2.0639003.8643678,2.1521138,1.9757257.011767.058796.011767.1175921.011767.1823105v4.1278005h4.121956c1.1936489,0,2.1638808.9643483,2.1638808,2.1580362,0,1.1995324-.9702318,2.1638808-2.1638808,2.1638808Z"/>
                <path d="m69.3202026,52.4036236c1.4044418-.9384376,2.9493084-1.6725502,4.6027274-2.1768946,1.6087278-.4851744,3.3131892-.7468927,5.0815118-.7468927,4.8197545,0,9.1735048,1.9470485,12.3334502,5.0942529-.1851159-6.35188-5.541126-11.4461329-12.1100331-11.4461329h-6.0199104c-3.5110851,0-6.6774596,1.4555231-8.8862264,3.7791935,2.049172,1.4555231,3.7600234,3.3323592,4.9984804,5.4964738Z"/>
                <path d="m68.0817456,53.310111c-1.2511981-2.2790181-3.0195207-4.2515878-5.1517241-5.7645821-2.9110072-2.0747321-6.4986947-3.3004091-10.3864017-3.3004091h-8.7458017c-9.7288915,0-17.6128969,7.6733294-17.6128969,17.1341126v3.5621274c0,2.0683811,1.7236314,3.7473213,3.8494448,3.7473213h31.555075c-.0574323-.5617767-.0829924-1.1363335-.0829924-1.7172414,0-5.528385,2.5662965-10.456653,6.5752971-13.6613287Z"/>
            </svg>
        </button>
    </div>
<div class="friends-list">
    <h2>
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20" style="margin-right: 8px;">
            <path fill-rule="evenodd" clip-rule="evenodd" 
                d="M17.1218 1.87023C15.7573 0.505682 13.4779 0.76575 12.4558 2.40261L9.61062 6.95916C9.61033 6.95965 9.60913 6.96167 9.6038 6.96549C9.59728 6.97016 9.58336 6.97822 9.56001 6.9848C9.50899 6.99916 9.44234 6.99805 9.38281 6.97599C8.41173 6.61599 6.74483 6.22052 5.01389 6.87251C4.08132 7.22378 3.61596 8.03222 3.56525 8.85243C3.51687 9.63502 3.83293 10.4395 4.41425 11.0208L7.94975 14.5563L1.26973 21.2363C0.879206 21.6269 0.879206 22.26 1.26973 22.6506C1.66025 23.0411 2.29342 23.0411 2.68394 22.6506L9.36397 15.9705L12.8995 19.5061C13.4808 20.0874 14.2853 20.4035 15.0679 20.3551C15.8881 20.3044 16.6966 19.839 17.0478 18.9065C17.6998 17.1755 17.3043 15.5086 16.9444 14.5375C16.9223 14.478 16.9212 14.4114 16.9355 14.3603C16.9421 14.337 16.9502 14.3231 16.9549 14.3165C16.9587 14.3112 16.9606 14.31 16.9611 14.3098L21.5177 11.4645C23.1546 10.4424 23.4147 8.16307 22.0501 6.79853L17.1218 1.87023Z" 
                fill="#ffffff"></path> 
        </svg>
        Pinned
        <button id="refreshPinnedButton">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
                <path d="M4.06189 13C4.02104 12.6724 4 12.3387 4 12C4 7.58172 7.58172 4 12 4C14.5006 4 16.7332 5.14727 18.2002 6.94416M19.9381 11C19.979 11.3276 20 11.6613 20 12C20 16.4183 16.4183 20 12 20C9.61061 20 7.46589 18.9525 6 17.2916M9 17H6V17.2916M18.2002 4V6.94416M18.2002 6.94416V6.99993L15.2002 7M6 20V17.2916" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </h2>

    <!-- Combined pinned section -->
    <div id="pinnedSection">
        <div id="pinnedFriends">
            <!-- Pinned friends will be dynamically added here -->
        </div>

        <div id="pinnedGroups">
            <!-- Pinned groups will be dynamically added here -->
        </div>

<h2>
    <svg fill="#ffffff" viewBox="0 -64 640 640" xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="margin-right: 8px;">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path d="M192 256c61.9 0 112-50.1 112-112S253.9 32 192 32 80 82.1 80 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C51.6 288 0 339.6 0 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zM480 256c53 0 96-43 96-96s-43-96-96-96-96 43-96 96 43 96 96 96zm48 32h-3.8c-13.9 4.8-28.6 8-44.2 8s-30.3-3.2-44.2-8H432c-20.4 0-39.2 5.9-55.7 15.4 24.4 26.3 39.7 61.2 39.7 99.8v38.4c0 2.2-.5 4.3-.6 6.4H592c26.5 0 48-21.5 48-48 0-61.9-50.1-112-112-112z"></path>
        </g>
    </svg>
    All Friends
    <button id="refreshButton">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
            <path d="M4.06189 13C4.02104 12.6724 4 12.3387 4 12C4 7.58172 7.58172 4 12 4C14.5006 4 16.7332 5.14727 18.2002 6.94416M19.9381 11C19.979 11.3276 20 11.6613 20 12C20 16.4183 16.4183 20 12 20C9.61061 20 7.46589 18.9525 6 17.2916M9 17H6V17.2916M18.2002 4V6.94416M18.2002 6.94416V6.99993L15.2002 7M6 20V17.2916" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
    </button>
    <button id="hideButton">
        <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" preserveAspectRatio="xMidYMid meet">
            <g id="SVGRepo_iconCarrier">
                <path fill="white" d="M13.098 8H6.902c-.751 0-1.172.754-.708 1.268L9.292 12.7c.36.399 1.055.399 1.416 0l3.098-3.433C14.27 8.754 13.849 8 13.098 8Z"></path>
            </g>
        </svg>
    </button>
</h2>
<div id="onlineFriends">
    <!-- Online friends will be dynamically added here -->

</div>
    <div class="group-list">
    <h2>
        <svg fill="#ffffff" viewBox="0 -64 640 640" xmlns="http://www.w3.org/2000/svg" width="32" height="32" style="margin-right: 8px;">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
                <path d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"></path>
            </g>
        </svg>
        Your Groups
    <button id="refreshButton">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
            <path d="M4.06189 13C4.02104 12.6724 4 12.3387 4 12C4 7.58172 7.58172 4 12 4C14.5006 4 16.7332 5.14727 18.2002 6.94416M19.9381 11C19.979 11.3276 20 11.6613 20 12C20 16.4183 16.4183 20 12 20C9.61061 20 7.46589 18.9525 6 17.2916M9 17H6V17.2916M18.2002 4V6.94416M18.2002 6.94416V6.99993L15.2002 7M6 20V17.2916" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
    </button>
    <button id="hideButton2">
        <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" preserveAspectRatio="xMidYMid meet">
            <g id="SVGRepo_iconCarrier">
                <path fill="white" d="M13.098 8H6.902c-.751 0-1.172.754-.708 1.268L9.292 12.7c.36.399 1.055.399 1.416 0l3.098-3.433C14.27 8.754 13.849 8 13.098 8Z"></path>
            </g>
        </svg>
    </button>
</h2>
        <div id="groupList">
            <!-- Groups will be dynamically added here -->
        </div>
    </div>
</div>

<div class="scrollable-content">
    <div class="chat-window">
        <h2>
            <div id="avatarContainer" style="display: inline-block; vertical-align: middle;"></div>
            <span id="chatWith"></span>
        </h2>
        <div id="chatMessages">
            <!-- Chat messages will be displayed here -->
        </div>
        <div id="noChatSelected" class="no-chat-message">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="chat-svg">
                <!-- Your existing chat SVG -->
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier"> 
                    <path d="M7 7L5.5 5.5M15 7L16.5 5.5M5.5 16.5L7 15M11 5L11 3M5 11L3 11M17.1603 16.9887L21.0519 15.4659C21.4758 15.3001 21.4756 14.7003 21.0517 14.5346L11.6992 10.8799C11.2933 10.7213 10.8929 11.1217 11.0515 11.5276L14.7062 20.8801C14.8719 21.304 15.4717 21.3042 15.6375 20.8803L17.1603 16.9887Z" 
                          stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> 
                </g>
            </svg>
            <span>Click on a friend or group to start chatting</span>
        
            <!-- New "Need help?" section -->
            <div class="need-help" onclick="showHelpModal()">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="help-svg">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier"> 
                        <path d="M12 17H12.01M12 14C12.8906 12.0938 15 12.2344 15 10C15 8.5 14 7 12 7C10.4521 7 9.50325 7.89844 9.15332 9M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" 
                              stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> 
                    </g>
                </svg>
                <span>Need help?</span>
            </div>
        </div>
        

<!-- Modal 9 structure -->
<div id="helpModal" class="modal9">
    <div class="modal9-content">
        <span class="close" onclick="closeHelpModal()">&times;</span>
        
        <!-- How to send a friend request -->
        <div class="video-section">
            <h2>How to send a friend request</h2>
            <video src="https://firebasestorage.googleapis.com/v0/b/deepworkai-c3419.appspot.com/o/Friend%20Send.mov?alt=media&token=fb42d261-22ac-4d2a-8355-6ee0fb319843" autoplay loop muted></video>
            <p>To send a friend request, enter a registered user's email and click on the add friend button. Please make sure your friend has accepted the request.</p>
        </div>
        
        <!-- How to accept a friend request -->
        <div class="video-section">
            <h2>How to accept a friend request</h2>
            <video src="https://firebasestorage.googleapis.com/v0/b/deepworkai-c3419.appspot.com/o/Friend%20Accept.mov?alt=media&token=72dca3a3-a778-41d9-bf0f-b7fbf552950e" autoplay loop muted></video>
            <p>To accept a friend request, make sure your friend has sent you the request. Once sent, please refresh your page and accept the request.</p>
        </div>
        
        <!-- How to chat with friends & groups -->
        <div class="video-section">
            <h2>How to chat with friends & groups</h2>
            <video src="https://firebasestorage.googleapis.com/v0/b/deepworkai-c3419.appspot.com/o/Friend%20View.mov?alt=media&token=2e0a400b-b9dd-4fa3-9758-e291db9da0dd" autoplay loop muted></video>
            <p>To chat with a friend or group, please click on the name of the group or friend in the appropriate sections.</p>
        </div>
    </div>
</div>


    <div class="chat-input-container">
        <input 
            type="text" 
            id="chatInput" 
            placeholder="Type a message" 
            spellcheck="true" 
            autocomplete="on" 
            aria-label="Chat message input"
        >
        <button onclick="sendMessage(currentGroupId)">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                    <path d="M11.5003 12H5.41872M5.24634 12.7972L4.24158 15.7986C3.69128 17.4424 3.41613 18.2643 3.61359 18.7704C3.78506 19.21 4.15335 19.5432 4.6078 19.6701C5.13111 19.8161 5.92151 19.4604 7.50231 18.7491L17.6367 14.1886C19.1797 13.4942 19.9512 13.1471 20.1896 12.6648C20.3968 12.2458 20.3968 11.7541 20.1896 11.3351C19.9512 10.8529 19.1797 10.5057 17.6367 9.81135L7.48483 5.24303C5.90879 4.53382 5.12078 4.17921 4.59799 4.32468C4.14397 4.45101 3.77572 4.78336 3.60365 5.22209C3.40551 5.72728 3.67772 6.54741 4.22215 8.18767L5.24829 11.2793C5.34179 11.561 5.38855 11.7019 5.407 11.8459C5.42338 11.9738 5.42321 12.1032 5.40651 12.231C5.38768 12.375 5.34057 12.5157 5.24634 12.7972Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </g>
            </svg>
        </button>
    </div>
<div class="emoji-container">
    <div id="recentEmojis" class="emoji-list"></div>
    <div class="dropdown">
<div id="emoji-container">
<button class="emoji-dropdown" type="button" onclick="toggleEmojiPicker()">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <circle cx="12" cy="12" r="9" fill="transparent" stroke="#FFFFFF" stroke-width="2"/>
            <circle cx="8.5" cy="9.5" r="1.5" fill="#FFFFFF"/>
            <circle cx="15.5" cy="9.5" r="1.5" fill="#FFFFFF"/>
            <path d="M8.88875 13.5414C8.63822 13.0559 8.0431 12.8607 7.55301 13.1058C7.05903 13.3528 6.8588 13.9535 7.10579 14.4474C7.18825 14.6118 7.29326 14.7659 7.40334 14.9127C7.58615 15.1565 7.8621 15.4704 8.25052 15.7811C9.04005 16.4127 10.2573 17.0002 12.0002 17.0002C13.7431 17.0002 14.9604 16.4127 15.7499 15.7811C16.1383 15.4704 16.4143 15.1565 16.5971 14.9127C16.7076 14.7654 16.8081 14.6113 16.8941 14.4485C17.1387 13.961 16.9352 13.3497 16.4474 13.1058C15.9573 12.8607 15.3622 13.0559 15.1117 13.5414C15.0979 13.5663 14.9097 13.892 14.5005 14.2194C14.0401 14.5877 13.2573 15.0002 12.0002 15.0002C10.7431 15.0002 9.96038 14.5877 9.49991 14.2194C9.09071 13.892 8.90255 13.5663 8.88875 13.5414Z" fill="#FFFFFF"/>
        </g>
    </svg>
</button>
<button class="clear-emojis" type="button" onclick="clearRecentEmojis()">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path d="M11 15L9 13M9 13L11 11M9 13H13C14.1046 13 15 13.8954 15 15V16M16 6L15.7294 5.18807C15.4671 4.40125 15.3359 4.00784 15.0927 3.71698C14.8779 3.46013 14.6021 3.26132 14.2905 3.13878C13.9376 3 13.523 3 12.6936 3H11.3064C10.477 3 10.0624 3 9.70951 3.13878C9.39792 3.26132 9.12208 3.46013 8.90729 3.71698C8.66405 4.00784 8.53292 4.40125 8.27064 5.18807L8 6M4 6H20M18 6V16.2C18 17.8802 18 18.7202 17.673 19.362C17.3854 19.9265 16.9265 20.3854 16.362 20.673C15.7202 21 14.8802 21 13.2 21H10.8C9.11984 21 8.27976 21 7.63803 20.673C7.07354 20.3854 6.6146 19.9265 6.32698 19.362C6 18.7202 6 17.8802 6 16.2V6" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </g>
    </svg>
</button>
<button id="deleteMessagesButton">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" stroke="white">
    <path fill="white" d="M80.965 33.612c1.576-.004 3.152-.01 4.728-.016 4.297-.014 8.594-.01 12.891-.003 4.648.005 9.296-.008 13.943-.018 9.092-.017 18.184-.018 27.276-.013 7.393.004 14.787.003 22.18-.002l3.194-.003 6.425-.004c20.064-.014 40.127-.009 60.19.003 18.335.01 36.67-.003 55.004-.027 18.85-.024 37.7-.034 56.55-.027 10.574.003 21.147 0 31.72-.017 9.001-.014 18.001-.015 27.002.002 4.587.009 9.174.011 13.761-.004 4.209-.014 8.417-.01 12.625.01 1.513.004 3.027 0 4.54-.01 13.212-.085 25.6 2.047 37.381 8.33l2.022 1.049C477.74 45.707 482.514 48.915 487 53l2.293 2.05C494.988 60.423 499.137 66.214 503 73l1.402 2.395c7.905 14.487 8.181 29.11 8.116 45.183.005 2.244.012 4.488.02 6.732.019 6.053.012 12.107 0 18.16-.01 6.36-.001 12.719.005 19.078.008 11.358-.005 22.715-.025 34.073-.018 10.268-.015 20.536.003 30.805.022 11.965.03 23.93.018 35.895-.006 6.319-.007 12.638.006 18.956.012 5.943.004 11.886-.02 17.828-.005 2.171-.003 4.342.006 6.512.056 15.186-.992 28.927-8.218 42.633l-1.034 2.004c-9.582 17.917-25.614 30.1-44.6 36.738-11.77 3.224-23.007 3.254-35.122 3.168-2.063-.007-4.125-.013-6.188-.018-4.424-.012-8.848-.03-13.272-.051-7.002-.032-14.004-.04-21.007-.042a715612916.951 715612916.951 0 0 1-10.851-.004 10553.55 10553.55 0 0 1-48.864-.117 4781.178 4781.178 0 0 0-33.021-.057c-5.818.01-11.634 0-17.45-.052-5.471-.05-10.94-.052-16.41-.02-2.002.004-4.003-.01-6.005-.042-13.05-.316-13.05-.316-23.939 6.048A330.09 330.09 0 0 0 222 404a159.185 159.185 0 0 1-5.25 4.312c-4.504 3.636-8.89 7.384-13.25 11.188a556.347 556.347 0 0 1-15.625 13.125c-3.51 2.9-6.943 5.883-10.375 8.875a548.683 548.683 0 0 1-15.613 13.113c-3.582 2.961-7.076 6.016-10.574 9.074-15.797 13.772-15.797 13.772-25.676 13.657-5.795-.756-9.484-3.925-13.074-8.344-2.56-4.915-2.687-9.321-2.677-14.81v-2.012c0-2.18.008-4.36.016-6.541l.005-4.553c.003-3.983.013-7.966.024-11.95.01-4.068.015-8.137.02-12.206.01-7.976.028-15.952.049-23.928l-3.617.048c-4.501.055-9.002.089-13.503.117-1.935.015-3.87.035-5.804.061C65.492 393.511 46.43 391.002 29 377l-2.52-2.023C12.35 362.95 2.5 346.517 0 328c-.557-7.432-.421-14.903-.404-22.351l-.02-6.73c-.019-6.063-.018-12.125-.012-18.187.003-5.074-.003-10.148-.009-15.223-.015-12.66-.011-25.322 0-37.983.01-10.962-.002-21.925-.026-32.888-.024-11.292-.034-22.585-.027-33.878.003-6.325 0-12.65-.017-18.976-.015-5.951-.011-11.902.008-17.853.003-2.174 0-4.348-.01-6.522C-.617 95.015 3.457 76.141 19 59l2.121-2.367c16.054-16.998 37.082-23.12 59.844-23.02Z M30.996 73.227c-12.393 15.15-13.444 30.685-13.4 49.47a4491.015 4491.015 0 0 0-.032 24.424c.003 4.973-.003 9.945-.009 14.918-.015 12.405-.011 24.811 0 37.217.01 10.748-.002 21.495-.026 32.243-.024 11.064-.034 22.128-.027 33.193.003 6.2 0 12.4-.017 18.6-.015 5.833-.011 11.666.008 17.499.003 2.132 0 4.265-.01 6.398-.091 20.035 3.278 36.115 17.619 51.166 12.964 11.83 27.62 16.743 45.046 16.82l5.985.073c3.122.035 6.244.065 9.367.078 3.03.015 6.057.056 9.086.1l2.8-.006c5.81.109 10.982.82 15.614 4.58 3.652 4.485 4.506 7.552 4.546 13.29l.031 2.131c.03 2.305.031 4.61.032 6.915.015 1.606.032 3.211.05 4.817.044 4.212.064 8.423.08 12.635.019 4.304.06 8.608.1 12.911.076 8.434.126 16.867.161 25.301 2.973-1.759 5.722-3.462 8.313-5.75l1.799-1.577L140 449c1.34-1.175 2.682-2.35 4.023-3.523l2.027-1.777c2.834-2.47 5.7-4.902 8.575-7.325l1.6-1.35 3.182-2.682c2.701-2.277 5.397-4.56 8.093-6.843a79016.555 79016.555 0 0 1 4.875-4.125l6.5-5.5 3.252-2.752a9143.778 9143.778 0 0 1 11.31-9.56l1.611-1.361c3.462-2.929 6.905-5.879 10.34-8.84 4.69-4.037 9.39-8.061 14.175-11.987l2.253-1.852c5.07-3.537 9.742-3.811 15.784-3.781l2.621-.011c2.898-.01 5.795-.006 8.693-.002l6.234-.016c4.477-.012 8.953-.017 13.43-.018 7.086-.002 14.172-.02 21.259-.04 17.607-.05 35.215-.08 52.823-.102 13.672-.017 27.344-.04 41.016-.083 7.036-.022 14.071-.03 21.106-.028 4.392-.001 8.784-.015 13.176-.033 2.026-.005 4.052-.006 6.079 0 21.964.048 38.172-3.93 54.858-19.136 4.121-4.223 6.767-9.055 9.418-14.273l1.023-2.014c3.75-7.723 4.963-14.896 4.931-23.402l.014-2.778c.013-3.054.011-6.108.01-9.162.006-2.197.012-4.394.02-6.59.018-5.957.022-11.914.024-17.871 0-3.726.005-7.451.01-11.177a23979.646 23979.646 0 0 0 .026-39.026v-2.015c-.001-10.767.018-21.534.046-32.301.029-11.078.042-22.156.04-33.234 0-6.21.006-12.42.027-18.63.02-5.846.02-11.69.005-17.536-.002-2.137.003-4.275.015-6.413.06-11.333-.118-21.234-4.504-31.851l-1.083-2.721c-5.965-14.255-19.45-24.092-33.081-30.236-8.714-3.205-16.889-3.331-26.06-3.31a3748.235 3748.235 0 0 0-17.47-.023c-4.607 0-9.214-.011-13.82-.02-9.02-.017-18.04-.023-27.06-.024-7.335-.001-14.67-.005-22.004-.012a67946.343 67946.343 0 0 0-65.81-.025h-3.402c-18.188.001-36.375-.018-54.563-.046-18.685-.029-37.37-.042-56.055-.04-10.486 0-20.972-.006-31.458-.027-8.929-.018-17.858-.023-26.787-.009-4.552.006-9.105.007-13.657-.01-4.175-.017-8.349-.014-12.523.004-1.503.003-3.007 0-4.51-.012-20.11-.14-36.163 6.74-49.66 21.738Z" fill="white" stroke="white" stroke-width="5"/>
    <path fill ="white" d="m239.652 84.434 3.926-.02c2.729-.01 5.457-.005 8.186.01 3.472.017 6.941-.007 10.412-.042 3.346-.027 6.692-.017 10.039-.01l3.735-.041c8.647.092 15.564 1.609 22.112 7.535 4.67 4.85 7.528 10.596 10.375 16.634l1.35 2.781A748.031 748.031 0 0 1 313 118l2.978.028c3.685.04 7.37.106 11.054.18 1.587.028 3.175.049 4.763.063 10.567.1 18.457.97 27.455 6.854 7.084 7.406 8.216 14.101 8.313 24.125l.044 2.906c-.108 7.43-1.688 10.758-6.795 16.156-3.861 2.318-7.394 2.444-11.812 2.688l.043 1.701c.102 7.437-.532 14.731-1.265 22.127l-.394 4.094c-.355 3.678-.716 7.355-1.08 11.033l-.679 6.91c-.709 7.224-1.421 14.449-2.14 21.672a8591.15 8591.15 0 0 0-2.441 24.926 6220.699 6220.699 0 0 1-1.901 19.338c-.383 3.84-.761 7.679-1.127 11.52-.345 3.613-.704 7.224-1.074 10.835a746.97 746.97 0 0 0-.556 5.826c-.937 8.951-2.35 18.338-9.574 24.455l-2.105 1.872c-7.291 4.555-14.626 5.13-23.05 5.08l-3.33.015c-3.61.013-7.218.005-10.827-.006a4453.833 4453.833 0 0 1-23.39-.007c-6.08-.016-12.158-.01-18.236.006-5.874.015-11.748.013-17.622.004-2.488-.002-4.975 0-7.463.008-3.482.008-6.963-.004-10.445-.02l-3.09.018c-9.338-.083-16.686-1.927-23.531-8.473-8.499-9.54-7.944-24.09-9.143-36.185l-.386-3.8c-.344-3.395-.683-6.792-1.022-10.189-.284-2.85-.571-5.7-.858-8.55-.676-6.728-1.349-13.456-2.02-20.183-.688-6.915-1.383-13.828-2.082-20.741-.602-5.966-1.2-11.933-1.796-17.9-.354-3.55-.71-7.1-1.07-10.65-.4-3.958-.793-7.915-1.184-11.873l-.36-3.513c-.633-6.476-.955-12.844-.802-19.35l-1.876-.046c-5.575-.202-8.63-1.53-12.714-5.286-5.693-6.734-4.045-16.848-3.648-25.126.702-7.495 4.496-12.558 10.101-17.288 5.988-3.514 11.54-4.704 18.356-4.766l2.252-.054c2.343-.054 4.686-.088 7.029-.121 1.602-.034 3.203-.068 4.805-.104 3.898-.084 7.796-.151 11.695-.209l.791-1.693c12.008-25.47 12.008-25.47 23.442-30.437 5.363-1.686 10.843-1.459 16.42-1.436ZM225 107c-1.629 2.468-1.629 2.468-2.813 5.125l-1.269 2.633c-1.044 2.147-1.044 2.147-.918 4.242h72c-1.807-5.445-1.807-5.445-4.438-10.25l-1.246-2.016c-1.377-2.011-1.377-2.011-4.316-3.734-2.368-.317-2.368-.317-5.035-.29l-3.105-.04-3.352-.006-3.449-.02c-2.41-.01-4.818-.015-7.227-.015-3.686-.004-7.37-.04-11.055-.078-2.34-.006-4.68-.01-7.02-.012l-3.34-.043c-7.557-.003-7.557-.003-13.417 4.504Zm-59.953 31.852C162 142.912 162 142.912 163 153h186c1-10.089 1-10.089-2.047-14.148-3.672-2.303-5.877-2.48-10.202-2.487l-2.18-.024c-2.406-.02-4.81-.004-7.216.012-1.726-.007-3.453-.016-5.18-.027-4.685-.022-9.37-.013-14.057.002-4.904.013-9.807.001-14.711-.007-8.235-.009-16.47.003-24.705.027-9.52.027-19.041.019-28.562-.009-8.175-.023-16.349-.026-24.523-.013-4.882.008-9.764.009-14.647-.007-4.59-.015-9.18-.005-13.77.024-1.684.007-3.369.005-5.053-.006-2.3-.014-4.598.003-6.898.028l-3.9.006c-3.439.434-3.439.434-6.302 2.481ZM181 171c.592 10.655 1.199 21.204 2.243 31.806l.366 3.796c.392 4.067.791 8.133 1.192 12.199l.416 4.244c.578 5.878 1.158 11.756 1.743 17.633.833 8.367 1.654 16.736 2.459 25.106.57 5.926 1.154 11.85 1.748 17.772.353 3.525.7 7.05 1.033 10.575.37 3.917.768 7.831 1.168 11.745l.32 3.515c.725 7.652.725 7.652 5.312 13.609 2.808.936 4.522 1.13 7.427 1.14l2.745.018 3.003.003 3.17.015c3.465.015 6.931.022 10.397.027l7.216.017c5.045.01 10.09.017 15.136.02 6.47.006 12.938.03 19.406.058 4.97.019 9.938.024 14.907.026 2.385.003 4.77.01 7.155.024 3.335.017 6.67.015 10.004.008l2.991.028c4.933-.03 8.503-.059 12.443-3.384 2.165-3.247 2.387-4.732 2.772-8.54l.365-3.49.375-3.836.415-4.036c.375-3.657.74-7.314 1.103-10.972.381-3.832.772-7.663 1.16-11.494.654-6.441 1.3-12.882 1.942-19.324.741-7.432 1.491-14.864 2.246-22.294.728-7.158 1.45-14.317 2.17-21.476.305-3.04.612-6.08.92-9.121.364-3.59.723-7.18 1.079-10.77.193-1.935.39-3.869.587-5.803l.348-3.543.305-3.047c.267-4.076.213-8.169.213-12.254H181Z"/><path d="M281.5 195.438c4.023.646 5.683 1.662 8.5 4.562 1.276 3.83 1.156 7.44 1.161 11.431l.015 2.608c.015 2.849.022 5.698.027 8.547l.017 5.937c.01 4.151.017 8.302.02 12.454.006 5.318.03 10.637.058 15.955.019 4.089.024 8.178.026 12.266.003 1.961.01 3.922.024 5.883.017 2.743.015 5.486.008 8.23l.028 2.452c-.034 4.593-.485 7.613-3.384 11.237-3.75 2.5-5.559 2.536-10 2-2.708-1.979-4.657-3.566-5.461-6.931-.19-2.378-.215-4.709-.186-7.094l-.027-2.727c-.021-2.969-.007-5.936.01-8.904-.003-2.066-.008-4.132-.015-6.198-.007-4.328.004-8.655.027-12.982.029-5.546.012-11.09-.018-16.635a1759.1 1759.1 0 0 1 0-12.796c.004-2.045 0-4.09-.011-6.134-.013-2.859.006-5.715.034-8.574l-.03-2.557c.077-4.283.308-5.987 2.999-9.497C278 196 278 196 281.5 195.437ZM234 196c2.708 1.979 4.657 3.566 5.461 6.931.19 2.378.215 4.709.186 7.094l.027 2.727c.021 2.969.007 5.936-.01 8.904.003 2.066.008 4.132.015 6.198.007 4.328-.004 8.655-.027 12.982-.029 5.546-.012 11.09.018 16.635.018 4.266.012 8.53 0 12.796-.004 2.045 0 4.09.011 6.134.013 2.859-.006 5.715-.034 8.574l.03 2.557c-.077 4.283-.308 5.987-2.999 9.497C234 299 234 299 230.5 299.563c-4.023-.647-5.683-1.663-8.5-4.563-1.276-3.83-1.156-7.44-1.161-11.431l-.015-2.608c-.015-2.849-.022-5.698-.027-8.547l-.017-5.937c-.01-4.151-.017-8.302-.02-12.454-.006-5.318-.03-10.637-.058-15.955a2934.23 2934.23 0 0 1-.026-12.266c-.003-1.961-.01-3.922-.024-5.883a958.675 958.675 0 0 1-.008-8.23l-.028-2.452c.034-4.593.485-7.613 3.384-11.237 3.75-2.5 5.559-2.536 10-2ZM82.926 69.059c1.999 2.077 3.009 4.138 3.242 7.015-.224 2.824-.685 5.23-2.316 7.582-2.676 1.942-5.23 2.137-8.477 2.656-8.127 1.628-14.288 4.352-19.25 11.188-2.705 4.747-3.363 9.982-4.156 15.328-1.193 3.906-2.474 5.125-5.969 7.172-2.352.313-2.352.313-4.625 0l-2.29-.25C36.25 118.73 35.43 117.64 34 115c-1.733-11.381 1.655-21.654 8.25-30.871 8.25-10.036 27.128-22.517 40.676-15.07ZM473 307c3 1.688 3 1.688 5 5 1.799 10.453-1.199 20.018-6.797 28.828-7.446 9.948-17.928 16.126-30.203 18.172-4.486.469-7.912.544-12-1.5-2.307-2.884-2.828-4.821-3.348-8.402.548-3.302 1.964-4.79 4.348-7.098 3.355-1.152 3.355-1.152 7.188-1.938 7.482-1.762 13.787-3.812 18.394-10.285 2.932-5.33 3.979-10.456 4.914-16.414.504-2.363.504-2.363 2.129-5.05 3.474-1.92 6.57-2.127 10.375-1.313Z" fill="white" stroke="white" stroke-width="5"/></svg>
</button>
</div>
<div id="emojiPicker" class="emoji-picker hidden">
    <!-- List of all emojis -->
        <span onclick="addEmoji('😀')">😀</span>
        <span onclick="addEmoji('😁')">😁</span>
        <span onclick="addEmoji('😂')">😂</span>
        <span onclick="addEmoji('🤣')">🤣</span>
        <span onclick="addEmoji('😃')">😃</span>
        <span onclick="addEmoji('😄')">😄</span>
        <span onclick="addEmoji('😅')">😅</span>
        <span onclick="addEmoji('😆')">😆</span>
        <span onclick="addEmoji('😉')">😉</span>
        <span onclick="addEmoji('😊')">😊</span>
        <span onclick="addEmoji('😋')">😋</span>
        <span onclick="addEmoji('😎')">😎</span>
        <span onclick="addEmoji('😍')">😍</span>
        <span onclick="addEmoji('😘')">😘</span>
        <span onclick="addEmoji('😗')">😗</span>
        <span onclick="addEmoji('😙')">😙</span>
        <span onclick="addEmoji('😚')">😚</span>
        <span onclick="addEmoji('🙂')">🙂</span>
        <span onclick="addEmoji('🤗')">🤗</span>
        <span onclick="addEmoji('🤩')">🤩</span>
        <span onclick="addEmoji('🤔')">🤔</span>
        <span onclick="addEmoji('🤨')">🤨</span>
        <span onclick="addEmoji('😐')">😐</span>
        <span onclick="addEmoji('😑')">😑</span>
        <span onclick="addEmoji('😶')">😶</span>
        <span onclick="addEmoji('🙄')">🙄</span>
        <span onclick="addEmoji('😏')">😏</span>
        <span onclick="addEmoji('😣')">😣</span>
        <span onclick="addEmoji('😥')">😥</span>
        <span onclick="addEmoji('😮')">😮</span>
        <span onclick="addEmoji('🤐')">🤐</span>
        <span onclick="addEmoji('😯')">😯</span>
        <span onclick="addEmoji('😪')">😪</span>
        <span onclick="addEmoji('😫')">😫</span>
        <span onclick="addEmoji('😴')">😴</span>
        <span onclick="addEmoji('😌')">😌</span>
        <span onclick="addEmoji('😛')">😛</span>
        <span onclick="addEmoji('😜')">😜</span>
        <span onclick="addEmoji('😝')">😝</span>
        <span onclick="addEmoji('🤤')">🤤</span>
        <span onclick="addEmoji('😒')">😒</span>
        <span onclick="addEmoji('😓')">😓</span>
        <span onclick="addEmoji('😔')">😔</span>
        <span onclick="addEmoji('😕')">😕</span>
        <span onclick="addEmoji('🙃')">🙃</span>
        <span onclick="addEmoji('🤑')">🤑</span>
        <span onclick="addEmoji('😲')">😲</span>
        <span onclick="addEmoji('🙁')">🙁</span>
        <span onclick="addEmoji('😖')">😖</span>
        <span onclick="addEmoji('😞')">😞</span>
        <span onclick="addEmoji('😟')">😟</span>
        <span onclick="addEmoji('😤')">😤</span>
        <span onclick="addEmoji('😢')">😢</span>
        <span onclick="addEmoji('😭')">😭</span>
        <span onclick="addEmoji('😦')">😦</span>
        <span onclick="addEmoji('😧')">😧</span>
        <span onclick="addEmoji('😨')">😨</span>
        <span onclick="addEmoji('😩')">😩</span>
        <span onclick="addEmoji('🤯')">🤯</span>
        <span onclick="addEmoji('😬')">😬</span>
        <span onclick="addEmoji('😰')">😰</span>
        <span onclick="addEmoji('😱')">😱</span>
        <span onclick="addEmoji('🥵')">🥵</span>
        <span onclick="addEmoji('🥶')">🥶</span>
        <span onclick="addEmoji('🤫')">🤫</span>
        <span onclick="addEmoji('😳')">😳</span>
        <span onclick="addEmoji('🤪')">🤪</span>
        <span onclick="addEmoji('😵')">😵</span>
        <span onclick="addEmoji('😡')">😡</span>
        <span onclick="addEmoji('😠')">😠</span>
        <span onclick="addEmoji('🤬')">🤬</span>
        <span onclick="addEmoji('😷')">😷</span>
        <span onclick="addEmoji('🤒')">🤒</span>
        <span onclick="addEmoji('🤕')">🤕</span>
        <span onclick="addEmoji('🤢')">🤢</span>
        <span onclick="addEmoji('🤮')">🤮</span>
        <span onclick="addEmoji('🤧')">🤧</span>
        <span onclick="addEmoji('😇')">😇</span>
        <span onclick="addEmoji('🥳')">🥳</span>
        <span onclick="addEmoji('🥴')">🥴</span>
        <span onclick="addEmoji('🥺')">🥺</span>
        <span onclick="addEmoji('🤠')">🤠</span>
        <span onclick="addEmoji('👍')">👍</span>
        <span onclick="addEmoji('👌')">👌</span>
        <span onclick="addEmoji('🫡')">🫡</span>
        <span onclick="addEmoji('🥱')">🥱</span> 
        <span onclick="addEmoji('🤓')">🤓</span>
        <span onclick="addEmoji('🤥')">🤥</span>
        <span onclick="addEmoji('🧢')">🧢</span>
        <span onclick="addEmoji('🤝')">🤝</span>
        <span onclick="addEmoji('🤤')">🤤</span>
        <span onclick="addEmoji('🫠')">🫠</span>
        <span onclick="addEmoji('🫥')">🫥</span>
        <span onclick="addEmoji('🫨')">🫨</span>
        <span onclick="addEmoji('😈')">😈</span>
        <span onclick="addEmoji('👿')">👿</span>
        <span onclick="addEmoji('👹')">👹</span>
        <span onclick="addEmoji('👺')">👺</span>
        <span onclick="addEmoji('🤡')">🤡</span>
        <span onclick="addEmoji('💩')">💩</span>
        <span onclick="addEmoji('👻')">👻</span>
        <span onclick="addEmoji('💀')">💀</span>
        <span onclick="addEmoji('☠️')">☠️</span>
        <span onclick="addEmoji('👽')">👽</span>
        <span onclick="addEmoji('🗿')">🗿</span>
        <span onclick="addEmoji('👾')">👾</span>
        <span onclick="addEmoji('🤖')">🤖</span>
    <span onclick="addEmoji('💤')">💤</span>
    <span onclick="addEmoji('💭')">💭</span>
    <span onclick="addEmoji('🗯')">🗯</span>
    <span onclick="addEmoji('🗨')">🗨</span>
    <span onclick="addEmoji('👁️‍🗨️')">👁️‍🗨️</span>
    <span onclick="addEmoji('💓')">💓</span>
    <span onclick="addEmoji('💞')">💞</span>
    <span onclick="addEmoji('💕')">💕</span>
    <span onclick="addEmoji('💟')">💟</span>
    <span onclick="addEmoji('❣')">❣</span>
    <span onclick="addEmoji('💔')">💔</span>
    <span onclick="addEmoji('❤')">❤</span>
    <span onclick="addEmoji('🧡')">🧡</span>
    <span onclick="addEmoji('💛')">💛</span>
    <span onclick="addEmoji('💙')">💙</span>
    <span onclick="addEmoji('💜')">💜</span>
    <span onclick="addEmoji('🤎')">🤎</span>
    <span onclick="addEmoji('🖤')">🖤</span>
    <span onclick="addEmoji('🤍')">🤍</span>
    <span onclick="addEmoji('💯')">💯</span>
    <span onclick="addEmoji('💢')">💢</span>
    <span onclick="addEmoji('💥')">💥</span>
    <span onclick="addEmoji('💫')">💫</span>
    <span onclick="addEmoji('💦')">💦</span>
    <span onclick="addEmoji('💨')">💨</span>
    <span onclick="addEmoji('🕳')">🕳</span>
    <span onclick="addEmoji('💣')">💣</span>
    <span onclick="addEmoji('💬')">💬</span>
    <span onclick="addEmoji('💗')">💗</span>
    <span onclick="addEmoji('💖')">💖</span>
    <span onclick="addEmoji('💝')">💝</span>
    <span onclick="addEmoji('💘')">💘</span>
    <span onclick="addEmoji('💌')">💌</span>
    <span onclick="addEmoji('💋')">💋</span>
    <span onclick="addEmoji('🙊')">🙊</span>
    <span onclick="addEmoji('🙉')">🙉</span>
    <span onclick="addEmoji('🙈')">🙈</span>
    <span onclick="addEmoji('😾')">😾</span>
    <span onclick="addEmoji('😿')">😿</span>
    <span onclick="addEmoji('🙀')">🙀</span>
    <span onclick="addEmoji('😽')">😽</span>
    <span onclick="addEmoji('😼')">😼</span>
    <span onclick="addEmoji('😻')">😻</span>
    <span onclick="addEmoji('😹')">😹</span>
    <span onclick="addEmoji('😸')">😸</span>
    <span onclick="addEmoji('😺')">😺</span>
    <span onclick="addEmoji('🧑‍⚕️')">🧑‍⚕️</span>
    <span onclick="addEmoji('👨‍⚕️')">👨‍⚕️</span>
    <span onclick="addEmoji('👩‍⚕️')">👩‍⚕️</span>
    <span onclick="addEmoji('🧑‍🎓')">🧑‍🎓</span>
    <span onclick="addEmoji('👨‍🎓')">👨‍🎓</span>
    <span onclick="addEmoji('👩‍🎓')">👩‍🎓</span>
    <span onclick="addEmoji('🧑‍🏫')">🧑‍🏫</span>
    <span onclick="addEmoji('👨‍🏫')">👨‍🏫</span>
    <span onclick="addEmoji('👩‍🏫')">👩‍🏫</span>
    <span onclick="addEmoji('👨‍💻')">👨‍💻</span>
    <span onclick="addEmoji('🧑‍💻')">🧑‍💻</span>
    <span onclick="addEmoji('👩‍💻')">👩‍💻</span>
    <span onclick="addEmoji('👨‍🔬')">👨‍🔬</span>
    <span onclick="addEmoji('🧑‍🔬')">🧑‍🔬</span>
    <span onclick="addEmoji('👩‍🔬')">👩‍🔬</span>
    <span onclick="addEmoji('👨‍💼')">👨‍💼</span>
    <span onclick="addEmoji('🧑‍💼')">🧑‍💼</span>
    <span onclick="addEmoji('👩‍💼')">👩‍💼</span>
    <span onclick="addEmoji('👨‍🏭')">👨‍🏭</span>
    <span onclick="addEmoji('🧑‍🏭')">🧑‍🏭</span>
    <span onclick="addEmoji('👩‍🏭')">👩‍🏭</span>
    <span onclick="addEmoji('👨‍🔧')">👨‍🔧</span>
    <span onclick="addEmoji('🧑‍🔧')">🧑‍🔧</span>
    <span onclick="addEmoji('👩‍🔧')">👩‍🔧</span>
    <span onclick="addEmoji('👨‍🍳')">👨‍🍳</span>
    <span onclick="addEmoji('🧑‍🍳')">🧑‍🍳</span>
    <span onclick="addEmoji('👩‍🍳')">👩‍🍳</span>
    <span onclick="addEmoji('👨‍🌾')">👨‍🌾</span>
    <span onclick="addEmoji('🧑‍🌾')">🧑‍🌾</span>
    <span onclick="addEmoji('👩‍🌾')">👩‍🌾</span>
    <span onclick="addEmoji('👨‍⚖️')">👨‍⚖️</span>
    <span onclick="addEmoji('🧑‍⚖️')">🧑‍⚖️</span>
    <span onclick="addEmoji('👩‍⚖️')">👩‍⚖️</span>
    <span onclick="addEmoji('👨‍🎤')">👨‍🎤</span>
    <span onclick="addEmoji('🧑‍🎤')">🧑‍🎤</span>
    <span onclick="addEmoji('👩‍🎤')">👩‍🎤</span>
    <span onclick="addEmoji('👨‍🎨')">👨‍🎨</span>
    <span onclick="addEmoji('🧑‍🎨')">🧑‍🎨</span>
    <span onclick="addEmoji('👩‍🎨')">👩‍🎨</span>
    <span onclick="addEmoji('👨‍✈️')">👨‍✈️</span>
    <span onclick="addEmoji('🧑‍✈️')">🧑‍✈️</span>
    <span onclick="addEmoji('👩‍✈️')">👩‍✈️</span>
    <span onclick="addEmoji('👨‍🚀')">👨‍🚀</span>
    <span onclick="addEmoji('🧑‍🚀')">🧑‍🚀</span>
    <span onclick="addEmoji('👩‍🚀')">👩‍🚀</span>
    <span onclick="addEmoji('👨‍🚒')">👨‍🚒</span>
    <span onclick="addEmoji('👩‍🚒')">👩‍🚒</span>
    <span onclick="addEmoji('👮')">👮</span>
    <span onclick="addEmoji('🕵️‍♂️')">🕵️‍♂️</span>
    <span onclick="addEmoji('🕵️‍♀️')">🕵️‍♀️</span>
    <span onclick="addEmoji('💂')">💂</span>
    <span onclick="addEmoji('🦹')">🦹</span>
    <span onclick="addEmoji('🦸')">🦸</span>
    <span onclick="addEmoji('🤶')">🤶</span>
    <span onclick="addEmoji('🎅')">🎅</span>
    <span onclick="addEmoji('👼')">👼</span>
    <span onclick="addEmoji('🤱')">🤱</span>
    <span onclick="addEmoji('🤰')">🤰</span>
    <span onclick="addEmoji('👰')">👰</span>
    <span onclick="addEmoji('🤵')">🤵</span>
    <span onclick="addEmoji('👲')">👲</span>
    <span onclick="addEmoji('👳‍♂️')">👳‍♂️</span>
    <span onclick="addEmoji('👳')">👳</span>
    <span onclick="addEmoji('👸')">👸</span>
    <span onclick="addEmoji('🤴')">🤴</span>
    <span onclick="addEmoji('👷‍♀️')">👷‍♀️</span>
    <span onclick="addEmoji('👷‍♂️')">👷‍♂️</span>
    <span onclick="addEmoji('💂‍♀️')">💂‍♀️</span>
    <span onclick="addEmoji('🧙')">🧙</span>
    <span onclick="addEmoji('🧚')">🧚</span>
    <span onclick="addEmoji('🧛')">🧛</span>
    <span onclick="addEmoji('🧜')">🧜</span>
    <span onclick="addEmoji('🧝')">🧝</span>
    <span onclick="addEmoji('🧞')">🧞</span>
    <span onclick="addEmoji('🧟')">🧟</span>
    <span onclick="addEmoji('💆')">💆</span>
    <span onclick="addEmoji('🏃‍♀️')">🏃‍♀️</span>
    <span onclick="addEmoji('🏃‍♂️')">🏃‍♂️</span>
    <span onclick="addEmoji('🏃')">🏃</span>
    <span onclick="addEmoji('👩‍🦽')">👩‍🦽</span>
    <span onclick="addEmoji('👨‍🦽')">👨‍🦽</span>
    <span onclick="addEmoji('👩‍🦼')">👩‍🦼</span>
    <span onclick="addEmoji('🚶‍♂️')">🚶‍♂️</span>
    <span onclick="addEmoji('🚶')">🚶</span>
    <span onclick="addEmoji('💇‍♀️')">💇‍♀️</span>
    <span onclick="addEmoji('💇‍♂️')">💇‍♂️</span>
    <span onclick="addEmoji('💃')">💃</span>
    <span onclick="addEmoji('🕺')">🕺</span>
    <span onclick="addEmoji('🕴')">🕴</span>
    <span onclick="addEmoji('👯')">👯</span>
    <span onclick="addEmoji('🧖')">🧖</span>
    <span onclick="addEmoji('🧗')">🧗</span>
    <span onclick="addEmoji('🤺')">🤺</span>
    <span onclick="addEmoji('🏇')">🏇</span>
    <span onclick="addEmoji('⛷')">⛷</span>
    <span onclick="addEmoji('🏂')">🏂</span>
    <span onclick="addEmoji('🏌')">🏌</span>
    <span onclick="addEmoji('🏄')">🏄</span>
    <span onclick="addEmoji('🚣')">🚣</span>
    <span onclick="addEmoji('🤼‍♀️')">🤼‍♀️</span>
    <span onclick="addEmoji('🤸‍♀️')">🤸‍♀️</span>
    <span onclick="addEmoji('🚵‍♀️')">🚵‍♀️</span>
    <span onclick="addEmoji('🚴‍♀️')">🚴‍♀️</span>
    <span onclick="addEmoji('🏋️‍♀️')">🏋️‍♀️</span>
    <span onclick="addEmoji('🏊‍♀️')">🏊‍♀️</span>
    <span onclick="addEmoji('🤽‍♀️')">🤽‍♀️</span>
    <span onclick="addEmoji('🤾‍♀️')">🤾‍♀️</span>
    <span onclick="addEmoji('🤹‍♀️')">🤹‍♀️</span>
    <span onclick="addEmoji('🧘')">🧘</span>
    <span onclick="addEmoji('🛀')">🛀</span>
    <span onclick="addEmoji('🧑‍🤝‍🧑')">🧑‍🤝‍🧑</span>
    <span onclick="addEmoji('👭')">👭</span>
    <span onclick="addEmoji('👫')">👫</span>
    <span onclick="addEmoji('👬')">👬</span>
    <span onclick="addEmoji('💏')">💏</span>
    <span onclick="addEmoji('💑')">💑</span>
    <span onclick="addEmoji('👪')">👪</span>
    <span onclick="addEmoji('🗣')">🗣</span>
    <span onclick="addEmoji('👤')">👤</span>
    <span onclick="addEmoji('👥')">👥</span>
    <span onclick="addEmoji('👣')">👣</span>
    <span onclick="addEmoji('🦰')">🦰</span>
    <span onclick="addEmoji('🦲')">🦲</span>
    <span onclick="addEmoji('🦳')">🦳</span>
    <span onclick="addEmoji('🦱')">🦱</span>
    <span onclick="addEmoji('🐵')">🐵</span>
    <span onclick="addEmoji('🐒')">🐒</span>
    <span onclick="addEmoji('🦍')">🦍</span>
    <span onclick="addEmoji('🦧')">🦧</span>
    <span onclick="addEmoji('🐶')">🐶</span>
    <span onclick="addEmoji('🐕')">🐕</span>
    <span onclick="addEmoji('🦮')">🦮</span>
    <span onclick="addEmoji('🐩')">🐩</span>
    <span onclick="addEmoji('🐺')">🐺</span>
    <span onclick="addEmoji('🦊')">🦊</span>
    <span onclick="addEmoji('🦝')">🦝</span>
    <span onclick="addEmoji('🐱')">🐱</span>
    <span onclick="addEmoji('🐈')">🐈</span>
    <span onclick="addEmoji('🐯')">🐯</span>
    <span onclick="addEmoji('🐅')">🐅</span>
    <span onclick="addEmoji('🐆')">🐆</span>
    <span onclick="addEmoji('🐴')">🐴</span>
    <span onclick="addEmoji('🐎')">🐎</span>
    <span onclick="addEmoji('🦄')">🦄</span>
    <span onclick="addEmoji('🦌')">🦌</span>
    <span onclick="addEmoji('🐮')">🐮</span>
    <span onclick="addEmoji('🐿')">🐿</span>
    <span onclick="addEmoji('🐇')">🐇</span>
    <span onclick="addEmoji('🐹')">🐹</span>
    <span onclick="addEmoji('🐀')">🐀</span>
    <span onclick="addEmoji('🐁')">🐁</span>
    <span onclick="addEmoji('🐭')">🐭</span>
    <span onclick="addEmoji('🦛')">🦛</span>
    <span onclick="addEmoji('🦏')">🦏</span>
    <span onclick="addEmoji('🐘')">🐘</span>
    <span onclick="addEmoji('🦒')">🦒</span>
    <span onclick="addEmoji('🦙')">🦙</span>
    <span onclick="addEmoji('🐫')">🐫</span>
    <span onclick="addEmoji('🐪')">🐪</span>
    <span onclick="addEmoji('🐐')">🐐</span>
    <span onclick="addEmoji('🐑')">🐑</span>
    <span onclick="addEmoji('🐏')">🐏</span>
    <span onclick="addEmoji('🐽')">🐽</span>
    <span onclick="addEmoji('🐗')">🐗</span>
    <span onclick="addEmoji('🐖')">🐖</span>
    <span onclick="addEmoji('🐷')">🐷</span>
    <span onclick="addEmoji('🐄')">🐄</span>
    <span onclick="addEmoji('🐃')">🐃</span>
    <span onclick="addEmoji('🐂')">🐂</span>
    <span onclick="addEmoji('🦔')">🦔</span>
    <span onclick="addEmoji('🦇')">🦇</span>
    <span onclick="addEmoji('🐻')">🐻</span>
    <span onclick="addEmoji('🐨')">🐨</span>
    <span onclick="addEmoji('🐼')">🐼</span>
    <span onclick="addEmoji('🦥')">🦥</span>
    <span onclick="addEmoji('🦦')">🦦</span>
    <span onclick="addEmoji('🦨')">🦨</span>
    <span onclick="addEmoji('🦘')">🦘</span>
    <span onclick="addEmoji('🦡')">🦡</span>
    <span onclick="addEmoji('🐾')">🐾</span>
    <span onclick="addEmoji('🦃')">🦃</span>
    <span onclick="addEmoji('🐔')">🐔</span>
    <span onclick="addEmoji('🐓')">🐓</span>
    <span onclick="addEmoji('🐣')">🐣</span>
    <span onclick="addEmoji('🐥')">🐥</span>
    <span onclick="addEmoji('🐤')">🐤</span>
    <span onclick="addEmoji('🐦')">🐦</span>
    <span onclick="addEmoji('🐧')">🐧</span>
    <span onclick="addEmoji('🕊')">🕊</span>
    <span onclick="addEmoji('🦅')">🦅</span>
    <span onclick="addEmoji('🦆')">🦆</span>
    <span onclick="addEmoji('🐛')">🐛</span>
    <span onclick="addEmoji('🦋')">🦋</span>
    <span onclick="addEmoji('🦉')">🦉</span>
    <span onclick="addEmoji('🐌')">🐌</span>
    <span onclick="addEmoji('🐚')">🐚</span>
    <span onclick="addEmoji('🐙')">🐙</span>
    <span onclick="addEmoji('🦈')">🦈</span>
    <span onclick="addEmoji('🐡')">🐡</span>
    <span onclick="addEmoji('🐠')">🐠</span>
    <span onclick="addEmoji('🐟')">🐟</span>
    <span onclick="addEmoji('🐬')">🐬</span>
    <span onclick="addEmoji('🐋')">🐋</span>
    <span onclick="addEmoji('🦖')">🦖</span>
    <span onclick="addEmoji('🦕')">🦕</span>
    <span onclick="addEmoji('🐉')">🐉</span>
    <span onclick="addEmoji('🐲')">🐲</span>
    <span onclick="addEmoji('🐍')">🐍</span>
    <span onclick="addEmoji('🦎')">🦎</span>
    <span onclick="addEmoji('🐢')">🐢</span>
    <span onclick="addEmoji('🐊')">🐊</span>
    <span onclick="addEmoji('🐸')">🐸</span>
    <span onclick="addEmoji('🦜')">🦜</span>
    <span onclick="addEmoji('🦚')">🦚</span>
    <span onclick="addEmoji('🦩')">🦩</span>
    <span onclick="addEmoji('🐜')">🐜</span>
    <span onclick="addEmoji('🐝')">🐝</span>
    <span onclick="addEmoji('🐞')">🐞</span>
    <span onclick="addEmoji('🦗')">🦗</span>
    <span onclick="addEmoji('🕷')">🕷</span>
    <span onclick="addEmoji('🕸')">🕸</span>
    <span onclick="addEmoji('🦂')">🦂</span>
    <span onclick="addEmoji('🦟')">🦟</span>
    <span onclick="addEmoji('🦠')">🦠</span>
    <span onclick="addEmoji('💐')">💐</span>
    <span onclick="addEmoji('🌸')">🌸</span>
    <span onclick="addEmoji('💮')">💮</span>
    <span onclick="addEmoji('🏵')">🏵</span>
    <span onclick="addEmoji('🥀')">🥀</span>
    <span onclick="addEmoji('🌺')">🌺</span>
    <span onclick="addEmoji('🌱')">🌱</span>
    <span onclick="addEmoji('🌲')">🌲</span>
    <span onclick="addEmoji('🌳')">🌳</span>
    <span onclick="addEmoji('🌴')">🌴</span>
    <span onclick="addEmoji('🌵')">🌵</span>
    <span onclick="addEmoji('🍃')">🍃</span>
    <span onclick="addEmoji('🍂')">🍂</span>
    <span onclick="addEmoji('🍁')">🍁</span>
    <span onclick="addEmoji('☘')">☘</span>
    <span onclick="addEmoji('🌾')">🌾</span>
<span onclick="addEmoji('🌿')">🌿</span>
<span onclick="addEmoji('☘')">☘</span>
<span onclick="addEmoji('🍀')">🍀</span>
<span onclick="addEmoji('🍁')">🍁</span>
<span onclick="addEmoji('🍂')">🍂</span>
<span onclick="addEmoji('🍃')">🍃</span>
<span onclick="addEmoji('🍇')">🍇</span>
<span onclick="addEmoji('🍈')">🍈</span>
<span onclick="addEmoji('🍉')">🍉</span>
<span onclick="addEmoji('🍊')">🍊</span>
<span onclick="addEmoji('🍋')">🍋</span>
<span onclick="addEmoji('🍌')">🍌</span>
<span onclick="addEmoji('🍍')">🍍</span>
<span onclick="addEmoji('🥭')">🥭</span>
<span onclick="addEmoji('🍎')">🍎</span>
<span onclick="addEmoji('🍏')">🍏</span>
<span onclick="addEmoji('🍐')">🍐</span>
<span onclick="addEmoji('🍑')">🍑</span>
<span onclick="addEmoji('🍓')">🍓</span>
<span onclick="addEmoji('🥝')">🥝</span>
<span onclick="addEmoji('🍅')">🍅</span>
<span onclick="addEmoji('🥥')">🥥</span>
<span onclick="addEmoji('🥑')">🥑</span>
<span onclick="addEmoji('🍆')">🍆</span>
<span onclick="addEmoji('🥔')">🥔</span>
<span onclick="addEmoji('🥕')">🥕</span>
<span onclick="addEmoji('🌽')">🌽</span>
<span onclick="addEmoji('🌶')">🌶</span>
<span onclick="addEmoji('🥒')">🥒</span>
<span onclick="addEmoji('🥬')">🥬</span>
<span onclick="addEmoji('🥦')">🥦</span>
<span onclick="addEmoji('🧄')">🧄</span>
<span onclick="addEmoji('🧅')">🧅</span>
<span onclick="addEmoji('🍄')">🍄</span>
<span onclick="addEmoji('🥜')">🥜</span>
<span onclick="addEmoji('🌰')">🌰</span>
<span onclick="addEmoji('🍞')">🍞</span>
<span onclick="addEmoji('🥐')">🥐</span>
<span onclick="addEmoji('🥖')">🥖</span>
<span onclick="addEmoji('🥨')">🥨</span>
<span onclick="addEmoji('🥯')">🥯</span>
<span onclick="addEmoji('🥞')">🥞</span>
<span onclick="addEmoji('🧇')">🧇</span>
<span onclick="addEmoji('🧀')">🧀</span>
<span onclick="addEmoji('🍖')">🍖</span>
<span onclick="addEmoji('🍗')">🍗</span>
<span onclick="addEmoji('🥩')">🥩</span>
<span onclick="addEmoji('🥓')">🥓</span>
<span onclick="addEmoji('🍟')">🍟</span>
<span onclick="addEmoji('🍕')">🍕</span>
<span onclick="addEmoji('🌭')">🌭</span>
<span onclick="addEmoji('🥪')">🥪</span>
<span onclick="addEmoji('🌮')">🌮</span>
<span onclick="addEmoji('🌯')">🌯</span>
<span onclick="addEmoji('🥙')">🥙</span>
<span onclick="addEmoji('🧆')">🧆</span>
<span onclick="addEmoji('🥚')">🥚</span>
<span onclick="addEmoji('🍳')">🍳</span>
<span onclick="addEmoji('🥘')">🥘</span>
<span onclick="addEmoji('🍲')">🍲</span>
<span onclick="addEmoji('🥣')">🥣</span>
<span onclick="addEmoji('🥗')">🥗</span>
<span onclick="addEmoji('🍿')">🍿</span>
<span onclick="addEmoji('🧈')">🧈</span>
<span onclick="addEmoji('🧂')">🧂</span>
<span onclick="addEmoji('🥫')">🥫</span>
<span onclick="addEmoji('🍱')">🍱</span>
<span onclick="addEmoji('🍘')">🍘</span>
<span onclick="addEmoji('🍙')">🍙</span>
<span onclick="addEmoji('🍚')">🍚</span>
<span onclick="addEmoji('🍛')">🍛</span>
<span onclick="addEmoji('🍜')">🍜</span>
<span onclick="addEmoji('🍝')">🍝</span>
<span onclick="addEmoji('🍠')">🍠</span>
<span onclick="addEmoji('🍢')">🍢</span>
<span onclick="addEmoji('🍣')">🍣</span>
<span onclick="addEmoji('🍤')">🍤</span>
<span onclick="addEmoji('🍥')">🍥</span>
<span onclick="addEmoji('🥮')">🥮</span>
<span onclick="addEmoji('🍡')">🍡</span>
<span onclick="addEmoji('🥟')">🥟</span>
<span onclick="addEmoji('🥠')">🥠</span>
<span onclick="addEmoji('🥡')">🥡</span>
<span onclick="addEmoji('🦀')">🦀</span>
<span onclick="addEmoji('🦞')">🦞</span>
<span onclick="addEmoji('🦐')">🦐</span>
<span onclick="addEmoji('🦑')">🦑</span>
<span onclick="addEmoji('🦪')">🦪</span>
<span onclick="addEmoji('🍦')">🍦</span>
<span onclick="addEmoji('🍧')">🍧</span>
<span onclick="addEmoji('🍨')">🍨</span>
<span onclick="addEmoji('🍩')">🍩</span>
<span onclick="addEmoji('🍪')">🍪</span>
<span onclick="addEmoji('🎂')">🎂</span>
<span onclick="addEmoji('🍰')">🍰</span>
<span onclick="addEmoji('🧁')">🧁</span>
<span onclick="addEmoji('🥧')">🥧</span>
<span onclick="addEmoji('🍫')">🍫</span>
<span onclick="addEmoji('🍬')">🍬</span>
<span onclick="addEmoji('🍭')">🍭</span>
<span onclick="addEmoji('🍮')">🍮</span>
<span onclick="addEmoji('🍯')">🍯</span>
<span onclick="addEmoji('🍼')">🍼</span>
<span onclick="addEmoji('🥛')">🥛</span>
<span onclick="addEmoji('☕')">☕</span>
<span onclick="addEmoji('🍵')">🍵</span>
<span onclick="addEmoji('🍶')">🍶</span>
<span onclick="addEmoji('🍾')">🍾</span>
<span onclick="addEmoji('🍷')">🍷</span>
<span onclick="addEmoji('🍸')">🍸</span>
<span onclick="addEmoji('🍹')">🍹</span>
<span onclick="addEmoji('🍺')">🍺</span>
<span onclick="addEmoji('🍻')">🍻</span>
<span onclick="addEmoji('🥂')">🥂</span>
<span onclick="addEmoji('🥃')">🥃</span>
<span onclick="addEmoji('🥤')">🥤</span>
<span onclick="addEmoji('🧃')">🧃</span>
<span onclick="addEmoji('🧉')">🧉</span>
<span onclick="addEmoji('🧊')">🧊</span>
<span onclick="addEmoji('🥢')">🥢</span>
<span onclick="addEmoji('🍽')">🍽</span>
<span onclick="addEmoji('🍴')">🍴</span>
<span onclick="addEmoji('🔪')">🔪</span>
<span onclick="addEmoji('🏺')">🏺</span>
<span onclick="addEmoji('🌍')">🌍</span>
<span onclick="addEmoji('🌎')">🌎</span>
<span onclick="addEmoji('🌏')">🌏</span>
<span onclick="addEmoji('🌐')">🌐</span>
<span onclick="addEmoji('🗺')">🗺</span>
<span onclick="addEmoji('🗾')">🗾</span>
<span onclick="addEmoji('🧭')">🧭</span>
<span onclick="addEmoji('🏔')">🏔</span>
<span onclick="addEmoji('⛰')">⛰</span>
<span onclick="addEmoji('🌋')">🌋</span>
<span onclick="addEmoji('🗻')">🗻</span>
<span onclick="addEmoji('🏕')">🏕</span>
<span onclick="addEmoji('🏖')">🏖</span>
<span onclick="addEmoji('🏜')">🏜</span>
<span onclick="addEmoji('🏝')">🏝</span>
<span onclick="addEmoji('🏞')">🏞</span>
<span onclick="addEmoji('🏟')">🏟</span>
<span onclick="addEmoji('🏛')">🏛</span>
<span onclick="addEmoji('🏗')">🏗</span>
<span onclick="addEmoji('🧱')">🧱</span>
<span onclick="addEmoji('🏘')">🏘</span>
<span onclick="addEmoji('🏚')">🏚</span>
<span onclick="addEmoji('🏠')">🏠</span>
<span onclick="addEmoji('🏡')">🏡</span>
<span onclick="addEmoji('🏢')">🏢</span>
<span onclick="addEmoji('🏣')">🏣</span>
<span onclick="addEmoji('🏤')">🏤</span>
<span onclick="addEmoji('🏥')">🏥</span>
<span onclick="addEmoji('🏦')">🏦</span>
<span onclick="addEmoji('🏨')">🏨</span>
<span onclick="addEmoji('🏩')">🏩</span>
<span onclick="addEmoji('🏪')">🏪</span>
<span onclick="addEmoji('🏫')">🏫</span>
<span onclick="addEmoji('🏬')">🏬</span>
<span onclick="addEmoji('🏭')">🏭</span>
<span onclick="addEmoji('🏯')">🏯</span>
<span onclick="addEmoji('🏰')">🏰</span>
<span onclick="addEmoji('💒')">💒</span>
<span onclick="addEmoji('🗼')">🗼</span>
<span onclick="addEmoji('🗽')">🗽</span>
<span onclick="addEmoji('⛪')">⛪</span>
<span onclick="addEmoji('🕌')">🕌</span>
<span onclick="addEmoji('🛕')">🛕</span>
<span onclick="addEmoji('🕍')">🕍</span>
<span onclick="addEmoji('⛩')">⛩</span>
<span onclick="addEmoji('🕋')">🕋</span>
<span onclick="addEmoji('⛲')">⛲</span>
<span onclick="addEmoji('⛺')">⛺</span>
<span onclick="addEmoji('🌁')">🌁</span>
<span onclick="addEmoji('🌃')">🌃</span>
<span onclick="addEmoji('🏙')">🏙</span>
<span onclick="addEmoji('🌄')">🌄</span>
<span onclick="addEmoji('🌅')">🌅</span>
<span onclick="addEmoji('🌆')">🌆</span>
<span onclick="addEmoji('🌇')">🌇</span>
<span onclick="addEmoji('🌉')">🌉</span>
<span onclick="addEmoji('♨')">♨</span>
<span onclick="addEmoji('🎠')">🎠</span>
<span onclick="addEmoji('🎡')">🎡</span>
<span onclick="addEmoji('🎢')">🎢</span>
<span onclick="addEmoji('💈')">💈</span>
<span onclick="addEmoji('🎪')">🎪</span>
<span onclick="addEmoji('🚂')">🚂</span>
<span onclick="addEmoji('🚃')">🚃</span>
<span onclick="addEmoji('🚄')">🚄</span>
<span onclick="addEmoji('🚅')">🚅</span>
<span onclick="addEmoji('🚆')">🚆</span>
<span onclick="addEmoji('🚇')">🚇</span>
<span onclick="addEmoji('🚈')">🚈</span>
<span onclick="addEmoji('🚉')">🚉</span>
<span onclick="addEmoji('🚊')">🚊</span>
<span onclick="addEmoji('🚝')">🚝</span>
<span onclick="addEmoji('🚞')">🚞</span>
<span onclick="addEmoji('🚋')">🚋</span>
<span onclick="addEmoji('🚌')">🚌</span>
<span onclick="addEmoji('🚍')">🚍</span>
<span onclick="addEmoji('🚎')">🚎</span>
<span onclick="addEmoji('🚐')">🚐</span>
<span onclick="addEmoji('🚑')">🚑</span>
<span onclick="addEmoji('🚒')">🚒</span>
<span onclick="addEmoji('🚓')">🚓</span>
<span onclick="addEmoji('🚔')">🚔</span>
<span onclick="addEmoji('🚕')">🚕</span>
<span onclick="addEmoji('🚖')">🚖</span>
<span onclick="addEmoji('🚗')">🚗</span>
<span onclick="addEmoji('🚘')">🚘</span>
<span onclick="addEmoji('🚙')">🚙</span>
<span onclick="addEmoji('🚚')">🚚</span>
<span onclick="addEmoji('🚛')">🚛</span>
<span onclick="addEmoji('🚜')">🚜</span>
<span onclick="addEmoji('🏎')">🏎</span>
<span onclick="addEmoji('🏍')">🏍</span>
<span onclick="addEmoji('🛵')">🛵</span>
<span onclick="addEmoji('🦽')">🦽</span>
<span onclick="addEmoji('🦼')">🦼</span>
<span onclick="addEmoji('🛺')">🛺</span>
<span onclick="addEmoji('🚲')">🚲</span>
<span onclick="addEmoji('🛴')">🛴</span>
<span onclick="addEmoji('🛹')">🛹</span>
<span onclick="addEmoji('🚏')">🚏</span>
<span onclick="addEmoji('🛣')">🛣</span>
<span onclick="addEmoji('🛤')">🛤</span>
<span onclick="addEmoji('🛢')">🛢</span>
<span onclick="addEmoji('⛽')">⛽</span>
<span onclick="addEmoji('🚨')">🚨</span>
<span onclick="addEmoji('🚥')">🚥</span>
<span onclick="addEmoji('🚦')">🚦</span>
<span onclick="addEmoji('🛑')">🛑</span>
<span onclick="addEmoji('🚧')">🚧</span>
<span onclick="addEmoji('⚓')">⚓</span>
<span onclick="addEmoji('⛵')">⛵</span>
<span onclick="addEmoji('🛶')">🛶</span>
<span onclick="addEmoji('🚤')">🚤</span>
<span onclick="addEmoji('🛳')">🛳</span>
<span onclick="addEmoji('⛴')">⛴</span>
<span onclick="addEmoji('🛥')">🛥</span>
<span onclick="addEmoji('🚢')">🚢</span>
<span onclick="addEmoji('✈')">✈</span>
<span onclick="addEmoji('🛩')">🛩</span>
<span onclick="addEmoji('🛫')">🛫</span>
<span onclick="addEmoji('🛬')">🛬</span>
<span onclick="addEmoji('🪂')">🪂</span>
<span onclick="addEmoji('💺')">💺</span>
<span onclick="addEmoji('🚁')">🚁</span>
<span onclick="addEmoji('🚟')">🚟</span>
<span onclick="addEmoji('🚠')">🚠</span>
<span onclick="addEmoji('🚡')">🚡</span>
<span onclick="addEmoji('🛰')">🛰</span>
<span onclick="addEmoji('🚀')">🚀</span>
<span onclick="addEmoji('🛸')">🛸</span>
<span onclick="addEmoji('🛎')">🛎</span>
<span onclick="addEmoji('🧳')">🧳</span>
<span onclick="addEmoji('⌛')">⌛</span>
<span onclick="addEmoji('⏳')">⏳</span>
<span onclick="addEmoji('⌚')">⌚</span>
<span onclick="addEmoji('⏱')">⏱</span>
<span onclick="addEmoji('⏲')">⏲</span>
<span onclick="addEmoji('🕰')">🕰</span>
<span onclick="addEmoji('🕛')">🕛</span>
<span onclick="addEmoji('🕧')">🕧</span>
<span onclick="addEmoji('🕐')">🕐</span>
<span onclick="addEmoji('🕜')">🕜</span>
<span onclick="addEmoji('🕑')">🕑</span>
<span onclick="addEmoji('🕦')">🕦</span>
<span onclick="addEmoji('🕚')">🕚</span>
<span onclick="addEmoji('🕥')">🕥</span>
<span onclick="addEmoji('🕙')">🕙</span>
<span onclick="addEmoji('🕤')">🕤</span>
<span onclick="addEmoji('🕘')">🕘</span>
<span onclick="addEmoji('🕣')">🕣</span>
<span onclick="addEmoji('🕗')">🕗</span>
<span onclick="addEmoji('🕢')">🕢</span>
<span onclick="addEmoji('🕖')">🕖</span>
<span onclick="addEmoji('🕡')">🕡</span>
<span onclick="addEmoji('🕕')">🕕</span>
<span onclick="addEmoji('🕠')">🕠</span>
<span onclick="addEmoji('🕟')">🕟</span>
<span onclick="addEmoji('🕓')">🕓</span>
<span onclick="addEmoji('🕞')">🕞</span>
<span onclick="addEmoji('🕒')">🕒</span>
<span onclick="addEmoji('🕝')">🕝</span>
<span onclick="addEmoji('🌕')">🌕</span>
<span onclick="addEmoji('🌔')">🌔</span>
<span onclick="addEmoji('🌓')">🌓</span>
<span onclick="addEmoji('🌒')">🌒</span>
<span onclick="addEmoji('🌑')">🌑</span>
<span onclick="addEmoji('🌖')">🌖</span>
<span onclick="addEmoji('🌘')">🌘</span>
<span onclick="addEmoji('🌙')">🌙</span>
<span onclick="addEmoji('🌚')">🌚</span>
<span onclick="addEmoji('🌛')">🌛</span>
<span onclick="addEmoji('🌜')">🌜</span>
<span onclick="addEmoji('🌡')">🌡</span>
<span onclick="addEmoji('☀')">☀</span>
<span onclick="addEmoji('🌝')">🌝</span>
<span onclick="addEmoji('🌞')">🌞</span>
<span onclick="addEmoji('🪐')">🪐</span>
<span onclick="addEmoji('🌟')">🌟</span>
<span onclick="addEmoji('🌠')">🌠</span>
<span onclick="addEmoji('🌌')">🌌</span>
<span onclick="addEmoji('☁')">☁</span>
<span onclick="addEmoji('⛅')">⛅</span>
<span onclick="addEmoji('⛈')">⛈</span>
<span onclick="addEmoji('🌤')">🌤</span>
<span onclick="addEmoji('🌥')">🌥</span>
<span onclick="addEmoji('🌦')">🌦</span>
<span onclick="addEmoji('🌧')">🌧</span>
<span onclick="addEmoji('🌨')">🌨</span>
<span onclick="addEmoji('🌊')">🌊</span>
<span onclick="addEmoji('💧')">💧</span>
<span onclick="addEmoji('🔥')">🔥</span>
<span onclick="addEmoji('⛄')">⛄</span>
<span onclick="addEmoji('☃')">☃</span>
<span onclick="addEmoji('❄')">❄</span>
<span onclick="addEmoji('⚡')">⚡</span>
<span onclick="addEmoji('⛱')">⛱</span>
<span onclick="addEmoji('☔')">☔</span>
<span onclick="addEmoji('☂')">☂</span>
<span onclick="addEmoji('🌂')">🌂</span>
<span onclick="addEmoji('🌈')">🌈</span>
<span onclick="addEmoji('🌀')">🌀</span>
<span onclick="addEmoji('🌬')">🌬</span>
<span onclick="addEmoji('🌫')">🌫</span>
<span onclick="addEmoji('🌪')">🌪</span>
<span onclick="addEmoji('🌩')">🌩</span>
<span onclick="addEmoji('🎃')">🎃</span>
<span onclick="addEmoji('🎄')">🎄</span>
<span onclick="addEmoji('🎆')">🎆</span>
<span onclick="addEmoji('🎇')">🎇</span>
<span onclick="addEmoji('🧨')">🧨</span>
<span onclick="addEmoji('✨')">✨</span>
<span onclick="addEmoji('🎈')">🎈</span>
<span onclick="addEmoji('🎉')">🎉</span>
<span onclick="addEmoji('🎊')">🎊</span>
<span onclick="addEmoji('🎋')">🎋</span>
<span onclick="addEmoji('🎍')">🎍</span>
<span onclick="addEmoji('🎎')">🎎</span>
<span onclick="addEmoji('🎏')">🎏</span>
<span onclick="addEmoji('🎐')">🎐</span>
<span onclick="addEmoji('🎑')">🎑</span>
<span onclick="addEmoji('🧧')">🧧</span>
<span onclick="addEmoji('🎀')">🎀</span>
<span onclick="addEmoji('🎁')">🎁</span>
<span onclick="addEmoji('🎗')">🎗</span>
<span onclick="addEmoji('🎟')">🎟</span>
<span onclick="addEmoji('🎫')">🎫</span>
<span onclick="addEmoji('🎖')">🎖</span>
<span onclick="addEmoji('🏆')">🏆</span>
<span onclick="addEmoji('🏅')">🏅</span>
<span onclick="addEmoji('🥇')">🥇</span>
<span onclick="addEmoji('🥈')">🥈</span>
<span onclick="addEmoji('🥉')">🥉</span>
<span onclick="addEmoji('⚽')">⚽</span>
<span onclick="addEmoji('⚾')">⚾</span>
<span onclick="addEmoji('🥎')">🥎</span>
<span onclick="addEmoji('🏀')">🏀</span>
<span onclick="addEmoji('🏐')">🏐</span>
<span onclick="addEmoji('🏈')">🏈</span>
<span onclick="addEmoji('🏉')">🏉</span>
<span onclick="addEmoji('🎾')">🎾</span>
<span onclick="addEmoji('🥏')">🥏</span>
<span onclick="addEmoji('🎳')">🎳</span>
<span onclick="addEmoji('🏏')">🏏</span>
<span onclick="addEmoji('🏑')">🏑</span>
<span onclick="addEmoji('🏒')">🏒</span>
<span onclick="addEmoji('🥍')">🥍</span>
<span onclick="addEmoji('🏓')">🏓</span>
<span onclick="addEmoji('🏸')">🏸</span>
<span onclick="addEmoji('🥊')">🥊</span>
<span onclick="addEmoji('🥋')">🥋</span>
<span onclick="addEmoji('🥅')">🥅</span>
<span onclick="addEmoji('⛳')">⛳</span>
<span onclick="addEmoji('⛸')">⛸</span>
<span onclick="addEmoji('🎣')">🎣</span>
<span onclick="addEmoji('🤿')">🤿</span>
<span onclick="addEmoji('🎽')">🎽</span>
<span onclick="addEmoji('🎿')">🎿</span>
<span onclick="addEmoji('🛷')">🛷</span>
<span onclick="addEmoji('🥌')">🥌</span>
<span onclick="addEmoji('🎯')">🎯</span>
<span onclick="addEmoji('🪀')">🪀</span>
<span onclick="addEmoji('🪁')">🪁</span>
<span onclick="addEmoji('🎱')">🎱</span>
<span onclick="addEmoji('🧿')">🧿</span>
<span onclick="addEmoji('🎮')">🎮</span>
<span onclick="addEmoji('🕹')">🕹</span>
<span onclick="addEmoji('🎰')">🎰</span>
<span onclick="addEmoji('🎲')">🎲</span>
<span onclick="addEmoji('🧩')">🧩</span>
<span onclick="addEmoji('🧸')">🧸</span>
<span onclick="addEmoji('♠')">♠</span>
<span onclick="addEmoji('♥')">♥</span>
<span onclick="addEmoji('♦')">♦</span>
<span onclick="addEmoji('♣')">♣</span>
<span onclick="addEmoji('♟')">♟</span>
<span onclick="addEmoji('🃏')">🃏</span>
<span onclick="addEmoji('🀄')">🀄</span>
<span onclick="addEmoji('🎴')">🎴</span>
<span onclick="addEmoji('🎭')">🎭</span>
<span onclick="addEmoji('🖼')">🖼</span>
<span onclick="addEmoji('🎨')">🎨</span>
<span onclick="addEmoji('🧵')">🧵</span>
<span onclick="addEmoji('🧶')">🧶</span>
<span onclick="addEmoji('👓')">👓</span>
<span onclick="addEmoji('🕶')">🕶</span>
<span onclick="addEmoji('🥽')">🥽</span>
<span onclick="addEmoji('🥼')">🥼</span>
<span onclick="addEmoji('🦺')">🦺</span>
<span onclick="addEmoji('👔')">👔</span>
<span onclick="addEmoji('👕')">👕</span>
<span onclick="addEmoji('👖')">👖</span>
<span onclick="addEmoji('🧣')">🧣</span>
<span onclick="addEmoji('🧤')">🧤</span>
<span onclick="addEmoji('🧥')">🧥</span>
<span onclick="addEmoji('🧦')">🧦</span>
<span onclick="addEmoji('👗')">👗</span>
<span onclick="addEmoji('👘')">👘</span>
<span onclick="addEmoji('🥻')">🥻</span>
<span onclick="addEmoji('🩱')">🩱</span>
<span onclick="addEmoji('🩲')">🩲</span>
<span onclick="addEmoji('🩳')">🩳</span>
<span onclick="addEmoji('👙')">👙</span>
<span onclick="addEmoji('👚')">👚</span>
<span onclick="addEmoji('👛')">👛</span>
<span onclick="addEmoji('👝')">👝</span>
<span onclick="addEmoji('🛍')">🛍</span>
<span onclick="addEmoji('🎒')">🎒</span>
<span onclick="addEmoji('👞')">👞</span>
<span onclick="addEmoji('👟')">👟</span>
<span onclick="addEmoji('🥾')">🥾</span>
<span onclick="addEmoji('🥿')">🥿</span>
<span onclick="addEmoji('👠')">👠</span>
<span onclick="addEmoji('👡')">👡</span>
<span onclick="addEmoji('🩰')">🩰</span>
<span onclick="addEmoji('👢')">👢</span>
<span onclick="addEmoji('👑')">👑</span>
<span onclick="addEmoji('👒')">👒</span>
<span onclick="addEmoji('🎩')">🎩</span>
<span onclick="addEmoji('🎓')">🎓</span>
<span onclick="addEmoji('🧢')">🧢</span>
<span onclick="addEmoji('⛑')">⛑</span>
<span onclick="addEmoji('📿')">📿</span>
<span onclick="addEmoji('💄')">💄</span>
<span onclick="addEmoji('💍')">💍</span>
<span onclick="addEmoji('💎')">💎</span>
<span onclick="addEmoji('🔇')">🔇</span>
<span onclick="addEmoji('🔈')">🔈</span>
<span onclick="addEmoji('🔉')">🔉</span>
<span onclick="addEmoji('🔊')">🔊</span>
<span onclick="addEmoji('📢')">📢</span>
<span onclick="addEmoji('📣')">📣</span>
<span onclick="addEmoji('📯')">📯</span>
<span onclick="addEmoji('🔔')">🔔</span>
<span onclick="addEmoji('🔕')">🔕</span>
<span onclick="addEmoji('🎼')">🎼</span>
<span onclick="addEmoji('🎵')">🎵</span>
<span onclick="addEmoji('🎶')">🎶</span>
<span onclick="addEmoji('🎙')">🎙</span>
<span onclick="addEmoji('🎚')">🎚</span>
<span onclick="addEmoji('🎛')">🎛</span>
<span onclick="addEmoji('🎤')">🎤</span>
<span onclick="addEmoji('🎧')">🎧</span>
<span onclick="addEmoji('📻')">📻</span>
<span onclick="addEmoji('🎷')">🎷</span>
<span onclick="addEmoji('🎸')">🎸</span>
<span onclick="addEmoji('🎹')">🎹</span>
<span onclick="addEmoji('🎺')">🎺</span>
<span onclick="addEmoji('🎻')">🎻</span>
<span onclick="addEmoji('🪕')">🪕</span>
<span onclick="addEmoji('🥁')">🥁</span>
<span onclick="addEmoji('📲')">📲</span>
<span onclick="addEmoji('📱')">📱</span>
<span onclick="addEmoji('☎')">☎</span>
<span onclick="addEmoji('📞')">📞</span>
<span onclick="addEmoji('📟')">📟</span>
<span onclick="addEmoji('📠')">📠</span>
<span onclick="addEmoji('🔋')">🔋</span>
<span onclick="addEmoji('🔌')">🔌</span>
<span onclick="addEmoji('💻')">💻</span>
<span onclick="addEmoji('🖥')">🖥</span>
<span onclick="addEmoji('⌨')">⌨</span>
<span onclick="addEmoji('🖱')">🖱</span>
<span onclick="addEmoji('🖲')">🖲</span>
<span onclick="addEmoji('💽')">💽</span>
<span onclick="addEmoji('💾')">💾</span>
<span onclick="addEmoji('💿')">💿</span>
<span onclick="addEmoji('📀')">📀</span>
<span onclick="addEmoji('🧮')">🧮</span>
<span onclick="addEmoji('🎥')">🎥</span>
<span onclick="addEmoji('🎞')">🎞</span>
<span onclick="addEmoji('📽')">📽</span>
<span onclick="addEmoji('🎬')">🎬</span>
<span onclick="addEmoji('📺')">📺</span>
<span onclick="addEmoji('📷')">📷</span>
<span onclick="addEmoji('📸')">📸</span>
<span onclick="addEmoji('📹')">📹</span>
<span onclick="addEmoji('📼')">📼</span>
<span onclick="addEmoji('🔍')">🔍</span>
<span onclick="addEmoji('🔎')">🔎</span>
<span onclick="addEmoji('🕯')">🕯</span>
<span onclick="addEmoji('💡')">💡</span>
<span onclick="addEmoji('🔦')">🔦</span>
<span onclick="addEmoji('🏮')">🏮</span>
<span onclick="addEmoji('🪔')">🪔</span>
<span onclick="addEmoji('📔')">📔</span>
<span onclick="addEmoji('📕')">📕</span>
<span onclick="addEmoji('📖')">📖</span>
<span onclick="addEmoji('📗')">📗</span>
<span onclick="addEmoji('📘')">📘</span>
<span onclick="addEmoji('📙')">📙</span>
<span onclick="addEmoji('📚')">📚</span>
<span onclick="addEmoji('📒')">📒</span>
<span onclick="addEmoji('📜')">📜</span>
<span onclick="addEmoji('📰')">📰</span>
<span onclick="addEmoji('🗞')">🗞</span>
<span onclick="addEmoji('📑')">📑</span>
<span onclick="addEmoji('🔖')">🔖</span>
<span onclick="addEmoji('🏷')">🏷</span>
<span onclick="addEmoji('💰')">💰</span>
<span onclick="addEmoji('💴')">💴</span>
<span onclick="addEmoji('💵')">💵</span>
<span onclick="addEmoji('💶')">💶</span>
<span onclick="addEmoji('💷')">💷</span>
<span onclick="addEmoji('💸')">💸</span>
<span onclick="addEmoji('💳')">💳</span>
<span onclick="addEmoji('🧾')">🧾</span>
<span onclick="addEmoji('💹')">💹</span>
<span onclick="addEmoji('💱')">💱</span>
<span onclick="addEmoji('💲')">💲</span>
<span onclick="addEmoji('✉')">✉</span>
<span onclick="addEmoji('📧')">📧</span>
<span onclick="addEmoji('📨')">📨</span>
<span onclick="addEmoji('📩')">📩</span>
<span onclick="addEmoji('📤')">📤</span>
<span onclick="addEmoji('📥')">📥</span>
<span onclick="addEmoji('📦')">📦</span>
<span onclick="addEmoji('📪')">📪</span>
<span onclick="addEmoji('📬')">📬</span>
<span onclick="addEmoji('📭')">📭</span>
<span onclick="addEmoji('📮')">📮</span>
<span onclick="addEmoji('🗳')">🗳</span>
<span onclick="addEmoji('🖋')">🖋</span>
<span onclick="addEmoji('🖌')">🖌</span>
<span onclick="addEmoji('🖍')">🖍</span>
<span onclick="addEmoji('📝')">📝</span>
<span onclick="addEmoji('💼')">💼</span>
<span onclick="addEmoji('📁')">📁</span>
<span onclick="addEmoji('📂')">📂</span>
<span onclick="addEmoji('🗂')">🗂</span>
<span onclick="addEmoji('📅')">📅</span>
<span onclick="addEmoji('📆')">📆</span>
<span onclick="addEmoji('🗒')">🗒</span>
<span onclick="addEmoji('🗓')">🗓</span>
<span onclick="addEmoji('📇')">📇</span>
<span onclick="addEmoji('📈')">📈</span>
<span onclick="addEmoji('📉')">📉</span>
<span onclick="addEmoji('📋')">📋</span>
<span onclick="addEmoji('📊')">📊</span>
<span onclick="addEmoji('📍')">📍</span>
<span onclick="addEmoji('📎')">📎</span>
<span onclick="addEmoji('🖇')">🖇</span>
<span onclick="addEmoji('📏')">📏</span>
<span onclick="addEmoji('📐')">📐</span>
<span onclick="addEmoji('🗃')">🗃</span>
<span onclick="addEmoji('🗄')">🗄</span>
<span onclick="addEmoji('🗑')">🗑</span>
<span onclick="addEmoji('🔒')">🔒</span>
<span onclick="addEmoji('🔓')">🔓</span>
<span onclick="addEmoji('🔏')">🔏</span>
<span onclick="addEmoji('🔐')">🔐</span>
<span onclick="addEmoji('🔑')">🔑</span>
<span onclick="addEmoji('🗝')">🗝</span>
<span onclick="addEmoji('🔨')">🔨</span>
<span onclick="addEmoji('🪓')">🪓</span>
<span onclick="addEmoji('🛠')">🛠</span>
<span onclick="addEmoji('🔫')">🔫</span>
<span onclick="addEmoji('🏹')">🏹</span>
<span onclick="addEmoji('🛡')">🛡</span>
<span onclick="addEmoji('🔧')">🔧</span>
<span onclick="addEmoji('🔩')">🔩</span>
<span onclick="addEmoji('🗜')">🗜</span>
<span onclick="addEmoji('🦯')">🦯</span>
<span onclick="addEmoji('🔗')">🔗</span>
<span onclick="addEmoji('🧲')">🧲</span>
<span onclick="addEmoji('🧪')">🧪</span>
<span onclick="addEmoji('🧫')">🧫</span>
<span onclick="addEmoji('🧬')">🧬</span>
<span onclick="addEmoji('🔬')">🔬</span>
<span onclick="addEmoji('🔭')">🔭</span>
<span onclick="addEmoji('📡')">📡</span>
<span onclick="addEmoji('💉')">💉</span>
<span onclick="addEmoji('🩸')">🩸</span>
<span onclick="addEmoji('💊')">💊</span>
<span onclick="addEmoji('🩹')">🩹</span>
<span onclick="addEmoji('🩺')">🩺</span>
<span onclick="addEmoji('🚪')">🚪</span>
<span onclick="addEmoji('🛋')">🛋</span>
<span onclick="addEmoji('🪑')">🪑</span>
<span onclick="addEmoji('🚽')">🚽</span>
<span onclick="addEmoji('🚿')">🚿</span>
<span onclick="addEmoji('🛁')">🛁</span>
<span onclick="addEmoji('🪒')">🪒</span>
<span onclick="addEmoji('🧴')">🧴</span>
<span onclick="addEmoji('🧷')">🧷</span>
<span onclick="addEmoji('🧹')">🧹</span>
<span onclick="addEmoji('🧺')">🧺</span>
<span onclick="addEmoji('🧻')">🧻</span>
<span onclick="addEmoji('🧼')">🧼</span>
<span onclick="addEmoji('🧽')">🧽</span>
<span onclick="addEmoji('🧯')">🧯</span>
<span onclick="addEmoji('🛒')">🛒</span>


            <!-- Add more emojis here -->
        </div>
    </div>
</div>




</div>

<!-- Modal for Viewing Group Members -->
<div id="viewMembersModal" class="modal2">
    <div class="modal-content">
        <span class="close">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: 24px;">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                    <g id="Edit / Close_Circle">
                        <path id="Vector" d="M9 9L11.9999 11.9999M11.9999 11.9999L14.9999 14.9999M11.9999 11.9999L9 14.9999M11.9999 11.9999L14.9999 9M12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21Z"
                            stroke="#ffffff"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round">
                        </path>
                    </g>
                </g>
            </svg>
        </span>
        <h2>Group Members</h2>
        <div id="membersList">
            <!-- Members will be dynamically added here -->
        </div>
    </div>
</div>

<!-- Modal Structure -->
<div id="bugModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <button id="disableModal" class="modal-btn">
                <svg fill="#ffffff" viewBox="0 0 32 32" enable-background="new 0 0 32 32" id="Glyph" version="1.1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" stroke="#ffffff">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <path d="M20.722,24.964c0.096,0.096,0.057,0.264-0.073,0.306c-7.7,2.466-16.032-1.503-18.594-8.942 c-0.072-0.21-0.072-0.444,0-0.655c0.743-2.157,1.99-4.047,3.588-5.573c0.061-0.058,0.158-0.056,0.217,0.003l4.302,4.302 c0.03,0.03,0.041,0.072,0.031,0.113c-1.116,4.345,2.948,8.395,7.276,7.294c0.049-0.013,0.095-0.004,0.131,0.032 C17.958,22.201,20.045,24.287,20.722,24.964z" id="XMLID_323_"></path>
                        <path d="M24.68,23.266c2.406-1.692,4.281-4.079,5.266-6.941c0.072-0.21,0.072-0.44,0-0.65 C27.954,9.888,22.35,6,16,6c-2.479,0-4.841,0.597-6.921,1.665L3.707,2.293c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414 l26,26c0.391,0.391,1.023,0.391,1.414,0c0.391-0.391,0.391-1.023,0-1.414L24.68,23.266z M16,10c3.309,0,6,2.691,6,6 c0,1.294-0.416,2.49-1.115,3.471l-8.356-8.356C13.51,10.416,14.706,10,16,10z" id="XMLID_325_"></path>
                    </g>
                </svg>
            </button>
            <span class="modal-title">Current Bugs:</span>
            <button id="closeModal" class="modal-btn">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <g id="Edit / Close_Circle">
                            <path id="Vector" d="M9 9L11.9999 11.9999M11.9999 11.9999L14.9999 14.9999M11.9999 11.9999L9 14.9999M11.9999 11.9999L14.9999 9M12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        </g>
                    </g>
                </svg>
            </button>
        </div>
<ul class="bug-list">
    <li>Chat Switching Bug: When switching between individual chats, messages may be sent to the previous chat instead of the current one.</li>
    <li class="fix-item">Fix: Refresh the page before switching chats, then select the desired contact.</li>
    <li>View Friend Info Bug: The view friend modal is still under development, and the close button may be difficult to use.</li>
    <li class="fix-item">Fix: If possible, try to close the modal or refresh the page to resolve the issue.</li>
</ul>
    </div>
</div>

<!-- Modal structure -->
<div id="viewFriendModal" class="modal3">
    <div class="modal-content3">
        <span class="close-button3">&times;</span>
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: 24px;">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                    <g id="Edit / Close_Circle">
                        <path id="Vector" d="M9 9L11.9999 11.9999M11.9999 11.9999L14.9999 14.9999M11.9999 11.9999L9 14.9999M11.9999 11.9999L14.9999 9M12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21Z"
                            stroke="#ffffff"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round">
                        </path>
                    </g>
                </g>
            </svg>
        </span>
        <h3>Friend Information</h3>
        <p><strong>Name:</strong> <span id="friendDisplayName"></span></p>
        <p><strong>Email:</strong> <span id="friendEmail"></span></p>
        <label for="editFriendName">Edit Friend Name:</label>
        <input type="text" id="editFriendName" class="input-style">
        <button id="saveFriendName" class="save-button">Save</button>
    </div>
</div>


<!-- Modal for Replies -->
<div id="modal4" class="modal4">
    <div class="modal4-content">
        <span class="modal4-close">&times;</span>
        <div id="modal4Message"></div>
        <textarea id="replyInput" placeholder="Write your reply here..."></textarea>
        <button id="sendReplyButton">Send Reply</button>
    </div>
</div>


<div style="display:none;">
    <svg id="defaultAvatar" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 4C14.21 4 16 5.79 16 8C16 10.21 14.21 12 12 12C9.79 12 8 10.21 8 8C8 5.79 9.79 4 12 4ZM12 20C9.33 20 6.34 18.87 4.63 16.74C5.91 15.43 8.39 14.5 12 14.5C15.61 14.5 18.09 15.43 19.37 16.74C17.66 18.87 14.67 20 12 20Z" fill="currentColor"/>
    </svg>
</div>
    
<div class="avatar-container" style="display: none;">
    <svg id="defaultGroupAvatar" fill="#ffffff" viewBox="0 -64 640 640" xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="background-color: var(--primary-color); border-radius: 50%; padding: 8px; display: flex; align-items: center; justify-content: center;">
        <!-- Keep the circle -->
        <circle cx="320" cy="320" r="320" fill="var(--primary-color)" />
        
        <!-- New SVG path -->
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"></path>
        </g>
    </svg>
</div>




<!-- Modal for editing group chat -->
<div id="modal7" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Edit Group Chat</h2>
    </div>
    <div class="modal-body">
      <!-- Avatar container added below the header -->
      <div class="avatar-container">
        <img id="currentGroupImage" src="" alt="" class="profile-picture" />
        <button id="editGroupImageBtn" class="edit-image-button">Edit Group Image</button>
      </div>
      
      <label for="groupNameInput">Group Name:</label>
      <input type="text" id="groupNameInput" value="" placeholder="Enter new group name">
      
      <!-- Hidden file input to upload the group chat image -->
      <input type="file" id="groupImageInput" style="display:none;">
      
      <img id="imageToCrop" src="" alt="Image to Crop" style="display:none; margin-top: 20px;">
    </div>
    <div class="modal-footer">
      <button id="cancelCropBtn" class="cancel-button">Cancel</button>
      <button id="saveGroupChangesBtn" class="done-button">Save Changes</button>
    </div>
  </div>
</div>

 <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script> <!-- Added Firebase Storage -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-messaging.js"></script>
    <script>
// Initialize Firebase
var firebaseConfig = {
    apiKey: "AIzaSyDaMAlQRMXiDsZ4P0b06P18id3y5xBiZ1k",
    authDomain: "deepworkai-c3419.firebaseapp.com",
    projectId: "deepworkai-c3419",
    storageBucket: "deepworkai-c3419.appspot.com",
    messagingSenderId: "367439182644",
    appId: "1:367439182644:web:304216430df97eff68c361"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();
var auth = firebase.auth();
const firestore = firebase.firestore();
var storage = firebase.storage();  // Initialize Firebase Storage

var emojiPicker = document.getElementById("emojiPicker");
var recentEmojisContainer = document.getElementById("recentEmojis");

let inactivityTimeout;
let isUserOffline = false;

// Global variables
let currentChatFriend = null;
let currentGroupId = null; // Ensure this variable is declared globally


function setUserOnlineStatus(status) {
    const currentUser = firebase.auth().currentUser;
    if (currentUser) {
        const currentUserUID = currentUser.uid;
        
        db.collection('users').doc(currentUserUID).update({
            online: status
        }).then(() => {
            
            isUserOffline = !status; // Update isUserOffline based on the new status
        }).catch((error) => {
            console.error('Error updating online status: ', error);
        });
    } else {
        console.error('No current user is logged in.'); // Log if currentUser is null
    }
}

function updateUserStatusOnInteraction() {
    if (isUserOffline) {
        setUserOnlineStatus(true); // Set status to true if user is offline
    }
    clearTimeout(inactivityTimeout); // Clear previous timeout
    inactivityTimeout = setTimeout(() => {
        setUserOnlineStatus(false); // Set status to false after 30 seconds of inactivity
    }, 30000); // 30 seconds 
}

// Bind the interaction function to all necessary events
window.addEventListener('click', updateUserStatusOnInteraction);
window.addEventListener('keydown', updateUserStatusOnInteraction);
window.addEventListener('scroll', updateUserStatusOnInteraction);

// Initialize user's online status to true when the page loads
function initializeUserStatus() {
    if (firebase.auth().currentUser) {
        setUserOnlineStatus(true); // Set status to true when the page loads or reloads
        updateUserStatusOnInteraction(); // Set up inactivity timeout
    }
}

// Call initializeUserStatus on page load
initializeUserStatus();

// Update status to offline when the page is unloaded
window.addEventListener('beforeunload', () => {
    if (firebase.auth().currentUser) {
        setUserOnlineStatus(true); // Set status to false when the user leaves
    }
});
        
// Toggle the emoji picker dropdown
function toggleEmojiPicker() {
    emojiPicker.classList.toggle("hidden");
}

// Function to add emoji to input and save it as recent
function addEmoji(emoji) {
    const chatInput = document.getElementById('chatInput');
    if (chatInput) {
        chatInput.value += emoji;
    }

    var user = auth.currentUser;
    if (user) {
        var userDocRef = db.collection("recentEmojis").doc(user.uid);
        userDocRef.get().then(function(doc) {
            if (doc.exists) {
                userDocRef.update({
                    emojis: firebase.firestore.FieldValue.arrayUnion(emoji)
                }).then(() => {
                    // Update recent emojis in the UI
                    loadRecentEmojis();
                });
            } else {
                userDocRef.set({
                    emojis: [emoji]
                }).then(() => {
                    // Update recent emojis in the UI
                    loadRecentEmojis();
                });
            }
        }).catch(function(error) {
            console.error("Error adding emoji: ", error);
        });
    }
}


// Load recent emojis from Firestore
function loadRecentEmojis() {
    var user = auth.currentUser;
    if (user) {
        db.collection("recentEmojis").doc(user.uid).get().then(function(doc) {
            if (doc.exists && doc.data().emojis.length > 0) {
                var recentEmojis = doc.data().emojis;
                recentEmojisContainer.innerHTML = "";
                recentEmojis.reverse().forEach(function(emoji) {
                    var emojiSpan = document.createElement("span");
                    emojiSpan.textContent = emoji;
                    emojiSpan.onclick = function() { addEmoji(emoji); };
                    recentEmojisContainer.appendChild(emojiSpan);
                });
            } else {
                // Show popular emojis if no recent emojis are available
                var popularEmojis = ["😀", "😂", "😍", "😭", "🙄"];
                recentEmojisContainer.innerHTML = "";
                popularEmojis.forEach(function(emoji) {
                    var emojiSpan = document.createElement("span");
                    emojiSpan.textContent = emoji;
                    emojiSpan.onclick = function() { addEmoji(emoji); };
                    recentEmojisContainer.appendChild(emojiSpan);
                });
            }
        }).catch(function(error) {
            console.error("Error loading recent emojis: ", error);
        });
    }
}

// Call loadRecentEmojis on page load
auth.onAuthStateChanged(function(user) {
    if (user) {
        loadRecentEmojis();
    }
});

function clearRecentEmojis() {
    // Get current user
    var user = auth.currentUser;
    
    if (user) {
        var userId = user.uid;
        
        // Reference to the recentEmojis collection for the current user
        var recentEmojisRef = db.collection('recentEmojis').doc(userId);
        
        // Clear the recent emojis for the current user
        recentEmojisRef.update({
            emojis: [] // Assuming 'emojis' is the field storing recent emojis
        })
        .then(() => {
            
            
            // Clear the emojis from the UI
            var recentEmojisContainer = document.getElementById('recentEmojis');
            if (recentEmojisContainer) {
                recentEmojisContainer.innerHTML = ''; // Clears the recent emojis
            }
            
            // Call loadRecentEmojis to refresh the UI
            loadRecentEmojis();
        })
        .catch((error) => {
            console.error('Error clearing recent emojis: ', error);
        });
    } else {
        console.error('No user is signed in.');
    }
}

    
        function updateOnlineStatus(isOnline) {
            if (auth.currentUser) {
                db.collection('users').doc(auth.currentUser.uid).set({
                    online: isOnline,
                    lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true }).then(() => {
                    
                }).catch((error) => {
                    console.error('Error updating online status:', error);
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    // Update the UI with the user's display name
                    const username = user.displayName || user.email;
                    document.getElementById('username').textContent = username;
                    document.getElementById('displayName').textContent = username;

                    // Set Firestore online status to true when the user is authenticated
                    updateOnlineStatus(true);

                    // Handle the user going offline only when the tab is closed or navigated away
                    window.addEventListener('beforeunload', function() {
                        updateOnlineStatus(false);
                    });

                    // Handle tab visibility change
                    document.addEventListener('visibilitychange', function() {
                        if (document.visibilityState === 'visible') {
                            updateOnlineStatus(true);
                        }
                    });

                } else {
                    // No user is signed in, redirect to login page
                    window.location.href = "login.html";
                }
            });
        });

            document.addEventListener('DOMContentLoaded', function() {
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                loadOnlineFriends();
                listenForFriendRequests();
                refreshOnlineFriends();
            } else {
                window.location.href = "login.html";
            }
        });
    });



document.addEventListener('DOMContentLoaded', function() {
    auth.onAuthStateChanged(function(user) {
        if (user) {
            const devEmails = ['srinibaj10@gmail.com', 'fugegate@gmail.com', 'draco77654@gmail.com', 'bajinsrinivasr@lexington1.net'];

            // Fetch the current user's data from Firestore
            db.collection('users').doc(user.uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        const userEmail = user.email;
                        const isDev = devEmails.includes(userEmail);
                        let displayName = user.displayName || user.email;

                        // Create the updated display name with "DEV" or "BASIC" tag if necessary
                        let newDisplayName = displayName;
                        let shouldUpdateFirestore = false;

                        if (isDev && !displayName.includes('<span class="dev-tag">DEV</span>')) {
                            newDisplayName += ' <span class="dev-tag">DEV</span>';
                            shouldUpdateFirestore = true;  // Mark to update Firestore
                        } else if (!isDev && !displayName.includes('<span class="basic-tag">Basic</span>')) {
                            newDisplayName += ' <span class="basic-tag">Basic</span>';
                        }

                        // Update the UI with the user's display name (safely with innerHTML)
                        document.getElementById('username').innerHTML = newDisplayName;
                        document.getElementById('friendDisplayName').innerHTML = newDisplayName;

                        // Optionally update the Firestore document if the "DEV" tag was added or updated
                        if (shouldUpdateFirestore) {
                            return db.collection('users').doc(user.uid).update({
                                displayName: newDisplayName
                            }).then(() => {
                                
                            });
                        }
                    }
                })
                .catch((error) => {
                    console.error("Error fetching user data:", error);
                });
        }
    });
});


function addFriend() {
    const friendEmail = document.getElementById('friendEmail').value;
    const currentUser = firebase.auth().currentUser;

    if (friendEmail && currentUser) {
        const userId = currentUser.uid;

        // Check if the email belongs to a registered user
        db.collection('users').where('email', '==', friendEmail).get()
            .then((querySnapshot) => {
                if (querySnapshot.empty) {
                    // If no user is found, show an alert
                    alert('No registered user with this email exists.');
                    return;
                }

                // If the user is found, proceed with sending the friend request
                const recipientDoc = querySnapshot.docs[0];
                const recipientId = recipientDoc.id;

                // Check if a friend request is already sent or pending
                db.collection('friendRequests')
                    .where('senderId', '==', userId)
                    .where('recipientId', '==', recipientId)
                    .where('status', '==', 'pending')
                    .get()
                    .then((snapshot) => {
                        if (!snapshot.empty) {
                            alert('Friend request already sent!');
                        } else {
                            // Send a new friend request
                            db.collection('friendRequests').add({
                                senderId: userId,
                                recipientId: recipientId,
                                status: 'pending',
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            }).then(() => {
                                
                                alert('Friend request sent!');
                            }).catch((error) => {
                                console.error('Error sending friend request:', error);
                            });
                        }
                    })
                    .catch((error) => {
                        console.error('Error checking existing friend requests:', error);
                    });

            })
            .catch((error) => {
                console.error('Error fetching user data:', error);
                alert('Error fetching user data. Please try again.');
            });
    } else {
        alert('Please enter a valid email.');
    }
}


function listenForFriendRequests() {
    const currentUser = firebase.auth().currentUser;

    if (currentUser) {
        const userId = currentUser.uid;

        db.collection('friendRequests').where('recipientId', '==', userId)
            .onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added') {
                        const friendRequest = change.doc.data();
                        if (friendRequest.status === 'pending') {
                            getUserEmail(friendRequest.senderId).then((email) => {
                                showAcceptPopup(email, change.doc.id);
                            });
                        }
                    }
                });
            });
    }
}

function showAcceptPopup(senderEmail, requestId) {
    if (confirm(`You have a new friend request from ${senderEmail}. Do you want to accept it?`)) {
        acceptFriendRequest(requestId, senderEmail);
    } else {
        
    }
}

function acceptFriendRequest(requestId, senderEmail) {
    const currentUser = firebase.auth().currentUser;

    if (currentUser) {
        const userId = currentUser.uid;

        // Update the friend request status to accepted
        db.collection('friendRequests').doc(requestId).update({
            status: 'accepted'
        }).then(() => {
            
            
            // Add both users to accepted friends
            addToAcceptedFriends(userId, senderEmail);
            
            // Open a chat with the sender
            openChat(senderEmail);
            
            // Update the online friends list
            loadOnlineFriends();
        }).catch((error) => {
            console.error('Error accepting friend request:', error);
        });
    }
}

function addToAcceptedFriends(userId, senderEmail) {
    const currentUser = firebase.auth().currentUser;

    if (currentUser) {
        const currentUserId = currentUser.uid;
        
        // Fetch the recipient's user document
        db.collection('users').where('email', '==', senderEmail).get()
            .then((querySnapshot) => {
                if (!querySnapshot.empty) {
                    const recipientDoc = querySnapshot.docs[0];
                    const recipientId = recipientDoc.id;
                    
                    // Add sender to recipient's accepted friends
                    db.collection('users').doc(recipientId).update({
                        acceptedFriends: firebase.firestore.FieldValue.arrayUnion(currentUser.email)
                    }).catch((error) => {
                        console.error('Error updating recipient’s accepted friends list:', error);
                    });
                    
                    // Add recipient to sender's accepted friends
                    db.collection('users').doc(currentUserId).update({
                        acceptedFriends: firebase.firestore.FieldValue.arrayUnion(senderEmail)
                    }).catch((error) => {
                        console.error('Error updating sender’s accepted friends list:', error);
                    });
                }
            })
            .catch((error) => {
                console.error('Error fetching recipient data:', error);
            });
    }
}



function refreshOnlineFriends() {
    loadOnlineFriends();
}

document.getElementById('refreshButton').addEventListener('click', () => {
    refreshOnlineFriends();

    // Optional: Add a simple rotation animation
    const button = document.getElementById('refreshButton');
    button.style.transition = 'transform 0.5s ease-in-out';
    button.style.transform = 'rotate(360deg)';

    setTimeout(() => {
        button.style.transform = 'none';
    }, 500);
});

function loadOnlineFriends() {
    const currentUser = firebase.auth().currentUser;

    if (currentUser) {
        const currentUserEmail = currentUser.email;
        const acceptedFriends = new Set();
        const displayNameMap = new Map();
        const pinnedFriendsSet = new Set();
        const onlineFriendsList = document.getElementById('onlineFriends');
        const friendElementsMap = new Map(); // Map to track added friends

        // Fetch the current user's accepted friends
        db.collection('users').where('email', '==', currentUserEmail).get()
            .then((querySnapshot) => {
                if (!querySnapshot.empty) {
                    const userDoc = querySnapshot.docs[0];
                    const data = userDoc.data();

                    if (data.acceptedFriends) {
                        data.acceptedFriends.forEach((email) => {
                            acceptedFriends.add(email);
                            displayNameMap.set(email, null); // Initialize with null
                        });
                    }

                    if (data.pinnedFriends) {
                        data.pinnedFriends.forEach((email) => {
                            pinnedFriendsSet.add(email);
                        });
                    }

                    // Listen for updates to the users collection
                    db.collection('users').onSnapshot((snapshot) => {
                        // Clear the list first to avoid duplication
                        onlineFriendsList.innerHTML = '';

                        // Clear the tracking map since we're rebuilding the list
                        friendElementsMap.clear();

                        snapshot.forEach((doc) => {
                            const friend = doc.data();
                            const friendEmail = friend.email;
                            let friendDisplayName = (friend.displayName === 'Anonymous') ? friend.email : friend.displayName;

                            if (acceptedFriends.has(friendEmail) && friendEmail !== currentUserEmail) {
                                if (!friendElementsMap.has(friendEmail)) {
                                    // Create the list item for the friend
                                    const listItem = document.createElement('li');
                                    listItem.classList.add('friend-item');

                                    // Create user avatar container
                                    const avatarContainer = document.createElement('div');
                                    avatarContainer.classList.add('user-avatar');
                                    loadFriendProfilePicture(friendEmail, avatarContainer);

                                    // Set the friend name and avatar when clicked
                                    listItem.addEventListener('click', () => {
                                        updateChatHeader(friendDisplayName, friendEmail, false); // false indicates it's a friend
                                    });

                                    // Create span for friend's name
                                    const friendName = document.createElement('span');
                                    friendName.innerHTML = friendDisplayName;
                                    friendName.classList.add('friend-name');
                                    friendName.onclick = () => openChat(friendEmail);

                                    // Create the latest message span with a tag-like style
                                    const latestMessageSpan = document.createElement('span');
                                    latestMessageSpan.classList.add('latest-message');
                                    latestMessageSpan.innerHTML = 'Loading...';
                                    latestMessageSpan.onclick = () => openChat(friendEmail); // Add the onclick function

                                    // Create the status icon
                                    const statusIcon = document.createElement('span');
                                    statusIcon.classList.add('status-icon');
                                    updateStatusIcon(friend.online, statusIcon);
                
                                        // Create and append Unfriend button
                                        const unfriendButton = createUnfriendButton(friendEmail);

                                        // Create the 'View Friend Info' button
const viewFriendInfoButton = document.createElement('button');
viewFriendInfoButton.innerHTML = `
    <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" width="20" height="20"> <!-- Fill set to white -->
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path fill="#ffffff" d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296-44.096 0-108.992 44.736-148.48 101.504 0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04 67.84 0 107.904-43.648 147.456-100.416z"></path>
        </g>
    </svg>
`;

viewFriendInfoButton.style.backgroundColor = 'var(--primary-color)';
viewFriendInfoButton.style.border = 'none';
viewFriendInfoButton.style.borderRadius = '50%';
viewFriendInfoButton.style.marginLeft = '8px';
viewFriendInfoButton.style.marginRight = '0';
viewFriendInfoButton.style.padding = '6px';
viewFriendInfoButton.style.cursor = 'pointer';
viewFriendInfoButton.style.display = 'flex';
viewFriendInfoButton.style.alignItems = 'center';
viewFriendInfoButton.style.justifyContent = 'center';


                                        viewFriendInfoButton.addEventListener('mouseover', () => {
                                            viewFriendInfoButton.style.backgroundColor = '#3b7bce';
                                        });

                                        viewFriendInfoButton.addEventListener('mouseout', () => {
                                            viewFriendInfoButton.style.backgroundColor = 'var(--primary-color)';
                                        });

                                        viewFriendInfoButton.onclick = () => {
                                            const modal = document.getElementById('viewFriendModal');
                                            modal.style.display = 'block';
                                            document.getElementById('friendDisplayName').textContent = friendDisplayName;
                                            document.getElementById('friendEmail').textContent = friendEmail;
                                            document.getElementById('editFriendName').value = friendDisplayName;

                                            document.getElementById('saveFriendName').onclick = () => {
                                                const newFriendName = document.getElementById('editFriendName').value;
                                                if (newFriendName !== friendDisplayName) {
                                                    saveFriendDisplayName(friendEmail, newFriendName);
                                                }
                                                modal.style.display = 'none';
                                            };
                                        };
                                        
                                        // Create the 'Pinned Friends' button
const pinnedFriendsButton = document.createElement('button');
pinnedFriendsButton.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
                        <path fill-rule="evenodd" clip-rule="evenodd" 
                            d="M17.1218 1.87023C15.7573 0.505682 13.4779 0.76575 12.4558 2.40261L9.61062 6.95916C9.61033 6.95965 9.60913 6.96167 9.6038 6.96549C9.59728 6.97016 9.58336 6.97822 9.56001 6.9848C9.50899 6.99916 9.44234 6.99805 9.38281 6.97599C8.41173 6.61599 6.74483 6.22052 5.01389 6.87251C4.08132 7.22378 3.61596 8.03222 3.56525 8.85243C3.51687 9.63502 3.83293 10.4395 4.41425 11.0208L7.94975 14.5563L1.26973 21.2363C0.879206 21.6269 0.879206 22.26 1.26973 22.6506C1.66025 23.0411 2.29342 23.0411 2.68394 22.6506L9.36397 15.9705L12.8995 19.5061C13.4808 20.0874 14.2853 20.4035 15.0679 20.3551C15.8881 20.3044 16.6966 19.839 17.0478 18.9065C17.6998 17.1755 17.3043 15.5086 16.9444 14.5375C16.9223 14.478 16.9212 14.4114 16.9355 14.3603C16.9421 14.337 16.9502 14.3231 16.9549 14.3165C16.9587 14.3112 16.9606 14.31 16.9611 14.3098L21.5177 11.4645C23.1546 10.4424 23.4147 8.16307 22.0501 6.79853L17.1218 1.87023Z" 
                            fill="#ffffff"></path> 
                    </svg>
`;

pinnedFriendsButton.style.backgroundColor = 'var(--primary-color)';
pinnedFriendsButton.style.border = 'none';
pinnedFriendsButton.style.borderRadius = '50%';
pinnedFriendsButton.style.marginLeft = '8px';
pinnedFriendsButton.style.marginRight = '0';
pinnedFriendsButton.style.padding = '6px';
pinnedFriendsButton.style.cursor = 'pointer';
pinnedFriendsButton.style.display = 'flex';
pinnedFriendsButton.style.alignItems = 'center';
pinnedFriendsButton.style.justifyContent = 'center';

pinnedFriendsButton.addEventListener('mouseover', () => {
    pinnedFriendsButton.style.backgroundColor = '#3b7bce';
});

pinnedFriendsButton.addEventListener('mouseout', () => {
    pinnedFriendsButton.style.backgroundColor = 'var(--primary-color)';
});

// Add click event to handle pinning functionality
pinnedFriendsButton.onclick = () => {
    const currentUser = firebase.auth().currentUser;
    if (currentUser) {
        const currentUserUID = currentUser.uid;
        const pinnedUserEmail = friendEmail;

        // Reference to the current user's document in the 'pinnedFriends' collection
        const userRef = db.collection('pinnedFriends').doc(currentUserUID);

        // Get the user's pinned friends
        userRef.get()
            .then((doc) => {
                let pinnedFriends = [];
                if (doc.exists) {
                    pinnedFriends = doc.data().pinnedFriends || [];
                } else {
                    // If the document doesn't exist, create it with an empty pinnedFriends array
                    userRef.set({ pinnedFriends: [] });
                }

                // Add the pinned friend's email if not already in the list
                if (!pinnedFriends.includes(pinnedUserEmail)) {
                    pinnedFriends.push(pinnedUserEmail);

                    // Update the user's pinned friends list in Firestore
                    return userRef.update({
                        pinnedFriends: pinnedFriends
                    });
                } else {
                    
                }
            })
            .then(() => {
                // Refresh the list of pinned friends after updating Firestore
                loadPinnedFriends();
            })
            .catch((error) => {
                console.error('Error pinning friend: ', error);
            });
    } else {
        console.error('User not authenticated');
    }
};

const onlineFriendsList = document.getElementById('onlineFriends');
if (!onlineFriendsList) {
    console.error("onlineFriends element not found.");
    return;
}

                                        // Add click event to open chat
                                        friendName.onclick = () => openChat(friendEmail);

                                        // Append the elements to the list item
                                    listItem.appendChild(statusIcon);
                                    listItem.appendChild(avatarContainer);
                                    listItem.appendChild(friendName);
                                    listItem.appendChild(latestMessageSpan);
                                    listItem.appendChild(pinnedFriendsButton);
                                    listItem.appendChild(viewFriendInfoButton);
                                    listItem.appendChild(unfriendButton);
                                    
                                    onlineFriendsList.appendChild(listItem);

                                     // Track this friend element
                                    friendElementsMap.set(friendEmail, { listItem, latestMessageSpan });

// Fetch the latest message for this friend
const chatId = getChatId(currentUserEmail, friendEmail);
db.collection('chats').doc(chatId).collection('messages')
    .orderBy('timestamp', 'desc')
    .limit(1)
    .onSnapshot((messagesSnapshot) => {
        if (!messagesSnapshot.empty) {
            const latestMessageDoc = messagesSnapshot.docs[0];
            const latestMessageData = latestMessageDoc.data();
            const latestMessageText = latestMessageData.message || '';
            const senderEmail = latestMessageData.sender;

            // Update the latest message span
            latestMessageSpan.innerHTML = latestMessageText;

            // Apply styles based on whether the message is sent by the current user or received
            if (senderEmail === currentUserEmail) {
                latestMessageSpan.style.backgroundColor = 'var(--primary-color)';
            } else {
                latestMessageSpan.style.backgroundColor = 'var(--accent-color)';
            }

            // Ensure the text color remains readable
            latestMessageSpan.style.color = 'var(--text-color)';
        } else {
            latestMessageSpan.innerHTML = 'No messages yet';
            latestMessageSpan.style.backgroundColor = 'var(--primary-color)'; // Default color for no messages
            latestMessageSpan.style.color = 'var(--text-color)';
        }
    });


                                }
                            }
                        });
                    });
                }
            });
    }
}

function refreshOnlineFriends() {
    loadPinnedFriends(); // Call the loadPinnedFriends function here
    loadPinnedGroups();
    loadOnlineFriends();
}

document.getElementById('refreshPinnedButton').addEventListener('click', () => {
    refreshOnlineFriends();

    // Optional: Add a simple rotation animation
    const button = document.getElementById('refreshPinnedButton');
    button.style.transition = 'transform 0.5s ease-in-out';
    button.style.transform = 'rotate(360deg)';

    setTimeout(() => {
        button.style.transform = 'none';
    }, 500);
});

function loadPinnedFriends() {
    const currentUser = firebase.auth().currentUser;

    if (currentUser) {
        const currentUserUID = currentUser.uid;

        // Fetch the current user's pinned friends
        db.collection('pinnedFriends').doc(currentUserUID).get()
            .then((doc) => {
                if (doc.exists) {
                    const pinnedFriends = doc.data().pinnedFriends || [];
                    const pinnedFriendsList = document.getElementById('pinnedFriends');
                    pinnedFriendsList.innerHTML = ''; // Clear the list before appending new items

                    pinnedFriends.forEach((friendEmail) => {
                        // Fetch friend's information
                        db.collection('users').where('email', '==', friendEmail).get()
                            .then((querySnapshot) => {
                                querySnapshot.forEach((doc) => {
                                    const friend = doc.data();
                                    const friendDisplayName = friend.displayName === 'Anonymous' ? friend.email : friend.displayName;

                                    const listItem = document.createElement('li');
                                    listItem.classList.add('friend-item');

                                    // Create user avatar container
                                    const avatarContainer = document.createElement('div');
                                    avatarContainer.classList.add('user-avatar');
                                    loadFriendProfilePicture(friendEmail, avatarContainer); // Load friend profile picture

                                    // Create a span for the friend's name
                                    const friendName = document.createElement('span');
                                    friendName.innerHTML = friendDisplayName;
                                    friendName.classList.add('friend-name');
                                    


const statusIcon = document.createElement('span');
statusIcon.classList.add('status-icon');

if (friend.online) {
    statusIcon.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M5.63604 18.3639C2.12132 14.8492 2.12132 9.15071 5.63604 5.63599M18.364 5.63599C21.8787 9.15071 21.8787 14.8492 18.364 18.3639M8.46447 15.5355C6.51184 13.5829 6.51184 10.417 8.46447 8.46441M15.5355 8.46441C17.4882 10.417 17.4882 13.5829 15.5355 15.5355M13 11.9999C13 12.5522 12.5523 12.9999 12 12.9999C11.4477 12.9999 11 12.5522 11 11.9999C11 11.4477 11.4477 10.9999 12 10.9999C12.5523 10.9999 13 11.4477 13 11.9999Z" stroke="green" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>`;
} else {
    statusIcon.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18.364 5.63605C21.8787 9.15077 21.8787 14.8493 18.364 18.364M18.364 18.364L15.5355 15.5355M18.364 18.364L21 21M15.5355 8.46447C17.4882 10.4171 17.4882 13.5829 15.5355 15.5355M15.5355 15.5355L12.7071 12.7071M8.46447 15.5355C7.66839 14.7395 7.19687 13.7417 7.04991 12.7068M5.63604 18.364C3.13732 15.8652 2.41501 12.2628 3.46913 9.12598M11.2929 11.2929C11.4739 11.1119 11.7239 11 12 11C12.5523 11 13 11.4477 13 12C13 12.2761 12.8881 12.5261 12.7071 12.7071M11.2929 11.2929L3 3M11.2929 11.2929L12.7071 12.7071" stroke="#c0392b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>`;
}

                                    // Append the friend's name to the list item
                                    listItem.appendChild(statusIcon);
                                    listItem.appendChild(avatarContainer);
                                    listItem.appendChild(friendName);

                                    // Create and append Unfriend button
                                    const unfriendButton = createUnfriendButton(friendEmail);
                                    listItem.appendChild(unfriendButton);

                                    // Create the 'View Friend Info' button
                                    const viewFriendInfoButton = document.createElement('button');
                                    viewFriendInfoButton.innerHTML = `
                                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000" width="20" height="20">
                                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                            <g id="SVGRepo_iconCarrier">
                                                <defs>
                                                    <style>
                                                        .a,.b{fill:none;stroke:#ffffff;stroke-linecap:round;stroke-width:1.5px;}
                                                        .a{stroke-linejoin:round;}
                                                        .b{stroke-linejoin:bevel;}
                                                    </style>
                                                </defs>
                                                <path class="a" d="M3,21.016l.78984-2.87249C5.0964,13.3918,8.5482,10.984,12,10.984"></path>
                                                <circle class="b" cx="12" cy="5.98404" r="5"></circle>
                                                <circle class="a" cx="17" cy="18" r="5"></circle>
                                                <line class="a" x1="17" x2="17" y1="17.34043" y2="20.51064"></line>
                                                <line class="a" x1="17" x2="17" y1="15.59574" y2="15.51064"></line>
                                            </g>
                                        </svg>
                                    `;

                                    viewFriendInfoButton.style.backgroundColor = 'var(--primary-color)';
                                    viewFriendInfoButton.style.border = 'none';
                                    viewFriendInfoButton.style.borderRadius = '50%';
                                    viewFriendInfoButton.style.marginLeft = '8px';
                                    viewFriendInfoButton.style.marginRight = '0';
                                    viewFriendInfoButton.style.padding = '6px';
                                    viewFriendInfoButton.style.cursor = 'pointer';
                                    viewFriendInfoButton.style.display = 'flex';
                                    viewFriendInfoButton.style.alignItems = 'center';
                                    viewFriendInfoButton.style.justifyContent = 'center';

                                    viewFriendInfoButton.addEventListener('mouseover', () => {
                                        viewFriendInfoButton.style.backgroundColor = '#3b7bce';
                                    });

                                    viewFriendInfoButton.addEventListener('mouseout', () => {
                                        viewFriendInfoButton.style.backgroundColor = 'var(--primary-color)';
                                    });

                                    viewFriendInfoButton.onclick = () => {
                                        const modal = document.getElementById('viewFriendModal');
                                        modal.style.display = 'block';
                                        document.getElementById('friendDisplayName').textContent = friendDisplayName;
                                        document.getElementById('friendEmail').textContent = friendEmail;
                                        document.getElementById('editFriendName').value = friendDisplayName;

                                        document.getElementById('saveFriendName').onclick = () => {
                                            const newFriendName = document.getElementById('editFriendName').value;
                                            if (newFriendName !== friendDisplayName) {
                                                saveFriendDisplayName(friendEmail, newFriendName);
                                            }
                                            modal.style.display = 'none';
                                        };
                                    };

// Create the 'Unpin' button
const unpinButton = document.createElement('button');
unpinButton.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path d="M17.1218 1.87023C15.7573 0.505682 13.4779 0.76575 12.4558 2.40261L9.75191 6.73289L11.1969 8.17793C11.2355 8.1273 11.2723 8.07415 11.3071 8.01845L14.1523 3.46191C14.493 2.91629 15.2528 2.8296 15.7076 3.28445L20.6359 8.21274C21.0907 8.66759 21.0041 9.42737 20.4584 9.76806L15.9019 12.6133C15.8462 12.6481 15.793 12.6848 15.7424 12.7234L17.1874 14.1684L21.5177 11.4645C23.1546 10.4424 23.4147 8.16307 22.0501 6.79852L17.1218 1.87023Z" fill="#ffffff"></path>
            <path d="M3.56525 8.85242C3.6015 8.26612 3.84962 7.68582 4.32883 7.27422L5.77735 8.72274C5.75784 8.72967 5.73835 8.7368 5.71886 8.74414C5.64516 8.7719 5.61855 8.80285 5.60548 8.82181C5.58877 8.84604 5.56651 8.8937 5.56144 8.97583C5.55046 9.15333 5.62872 9.40686 5.82846 9.6066L14.3137 18.0919C14.5135 18.2916 14.767 18.3699 14.9445 18.3589C15.0266 18.3538 15.0743 18.3316 15.0985 18.3149C15.1175 18.3018 15.1484 18.2752 15.1762 18.2015C15.1835 18.182 15.1907 18.1625 15.1976 18.143L16.6461 19.5915C16.2345 20.0707 15.6542 20.3188 15.0679 20.3551C14.2853 20.4035 13.4808 20.0874 12.8995 19.5061L9.36397 15.9705L2.68394 22.6506C2.29342 23.0411 1.66025 23.0411 1.26973 22.6506C0.879206 22.26 0.879206 21.6269 1.26973 21.2363L7.94975 14.5563L4.41425 11.0208C3.83293 10.4395 3.51687 9.63502 3.56525 8.85242Z" fill="#ffffff"></path>
            <path d="M2.00789 2.00786C1.61736 2.39838 1.61736 3.03155 2.00789 3.42207L20.5862 22.0004C20.9767 22.3909 21.6099 22.3909 22.0004 22.0004C22.391 21.6099 22.391 20.9767 22.0004 20.5862L3.4221 2.00786C3.03158 1.61733 2.39841 1.61733 2.00789 2.00786Z" fill="#ffffff"></path>
        </g>
    </svg>
`;
unpinButton.style.backgroundColor = 'var(--primary-color)';
unpinButton.style.border = 'none';
unpinButton.style.borderRadius = '50%';
unpinButton.style.marginLeft = '8px';
unpinButton.style.marginRight = '0';
unpinButton.style.padding = '6px';
unpinButton.style.cursor = 'pointer';
unpinButton.style.display = 'flex';
unpinButton.style.alignItems = 'center';
unpinButton.style.justifyContent = 'center';

unpinButton.addEventListener('mouseover', () => {
    unpinButton.style.backgroundColor = '#3b7bce';
});

unpinButton.addEventListener('mouseout', () => {
    unpinButton.style.backgroundColor = 'var(--primary-color)';
});

unpinButton.onclick = () => {
    const currentUser = firebase.auth().currentUser;
    if (currentUser) {
        const currentUserUID = currentUser.uid;
        
        // Get the friend's email to unpin
        const friendEmailToUnpin = friendEmail; // Use the variable for friend's email

        // Fetch the current user's pinned friends
        db.collection('pinnedFriends').doc(currentUserUID).get()
            .then((doc) => {
                if (doc.exists) {
                    let pinnedFriends = doc.data().pinnedFriends || [];
                    
                    // Remove the friend from the pinned friends list
                    pinnedFriends = pinnedFriends.filter(email => email !== friendEmailToUnpin);
                    
                    // Update the pinned friends list in Firestore
                    return db.collection('pinnedFriends').doc(currentUserUID).update({
                        pinnedFriends: pinnedFriends
                    });
                } else {
                    
                }
            })
            .then(() => {
                
                // Optionally, you can refresh the list of pinned friends to reflect changes
                loadPinnedFriends();
            })
            .catch((error) => {
                console.error('Error unpinning friend:', error);
            });
    } else {
        
    }
};


                                        // Add click event to open chat
                                        friendName.onclick = () => openChat(friendEmail);

                                    // Append buttons to the list item
                                    
                                    listItem.appendChild(unpinButton);
                                    listItem.appendChild(viewFriendInfoButton);
                                    listItem.appendChild(unfriendButton);


                                    // Append the list item to the pinnedFriendsList
                                    pinnedFriendsList.appendChild(listItem);
                                });
                            });
                    });
                } else {
                    
                }
            })
            .catch((error) => {
                console.error('Error fetching pinned friends:', error);
            });
    }
}

// Ensure this is called initially to load pinned friends on page load
refreshOnlineFriends();

        
function togglePinnedFriend(friendEmail, friendDisplayName, pinnedFriendsSet) {
    const currentUser = firebase.auth().currentUser;

    if (currentUser) {
        const currentUserEmail = currentUser.email;
        const userRef = db.collection('users').doc(currentUserEmail);

        userRef.get()
            .then((doc) => {
                if (doc.exists) {
                    const userData = doc.data();
                    let pinnedFriends = userData.pinnedFriends || [];

                    if (pinnedFriendsSet.has(friendEmail)) {
                        // Unpin friend
                        pinnedFriends = pinnedFriends.filter(email => email !== friendEmail);
                        pinnedFriendsSet.delete(friendEmail);
                    } else {
                        // Pin friend
                        pinnedFriends.push(friendEmail);
                        pinnedFriendsSet.add(friendEmail);
                    }

                    // Update the user's pinned friends list in Firestore
                    return userRef.update({
                        pinnedFriends: pinnedFriends
                    });
                } else {
                    console.error('User document does not exist');
                }
            })
            .then(() => {
                
                refreshOnlineFriends(); // Refresh the friends list
            })
            .catch((error) => {
                console.error('Error updating pinned friends:', error);
            });
    } else {
        console.error('No user is signed in.');
    }
}

// Function to update the status icon
function updateStatusIcon(isOnline, statusIcon) {
    if (isOnline) {
        statusIcon.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5.63604 18.3639C2.12132 14.8492 2.12132 9.15071 5.63604 5.63599M18.364 5.63599C21.8787 9.15071 21.8787 14.8492 18.364 18.3639M8.46447 15.5355C6.51184 13.5829 6.51184 10.417 8.46447 8.46441M15.5355 8.46441C17.4882 10.417 17.4882 13.5829 15.5355 15.5355M13 11.9999C13 12.5522 12.5523 12.9999 12 12.9999C11.4477 12.9999 11 12.5522 11 11.9999C11 11.4477 11.4477 10.9999 12 10.9999C12.5523 10.9999 13 11.4477 13 11.9999Z" stroke="green" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`;
    } else {
        statusIcon.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18.364 5.63605C21.8787 9.15077 21.8787 14.8493 18.364 18.364M18.364 18.364L15.5355 15.5355M18.364 18.364L21 21M15.5355 8.46447C17.4882 10.4171 17.4882 13.5829 15.5355 15.5355M15.5355 15.5355L12.7071 12.7071M8.46447 15.5355C7.66839 14.7395 7.19687 13.7417 7.04991 12.7068M5.63604 18.364C3.13732 15.8652 2.41501 12.2628 3.46913 9.12598M11.2929 11.2929C11.4739 11.1119 11.7239 11 12 11C12.5523 11 13 11.4477 13 12C13 12.2761 12.8881 12.5261 12.7071 12.7071M11.2929 11.2929L3 3M11.2929 11.2929L12.7071 12.7071" stroke="#c0392b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`;
    }
}

function createUnfriendButton(friendEmail) {
    const button = document.createElement('button');
    button.className = 'unfriend-button';
    button.onclick = () => unfriendUser(friendEmail);

    // Create SVG element
    const svgNS = 'http://www.w3.org/2000/svg';
    const svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('viewBox', '0 0 1024 1024'); // Updated viewBox from your provided SVG
    svg.setAttribute('xmlns', svgNS);
    svg.setAttribute('fill', '#ffffff'); // Set the fill color to white

    // Create the path for the outer circle and the "X"
    const path = document.createElementNS(svgNS, 'path');
    path.setAttribute('fill', '#ffffff'); // Set the "X" and circle to white
    path.setAttribute('d', 'M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336L512 457.664z');

    // Append path to the SVG
    svg.appendChild(path);

    // Append the SVG to the button
    button.appendChild(svg);

    return button;
}


function createViewFriendInfoButton(friendEmail, friendDisplayName) {
    const button = document.createElement('button');
    button.classList.add('view-friend-info-button');

    // Add SVG directly into the button
    button.innerHTML = `
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><defs><style>.a,.b{fill:none;stroke:#ffffff;stroke-linecap:round;stroke-width:1.5px;}.a{stroke-linejoin:round;}.b{stroke-linejoin:bevel;}</style></defs><path class="a" d="M3,21.016l.78984-2.87249C5.0964,13.3918,8.5482,10.984,12,10.984"></path><circle class="b" cx="12" cy="5.98404" r="5"></circle><circle class="a" cx="17" cy="18" r="5"></circle><line class="a" x1="17" x2="17" y1="17.34043" y2="20.51064"></line><line class="a" x1="17" x2="17" y1="15.59574" y2="15.51064"></line></g></svg>
    `;

    button.onclick = () => {
        // Open the modal and display the friend's information
        const modal = document.getElementById('viewFriendModal');
        modal.style.display = 'block';
        document.getElementById('friendDisplayName').textContent = friendDisplayName;
        document.getElementById('friendEmail').textContent = friendEmail;
        document.getElementById('editFriendName').value = friendDisplayName;

        // Save the new friend display name
        document.getElementById('saveFriendName').onclick = () => {
            const newFriendName = document.getElementById('editFriendName').value;
            if (newFriendName !== friendDisplayName && newFriendName.trim() !== "") {
                // Logic to save the new friendDisplayName for the current user only
                saveFriendDisplayName(friendEmail, newFriendName)
                    .then(() => {
                        document.getElementById('friendDisplayName').textContent = newFriendName;
                    })
                    .catch((error) => {
                        console.error("Error saving new friend name: ", error);
                    });
            }
            modal.style.display = 'none';
        };
    };

    return button;
}


// Function to save the edited friendDisplayName for the current user
function saveFriendDisplayName(friendEmail, newFriendName) {
    const currentUser = firebase.auth().currentUser;
    if (currentUser) {
        const currentUserEmail = currentUser.email;
        db.collection('users').where('email', '==', currentUserEmail).get()
            .then((querySnapshot) => {
                if (!querySnapshot.empty) {
                    const userDoc = querySnapshot.docs[0];
                    userDoc.ref.update({
                        [`friendDisplayNames.${friendEmail}`]: newFriendName
                    }).then(() => {
                        
                    });
                }
            });
    }
}

// Close the modal
document.querySelector('.close-button3').onclick = function() {
    document.getElementById('viewFriendModal').style.display = 'none';
};


function unfriendUser(friendEmail) {
    const currentUser = firebase.auth().currentUser;

    if (currentUser) {
        const currentUserId = currentUser.uid;

        // Fetch the friend's user document
        db.collection('users').where('email', '==', friendEmail).get()
            .then((querySnapshot) => {
                if (!querySnapshot.empty) {
                    const friendDoc = querySnapshot.docs[0];
                    const friendId = friendDoc.id;
                    const friendDisplayName = friendDoc.data().displayName; // Assume displayName is stored in user data

                    // Show confirmation popup
                    const confirmation = confirm(`Are you sure you want to unfriend ${friendDisplayName}?`);

                    if (confirmation) {
                        // Update current user's accepted friends list
                        db.collection('users').doc(currentUserId).update({
                            acceptedFriends: firebase.firestore.FieldValue.arrayRemove(friendEmail)
                        }).catch((error) => {
                            console.error('Error removing from current user’s accepted friends list:', error);
                        });

                        // Update friend's accepted friends list
                        db.collection('users').doc(friendId).update({
                            acceptedFriends: firebase.firestore.FieldValue.arrayRemove(currentUser.email)
                        }).catch((error) => {
                            console.error('Error removing from friend’s accepted friends list:', error);
                        });

                        // Refresh the list of online friends
                        loadOnlineFriends();
                        loadPinnedFriends();
                    }
                }
            })
            .catch((error) => {
                console.error('Error fetching friend data:', error);
            });
    }
}


document.addEventListener("DOMContentLoaded", function() {
    const chatInputElement = document.getElementById('chatInput');
    const sendButton = document.querySelector('.chat-window button');
    const chatMessagesElement = document.getElementById('chatMessages');
    
    let chatId = ''; // Define chatId variable here

    // Function to update chatId based on the current chat
    function updateChatId(userEmail, chatFriend) {
        chatId = getChatId(userEmail, chatFriend);
        setupMessageListener(); // Set up message listener with the new chatId
    }

function sendMessage() {
    const chatInput = chatInputElement.value.trim();
    const currentUser = firebase.auth().currentUser;

    if (!chatInput || !currentUser) return; // Exit if no input or no current user

    if (currentGroupId) {
        // Sending a message to a group
        db.collection('groupchats').doc(currentGroupId).collection('messages').add({
            sender: currentUser.email,
            message: chatInput,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            chatInputElement.value = ''; // Clear the input field after sending
        }).catch((error) => {
            console.error('Error sending group message: ', error);
        });
    } else if (currentChatFriend) {
        // Sending a message to an individual
        if (!chatId) {
            updateChatId(currentUser.email, currentChatFriend); // Ensure chatId is set
            // Wait for chatId to be updated before sending the message
            return; // Exit the function to wait for the chatId update
        }

        db.collection('chats').doc(chatId).collection('messages').add({
            sender: currentUser.email,
            recipient: currentChatFriend,
            message: chatInput,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            chatInputElement.value = ''; // Clear the input field after sending
        }).catch((error) => {
            console.error('Error sending message: ', error);
        });
    } else {
        console.error('No recipient or group chat selected.');
    }
}

function scrollToBottom() {
    chatMessagesElement.scrollTop = chatMessagesElement.scrollHeight;
}

function setupMessageListener() {
    if (chatId) {
        db.collection('chats').doc(chatId).collection('messages')
            .orderBy('timestamp')
            .onSnapshot(snapshot => {
                snapshot.docChanges().forEach(change => {
                    if (change.type === 'added') {
                        // Code to display the message
                        scrollToBottom(); // Scroll to the bottom when a new message is added
                    }
                });
            });
    } else if (currentGroupId) {
        db.collection('groupchats').doc(currentGroupId).collection('messages')
            .orderBy('timestamp')
            .onSnapshot(snapshot => {
                snapshot.docChanges().forEach(change => {
                    if (change.type === 'added') {
                        // Code to display the message
                        scrollToBottom(); // Scroll to the bottom when a new message is added
                    }
                });
            });
    }
}

// Send message when the "Send" button is clicked
sendButton.addEventListener('click', sendMessage);

// Send message when the "Enter" key is pressed
chatInputElement.addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
        event.preventDefault(); // Prevents the default behavior of the "Enter" key
        sendMessage();
    }
});

// Example function to start or switch chats
function startChat(friendEmail) {
    const currentUser = firebase.auth().currentUser;
    if (currentUser) {
        updateChatId(currentUser.email, friendEmail);
    }
}

    // Use startChat(friendEmail) when starting or switching chats
});


// Request notification permission
if (Notification.permission === 'default') {
    Notification.requestPermission().then((permission) => {
        if (permission !== 'granted') {
            console.log('Notification permission denied');
        }
    });
}
        
let replies = {};

// Store the active listener unsubscribe function
let unsubscribeFromMessages = null;
let lastNotifiedMessageId = null; // Track the ID of the last notified message

function openChat(friendEmail) {
    const chatWithSpan = document.getElementById('chatWith');
    const chatWindow = document.getElementById('chatMessages');
    const currentUser = firebase.auth().currentUser;
    const chatId = getChatId(currentUser.email, friendEmail);

    currentChatFriend = friendEmail;

    // Unsubscribe from any existing listener before setting a new one
    if (unsubscribeFromMessages) {
        unsubscribeFromMessages();
    }

    db.collection('users').where('email', '==', friendEmail).get()
        .then((querySnapshot) => {
            if (!querySnapshot.empty) {
                const friendDoc = querySnapshot.docs[0];
                const friendDisplayName = (friendDoc.data().displayName === 'Anonymous') ? friendEmail : friendDoc.data().displayName;
                chatWithSpan.innerHTML = friendDisplayName;

                // Set up a new listener
                unsubscribeFromMessages = db.collection('chats').doc(chatId).collection('messages')
                    .orderBy('timestamp', 'asc')
                    .onSnapshot((querySnapshot) => {
                        chatWindow.innerHTML = '';

                        // Get the latest message
                        const latestMessageDoc = querySnapshot.docs[querySnapshot.docs.length - 1];
                        
                        querySnapshot.forEach((doc) => {
                            const message = doc.data();
                            const messageId = doc.id;
                            const senderEmail = message.sender;
                            const messageDiv = document.createElement('div');
                            messageDiv.classList.add('message-container');

                            // Sender display name
                            if (senderEmail !== currentUser.email) {
                                db.collection('users').where('email', '==', senderEmail).get()
                                    .then((querySnapshot) => {
                                        const senderDoc = querySnapshot.docs[0];
                                        const senderDisplayName = (senderDoc.data().displayName === 'Anonymous') ? senderEmail : senderDoc.data().displayName;
                                        
                                        // Show notification only for the latest message and avoid duplicate notifications
                                        if (doc.id === latestMessageDoc.id && Notification.permission === 'granted' && messageId !== lastNotifiedMessageId) {
                                            lastNotifiedMessageId = messageId; // Update the last notified message ID
                                            showNotification(senderDisplayName, message.message);
                                        }
                                    });
                            }

                            const textElement = document.createElement('span');
                            textElement.classList.add('message-text');
                            textElement.textContent = message.message;
                            messageDiv.appendChild(textElement);

                            if (senderEmail === currentUser.email) {
                                messageDiv.classList.add('message', 'sent');
                            } else {
                                messageDiv.classList.add('message', 'received');
                            }
                            
                            // Add options for reply and reactions
                            const optionsContainer = document.createElement('div');
                            optionsContainer.classList.add('message-options');
                            optionsContainer.style.display = 'none'; // Initially hidden

                            // Reaction options in the specified order
                            const reactions = ['❤️', '👍', '👎', '😆', '‼️', '?'];
                            reactions.forEach(reaction => {
                                const reactionButton = document.createElement('button');
                                reactionButton.textContent = reaction;
                                reactionButton.classList.add('reaction-button');
                                reactionButton.addEventListener('click', () => {
                                    addReactionToMessageV2(chatId, messageId, reaction);
                                });
                                optionsContainer.appendChild(reactionButton);
                            });

                            // Remove Reaction option
                            const removeReactionButton = document.createElement('button');
                            removeReactionButton.textContent = 'Remove'; // Changed from '❌' to 'Remove'
                            removeReactionButton.classList.add('remove-reaction-button');
                            removeReactionButton.addEventListener('click', () => {
                                removeReactionFromMessageV2(chatId, messageId);
                            });
                            optionsContainer.appendChild(removeReactionButton);

                            // Reply option (moved after the remove button)
                            const replyOption = document.createElement('button');
                            replyOption.textContent = 'Reply';
                            replyOption.classList.add('reply-option');
                            replyOption.addEventListener('click', (event) => {
                            event.stopPropagation(); // Prevent the click from affecting the parent elements
                            openReplyModal(chatId, messageId, message.message);
                            });
                            optionsContainer.appendChild(replyOption);

                            messageDiv.appendChild(optionsContainer);

                            messageDiv.addEventListener('click', () => {
                                optionsContainer.style.display = optionsContainer.style.display === 'none' ? 'flex' : 'none';
                            });

                            chatWindow.appendChild(messageDiv);

                            // Load reactions for this message
                            loadReactionsV2(chatId, messageId, messageDiv);

                            // Load replies for this message
                            loadReplies(chatId, messageId, messageDiv);

                            // Scroll to the bottom of the chat window after a new message is added
                            chatWindow.scrollTop = chatWindow.scrollHeight;

                            checkCurrentFriendChat();
                        });
                    });
            }
        })
        .catch((error) => {
            console.error('Error fetching user data:', error);
        });
}

// Helper function to show notifications with cross-browser support
function showNotification(senderDisplayName, message) {
    const notificationOptions = {
        body: message,
        icon: 'https://firebasestorage.googleapis.com/v0/b/deepworkai-c3419.appspot.com/o/apple-touch-icon.png?alt=media&token=3f0a1187-813a-403f-aa4f-5c0ccd58c16c'
    };

    // For standard notifications
    if ("Notification" in window) {
        new Notification(` ${senderDisplayName}`, notificationOptions);
    }
    // For older Safari versions
    else if ("webkitNotifications" in window) {
        window.webkitNotifications.createNotification(
            notificationOptions.icon,
            ` ${senderDisplayName}`,
            message
        ).show();
    }
}

function openReplyModal(chatId, messageId, originalMessage) {
    const modal = document.getElementById('modal4');
    const modalMessage = document.getElementById('modal4Message');
    
    // Clear previous replies
    modalMessage.innerHTML = `<p>Replies to: "${originalMessage}"</p>`;
    
    // Fetch replies from Firestore
    db.collection('replies').where('messageId', '==', messageId).orderBy('timestamp', 'asc').get()
        .then((querySnapshot) => {
            // Array to store promises for fetching display names
            const replyPromises = [];

            querySnapshot.forEach((doc) => {
                const replyData = doc.data();
                const replyText = replyData.replyText;
                const senderEmail = replyData.sender;

                // Create a promise to fetch the display name from the users collection
                const userPromise = db.collection('users').where('email', '==', senderEmail).limit(1).get()
                    .then((userSnapshot) => {
                        if (!userSnapshot.empty) {
                            const userDoc = userSnapshot.docs[0];
                            const displayName = userDoc.data().displayName || senderEmail; // Use email if no display name
                            
                            // Create and append the reply element
                            const replyElement = document.createElement('p');
                            replyElement.textContent = `${displayName}: ${replyText}`;
                            modalMessage.appendChild(replyElement);
                        } else {
                            // If no user found, fallback to email
                            const replyElement = document.createElement('p');
                            replyElement.textContent = `${senderEmail}: ${replyText}`;
                            modalMessage.appendChild(replyElement);
                        }
                    })
                    .catch((error) => {
                        console.error('Error fetching user data:', error);
                    });

                // Add the promise to the array
                replyPromises.push(userPromise);
            });

            // Wait for all user lookups to complete
            return Promise.all(replyPromises);
        })
        .then(() => {
            // Once all replies are processed, show the modal
            modal.style.display = "block";
        })
        .catch((error) => {
            console.error('Error fetching replies from Firestore:', error);
        });

    const sendReplyButton = document.getElementById('sendReplyButton');
    sendReplyButton.onclick = () => {
        const replyText = document.getElementById('replyInput').value.trim();
        if (replyText) {
            addReplyToMessage(chatId, messageId, replyText);
            document.getElementById('replyInput').value = ''; // Clear the text area
        }
        modal.style.display = "none";
    };

    // Close the modal when clicking anywhere outside the modal content
    window.onclick = (event) => {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    };
}


function addReplyToMessage(chatId, messageId, replyText) {
    const currentUser = firebase.auth().currentUser;
    
    if (!currentUser) {
        console.error('No current user logged in.');
        return;
    }

    // Add the reply to Firestore under the 'replies' collection
    db.collection('replies').add({
        chatId: chatId,
        messageId: messageId,
        sender: currentUser.email,
        replyText: replyText.trim(),
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
        
        
        const messageDiv = document.querySelector(`[data-message-id="${messageId}"]`);
        if (messageDiv) {
            // Load and display replies for the updated message
            loadReplies(chatId, messageId, messageDiv); // Refresh replies and reply count
            
            // Fetch the updated count of replies
            db.collection('replies').where('messageId', '==', messageId).get().then((querySnapshot) => {
                const replyCount = querySnapshot.size;
                let replyCountText = messageDiv.querySelector('.reply-count');

                if (replyCountText) {
                    replyCountText.textContent = formatReplyCount(replyCount);
                } else {
                    replyCountText = document.createElement('span');
                    replyCountText.classList.add('reply-count');
                    replyCountText.textContent = formatReplyCount(replyCount);
                    messageDiv.appendChild(replyCountText);

                    // Add an event listener to the reply count to open the modal
                    replyCountText.addEventListener('click', (event) => {
                        event.preventDefault();
                        event.stopPropagation();
                        openReplyModal(chatId, messageId, replyText);
                    });
                }
            }).catch((error) => {
                console.error('Error fetching reply count from Firestore:', error);
            });
        } else {
            console.error('Message div not found for messageId:', messageId);
        }
    })
    .catch((error) => {
        console.error('Error adding reply to Firestore:', error);
    });
}

function formatReplyCount(count) {
    return `${count} repl${count > 1 ? 'ies' : 'y'}`;
}


// Function to delete messages older than 30 days for a specific chat
function deleteMessages(chatId) {
    const thirtyDaysAgo = firebase.firestore.Timestamp.fromDate(new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)); // Calculate the timestamp 30 days ago
    
    // Ask for user confirmation before proceeding
    if (!confirm('Are you sure you want to delete messages older than 30 days from this chat?')) {
        
        return Promise.resolve();
    }

    // Query messages in the chat that are older than 30 days
    db.collection('chats').doc(chatId).collection('messages')
        .where('timestamp', '<=', thirtyDaysAgo) // Use '<=' to get messages older than 30 days
        .get()
        .then((querySnapshot) => {
            // Check if there are any messages to delete
            if (querySnapshot.empty) {
                
                return;
            }

            // Create a batch to delete the messages
            const batch = db.batch();

            querySnapshot.forEach((doc) => {
                batch.delete(doc.ref);
            });

            // Commit the batch delete
            return batch.commit().then(() => {
                
            });
        })
        .catch((error) => {
            console.error('Error deleting messages: ', error);
        });
}

// Function to handle the delete button click event
function handleDeleteMessagesButtonClick() {
    const currentUser = firebase.auth().currentUser;

    if (currentGroupId) {
        // If in a group chat, use the group ID
        deleteGroupMessages(currentGroupId).finally(() => {
            // Refresh the page after deletion attempt
            location.reload();
        });
    } else if (currentChatFriend) {
        // If in an individual chat, use the chat ID
        const chatId = getChatId(currentUser.email, currentChatFriend);
        deleteMessages(chatId).finally(() => {
            // Refresh the page after deletion attempt
            location.reload();
        });
    } else {
        console.error('No chat context found for deletion.');
    }
}

// Attach the delete function to the button click event
document.getElementById('deleteMessagesButton').addEventListener('click', handleDeleteMessagesButtonClick);


function createMessageDiv(message, messageId) {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message-container-2'); // Use the new class name
    messageDiv.setAttribute('data-message-id', messageId);

    // Create and append other elements like message text and options
    const textElement = document.createElement('span');
    textElement.classList.add('message-text');
    textElement.textContent = message.message;
    messageDiv.appendChild(textElement);

    // Add other elements such as options container, reactions, etc.

    return messageDiv;
}


function loadReplies(chatId, messageId, messageDiv) {
    // Real-time listener for replies of a specific message
    db.collection('replies').where('messageId', '==', messageId)
        .orderBy('timestamp', 'asc')
        .onSnapshot((querySnapshot) => {
            const replyCount = querySnapshot.size;
            let replyCountText = messageDiv.querySelector('.reply-count');

            if (replyCount > 0) {
                const replyText = `${replyCount} repl${replyCount === 1 ? 'y' : 'ies'}`;
                
                // If the reply count element exists, update it
                if (replyCountText) {
                    replyCountText.textContent = replyText;
                } else {
                    // If it doesn't exist, create it and append it to the messageDiv
                    replyCountText = document.createElement('span');
                    replyCountText.classList.add('reply-count');
                    replyCountText.textContent = replyText;
                    messageDiv.appendChild(replyCountText);

                    // Add an event listener to the reply count to open the modal
                    replyCountText.addEventListener('click', () => {
                        openReplyModal(chatId, messageId, messageDiv.querySelector('.message-text').textContent);
                    });
                }
            } else if (replyCountText) {
                // If no replies exist, remove the reply count element
                replyCountText.remove();
            }
        }, (error) => {
            console.error('Error loading replies from Firestore:', error);
        });
}


// Function to remove reaction
function removeReactionFromMessageV2(chatId, messageId) {
    db.collection('chats').doc(chatId).collection('messages').doc(messageId).update({
        reaction: firebase.firestore.FieldValue.delete()
    }).catch(error => {
        console.error("Error removing reaction: ", error);
    });
}

// Load Reactions
function loadReactionsV2(chatId, messageId, messageElement) {
    db.collection('chats').doc(chatId).collection('messages').doc(messageId)
        .onSnapshot((doc) => {
            if (doc.exists && doc.data().reaction) {
                const reaction = doc.data().reaction.reaction; // Only display the reaction emoji
                const currentUser = firebase.auth().currentUser.email; // Get the current user's email
                const sender = doc.data().sender; // Get the sender of the message
                
                const existingReactionIcon = messageElement.querySelector('.message-reaction');
                if (existingReactionIcon) {
                    existingReactionIcon.textContent = reaction; // Update existing reaction
                } else {
                    const reactionIcon = createReactionIconV2(reaction);

                    if (sender === currentUser) {
                        // If the current user sent the message, place the reaction at the top left with accent color
                        reactionIcon.style.position = 'absolute';
                        reactionIcon.style.top = '-8px';
                        reactionIcon.style.left = '-10px';
                        reactionIcon.style.backgroundColor = 'var(--accent-color)';
                    } else {
                        // For other users, keep the reaction on the top right with the primary color
                        reactionIcon.style.position = 'absolute';
                        reactionIcon.style.top = '-8px';
                        reactionIcon.style.right = '-10px';
                        reactionIcon.style.backgroundColor = 'var(--primary-color)';
                    }

                    messageElement.prepend(reactionIcon); // Add the reaction icon to the message element
                }
            }
        });
}

function createReactionIconV2(reaction) {
    const reactionElement = document.createElement('span');
    reactionElement.classList.add('message-reaction');
    reactionElement.textContent = reaction;
    return reactionElement;
}

// Add Reaction to Firestore
function addReactionToMessageV2(chatId, messageId, reaction) {
    db.collection('chats').doc(chatId).collection('messages').doc(messageId).set({
        reaction: {
            user: firebase.auth().currentUser.email,
            reaction: reaction
        }
    }, { merge: true }).catch((error) => {
        console.error('Error adding reaction:', error);
    });
}


function getChatId(userEmail, friendEmail) {
    return [userEmail, friendEmail].sort().join('_');
}

function getUserEmail(userId) {
    return db.collection('users').doc(userId).get().then((doc) => {
        return doc.data().email;
    });
}



// Function to add friends to a group
async function addToGroup() {
    const groupEmails = document.getElementById("groupEmails").value.trim();
    const emailsArray = groupEmails.split(',').map(email => email.trim()).filter(email => email !== '');

    if (emailsArray.length === 0) {
        alert("Please enter at least one friend's email.");
        return;
    }

    // Validate if all emails have '@' symbol
    const invalidEmails = emailsArray.filter(email => !email.includes('@'));
    if (invalidEmails.length > 0) {
        alert("Some emails are invalid: " + invalidEmails.join(", "));
        return;
    }

    const currentUser = firebase.auth().currentUser;

    if (!currentUser) {
        alert("You need to be logged in to create a group.");
        return;
    }

    try {
        // Validate if the emails exist in the 'users' collection
        const emailPromises = emailsArray.map(async email => {
            const userSnapshot = await db.collection('users').where('email', '==', email).get();
            return userSnapshot.empty ? null : email;
        });

        const validEmails = (await Promise.all(emailPromises)).filter(email => email !== null);

        if (validEmails.length !== emailsArray.length) {
            const invalidEmails = emailsArray.filter(email => !validEmails.includes(email));
            alert("The following emails do not belong to registered users: " + invalidEmails.join(", "));
            return;
        }

        // Add the current user's email to the list of participants
        const participants = validEmails.concat(currentUser.email);

        // Create the group in Firestore
        const groupName = `Group ${Date.now()}`; // Example default group name
        const docRef = await db.collection('groupchats').add({
            groupName: groupName,
            participants: participants,
            createdBy: currentUser.email,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        
        alert("Group created!"); // Show alert after group is created
        loadGroupChats(); // Reload the group chats after adding
    } catch (error) {
        console.error('Error creating group chat:', error);
        alert('Error creating group chat. Please try again later.');
    }

    // Clear the input field
    document.getElementById("groupEmails").value = "";
}


function sendGroupMessage(groupId) {
    const messageText = document.getElementById("chatInput").value.trim();
    if (messageText === "") return;

    const currentUser = firebase.auth().currentUser;

    if (!currentUser || !groupId) return;

    // Fetch the group data to get participants
    db.collection('groupchats').doc(groupId).get().then((doc) => {
        if (doc.exists) {
            const group = doc.data();
            const participants = group.participants || [];

            // Store the message in the group's messages collection
            db.collection('groupchats').doc(groupId).collection('messages').add({
                sender: currentUser.email,
                message: messageText,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById("chatInput").value = ""; // Clear the input field
            }).catch((error) => {
                console.error("Error sending message:", error);
            });

            // Display the message in the chat window
            const chatMessages = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');

            // Only show the display names of other participants, not the current user
            participants.forEach(email => {
                if (email !== currentUser.email) {
                    const nameElement = document.createElement('span');
                    nameElement.classList.add('message-sender');
                    nameElement.textContent = email;
                    messageElement.appendChild(nameElement);
                }
            });

            const textElement = document.createElement('span');
            textElement.classList.add('message-text');
            textElement.textContent = messageText;

            messageElement.appendChild(textElement);
            chatMessages.appendChild(messageElement);

            // Scroll to the bottom of the chat
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    }).catch((error) => {
        console.error("Error fetching group data:", error);
    });
}


function refreshOnlineFriends() {
    loadGroupChats();
}

document.getElementById('refreshButton').addEventListener('click', () => {
    refreshOnlineFriends();

    // Optional: Add a simple rotation animation
    const button = document.getElementById('refreshButton');
    button.style.transition = 'transform 0.5s ease-in-out';
    button.style.transform = 'rotate(360deg)';

    setTimeout(() => {
        button.style.transform = 'none';
    }, 500);
});

// Function to load group chats
function loadGroupChats() {
    const currentUser = firebase.auth().currentUser;

    if (!currentUser) return;

    db.collection('groupchats').where('participants', 'array-contains', currentUser.email)
        .onSnapshot((snapshot) => {
            const groupList = document.getElementById('groupList');
            groupList.innerHTML = ''; // Clear existing list

            snapshot.forEach((doc) => {
                const group = doc.data();
                const groupId = doc.id;
                const groupName = group.groupName || 'Unnamed Group';

                // Create a group item container
                const groupItem = document.createElement('div');
                groupItem.classList.add('group-item');
                groupItem.style.display = 'flex'; // Flexbox layout
                groupItem.style.alignItems = 'center'; // Vertically align items
                groupItem.style.justifyContent = 'flex-start'; // Left align items

                // Create the group avatar container
                const avatarContainer = document.createElement('div');
                avatarContainer.classList.add('group-avatar');
                avatarContainer.style.width = '40px'; // Set width for avatar
                avatarContainer.style.height = '40px';
                avatarContainer.style.marginRight = '10px'; // Space between avatar and name

                loadGCPicture(groupId, avatarContainer); // Load group profile picture or default avatar

                // Set the group name and avatar when clicked
                groupItem.addEventListener('click', () => {
                    updateChatHeader(groupName, groupId, true); // true indicates it's a group chat
                });

                // Create group name element
                const groupNameElement = document.createElement('span');
                groupNameElement.textContent = groupName;
                groupNameElement.classList.add('group-name');

                // Append the avatar container BEFORE the group name
                groupItem.appendChild(avatarContainer); // Avatar first
                groupItem.appendChild(groupNameElement); // Then the group name

                // Button container
                const buttonContainer = document.createElement('div');
                buttonContainer.classList.add('buttons');
                buttonContainer.style.display = 'flex';
                buttonContainer.style.gap = '8px';

                // Create the 'Pinned Group' button
                const pinnedGroupButton = document.createElement('button');
                pinnedGroupButton.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
                        <path fill-rule="evenodd" clip-rule="evenodd" 
                            d="M17.1218 1.87023C15.7573 0.505682 13.4779 0.76575 12.4558 2.40261L9.61062 6.95916C9.61033 6.95965 9.60913 6.96167 9.6038 6.96549C9.59728 6.97016 9.58336 6.97822 9.56001 6.9848C9.50899 6.99916 9.44234 6.99805 9.38281 6.97599C8.41173 6.61599 6.74483 6.22052 5.01389 6.87251C4.08132 7.22378 3.61596 8.03222 3.56525 8.85243C3.51687 9.63502 3.83293 10.4395 4.41425 11.0208L7.94975 14.5563L1.26973 21.2363C0.879206 21.6269 0.879206 22.26 1.26973 22.6506C1.66025 23.0411 2.29342 23.0411 2.68394 22.6506L9.36397 15.9705L12.8995 19.5061C13.4808 20.0874 14.2853 20.4035 15.0679 20.3551C15.8881 20.3044 16.6966 19.839 17.0478 18.9065C17.6998 17.1755 17.3043 15.5086 16.9444 14.5375C16.9223 14.478 16.9212 14.4114 16.9355 14.3603C16.9421 14.337 16.9502 14.3231 16.9549 14.3165C16.9587 14.3112 16.9606 14.31 16.9611 14.3098L21.5177 11.4645C23.1546 10.4424 23.4147 8.16307 22.0501 6.79853L17.1218 1.87023Z" 
                            fill="#ffffff"></path> 
                    </svg>
                `;
                pinnedGroupButton.style.backgroundColor = 'var(--primary-color)';
                pinnedGroupButton.style.border = 'none';
                pinnedGroupButton.style.borderRadius = '50%';
                pinnedGroupButton.style.padding = '6px';
                pinnedGroupButton.style.cursor = 'pointer';
                pinnedGroupButton.style.display = 'flex';
                pinnedGroupButton.style.alignItems = 'center';
                pinnedGroupButton.style.justifyContent = 'center';

                // Hover effect
                pinnedGroupButton.addEventListener('mouseover', () => {
                    pinnedGroupButton.style.backgroundColor = '#3b7bce';
                });

                pinnedGroupButton.addEventListener('mouseout', () => {
                    pinnedGroupButton.style.backgroundColor = 'var(--primary-color)';
                });

// Add pinning functionality
pinnedGroupButton.onclick = () => {
    const currentUserUID = currentUser.uid;
    const pinnedGroupId = groupId;

    const userRef = db.collection('pinnedGroups').doc(currentUserUID);

    // Get the user's pinned groups
    userRef.get().then((doc) => {
        let pinnedGroups = [];
        if (doc.exists) {
            pinnedGroups = doc.data().pinnedGroups || [];
        } else {
            userRef.set({ pinnedGroups: [] });
        }

        if (!pinnedGroups.includes(pinnedGroupId)) {
            pinnedGroups.push(pinnedGroupId);

            // Update Firestore with the new pinned group
            return userRef.update({
                pinnedGroups: pinnedGroups
            }).then(() => {
                // Disable the pin button and change its appearance
                pinnedGroupButton.disabled = true;
                pinnedGroupButton.style.opacity = '0.6'; // Indicate pinned state
                pinnedGroupButton.style.cursor = 'not-allowed';

                // Call loadPinnedGroups to refresh the pinned groups list
                loadPinnedGroups();
            });
        }
    }).catch((error) => {
        console.error('Error pinning group: ', error);
    });
};





// View Members button with SVG in a smaller circle
const viewMembersButton = document.createElement('button');
viewMembersButton.innerHTML = `
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" width="20" height="20">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M16 6C14.3432 6 13 7.34315 13 9C13 10.6569 14.3432 12 16 12C17.6569 12 19 10.6569 19 9C19 7.34315 17.6569 6 16 6ZM11 9C11 6.23858 13.2386 4 16 4C18.7614 4 21 6.23858 21 9C21 10.3193 20.489 11.5193 19.6542 12.4128C21.4951 13.0124 22.9176 14.1993 23.8264 15.5329C24.1374 15.9893 24.0195 16.6114 23.5631 16.9224C23.1068 17.2334 22.4846 17.1155 22.1736 16.6591C21.1979 15.2273 19.4178 14 17 14C13.166 14 11 17.0742 11 19C11 19.5523 10.5523 20 10 20C9.44773 20 9.00001 19.5523 9.00001 19C9.00001 18.308 9.15848 17.57 9.46082 16.8425C9.38379 16.7931 9.3123 16.7323 9.24889 16.6602C8.42804 15.7262 7.15417 15 5.50001 15C3.84585 15 2.57199 15.7262 1.75114 16.6602C1.38655 17.075 0.754692 17.1157 0.339855 16.7511C-0.0749807 16.3865 -0.115709 15.7547 0.248886 15.3398C0.809035 14.7025 1.51784 14.1364 2.35725 13.7207C1.51989 12.9035 1.00001 11.7625 1.00001 10.5C1.00001 8.01472 3.01473 6 5.50001 6C7.98529 6 10 8.01472 10 10.5C10 11.7625 9.48013 12.9035 8.64278 13.7207C9.36518 14.0785 9.99085 14.5476 10.5083 15.0777C11.152 14.2659 11.9886 13.5382 12.9922 12.9945C11.7822 12.0819 11 10.6323 11 9ZM3.00001 10.5C3.00001 9.11929 4.1193 8 5.50001 8C6.88072 8 8.00001 9.11929 8.00001 10.5C8.00001 11.8807 6.88072 13 5.50001 13C4.1193 13 3.00001 11.8807 3.00001 10.5Z" fill="#ffffff"></path>
    </svg>
`;


// Apply circular style and smaller size
viewMembersButton.style.backgroundColor = 'var(--primary-color)'; // Replace with your accent color variable or hex code
viewMembersButton.style.border = 'none';
viewMembersButton.style.borderRadius = '50%';
viewMembersButton.style.padding = '6px'; // Reduced padding for a smaller circle
viewMembersButton.style.cursor = 'pointer';
viewMembersButton.style.display = 'flex';
viewMembersButton.style.alignItems = 'center';
viewMembersButton.style.justifyContent = 'center';

// Hover effect to change color
viewMembersButton.addEventListener('mouseover', () => {
    viewMembersButton.style.backgroundColor = '#3b7bce';
});

viewMembersButton.addEventListener('mouseout', () => {
    viewMembersButton.style.backgroundColor = 'var(--primary-color)'; // Reset to the original color
});

viewMembersButton.onclick = () => {
    openViewMembersModal(doc.id);
};
buttonContainer.appendChild(viewMembersButton);



// Edit button
const editButton = document.createElement('button');
editButton.classList.add('edit-button');
editButton.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path d="M12 3.99997H6C4.89543 3.99997 4 4.8954 4 5.99997V18C4 19.1045 4.89543 20 6 20H18C19.1046 20 20 19.1045 20 18V12M18.4142 8.41417L19.5 7.32842C20.281 6.54737 20.281 5.28104 19.5 4.5C18.7189 3.71895 17.4526 3.71895 16.6715 4.50001L15.5858 5.58575M18.4142 8.41417L12.3779 14.4505C12.0987 14.7297 11.7431 14.9201 11.356 14.9975L8.41422 15.5858L9.00257 12.6441C9.08001 12.2569 9.27032 11.9013 9.54951 11.6221L15.5858 5.58575M18.4142 8.41417L15.5858 5.58575" 
            stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </g>
    </svg>`;
editButton.style.backgroundColor = 'var(--primary-color)';
editButton.style.border = 'none';
editButton.style.borderRadius = '50%';
editButton.style.padding = '6px'; 
editButton.style.cursor = 'pointer';
editButton.style.display = 'flex';
editButton.style.alignItems = 'center';
editButton.style.justifyContent = 'center';
editButton.addEventListener('mouseover', () => {
    editButton.style.backgroundColor = '#2980b9';
});
editButton.addEventListener('mouseout', () => {
    editButton.style.backgroundColor = 'var(--primary-color)';
});
editButton.onclick = () => {
    editGroupChat(doc.id, groupName);
};
buttonContainer.appendChild(editButton);



// Delete button
const deleteButton = document.createElement('button');
deleteButton.classList.add('delete-button');
deleteButton.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path d="M10 12V17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M14 12V17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M4 7H20" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M6 10V18C6 19.6569 7.34315 21 9 21H15C16.6569 21 18 19.6569 18 18V10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </g>
    </svg>`;
deleteButton.style.backgroundColor = 'var(--accent-color)';
deleteButton.style.border = 'none';
deleteButton.style.borderRadius = '50%';
deleteButton.style.padding = '6px';
deleteButton.style.cursor = 'pointer';
deleteButton.style.display = 'flex';
deleteButton.style.alignItems = 'center';
deleteButton.style.justifyContent = 'center';
deleteButton.addEventListener('mouseover', () => {
    deleteButton.style.backgroundColor = '#c0392b';
});
deleteButton.addEventListener('mouseout', () => {
    deleteButton.style.backgroundColor = 'var(--accent-color)';
});
deleteButton.onclick = () => {
    deleteGroupChat(doc.id);
};
buttonContainer.appendChild(deleteButton);






                groupItem.onclick = () => {
                    openGroupChat(doc.id);
                    currentGroupId = doc.id; // Set the current group ID
                };

                // Append the button container to the group item
                groupItem.appendChild(buttonContainer);

                // Finally, append the group item to the group list
                groupList.appendChild(groupItem);

                // Append the 'Pinned Group' button before the View Members button
                buttonContainer.appendChild(pinnedGroupButton);

                // Add the View Members button
                buttonContainer.appendChild(viewMembersButton);

                buttonContainer.appendChild(editButton);

                buttonContainer.appendChild(deleteButton);
            });
        });
}


function loadPinnedGroups() {
    const currentUser = firebase.auth().currentUser;

    if (!currentUser) return;

    const currentUserUID = currentUser.uid;

    // Fetch the current user's pinned groups
    db.collection('pinnedGroups').doc(currentUserUID).get()
        .then((doc) => {
            if (doc.exists) {
                const pinnedGroups = doc.data().pinnedGroups || [];
                const pinnedGroupsList = document.getElementById('pinnedGroups');
                pinnedGroupsList.innerHTML = ''; // Clear the list before appending new items

                pinnedGroups.forEach((groupId) => {
                    // Fetch the group information
                    db.collection('groupchats').doc(groupId).get()
                        .then((groupDoc) => {
                            if (groupDoc.exists) {
                                const group = groupDoc.data();
                                const groupName = group.groupName || 'Unnamed Group';

                                // Create a group item container
                                const groupItem = document.createElement('div');
                                groupItem.classList.add('group-item');
                                groupItem.style.display = 'flex'; // Flexbox layout
                                groupItem.style.alignItems = 'center'; // Vertically align items
                                groupItem.style.justifyContent = 'flex-start'; // Left align items

                                // Create the group avatar container
                                const avatarContainer = document.createElement('div');
                                avatarContainer.classList.add('group-avatar');
                                avatarContainer.style.width = '40px'; // Set width for avatar
                                avatarContainer.style.height = '40px';
                                avatarContainer.style.marginRight = '10px'; // Space between avatar and name

                                loadGCPicture(groupId, avatarContainer); // Load group profile picture or default avatar

                                // Create group name element
                                const groupNameElement = document.createElement('span');
                                groupNameElement.textContent = groupName;
                                groupNameElement.classList.add('group-name');

                                // Append the avatar container BEFORE the group name
                                groupItem.appendChild(avatarContainer); // Avatar first
                                groupItem.appendChild(groupNameElement); // Then the group name

                // Button container
                const buttonContainer = document.createElement('div');
                buttonContainer.classList.add('buttons');
                buttonContainer.style.display = 'flex';
                buttonContainer.style.gap = '8px';

               // Create the 'Unpin' button
const unpinGroupButton = document.createElement('button');
unpinGroupButton.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path d="M17.1218 1.87023C15.7573 0.505682 13.4779 0.76575 12.4558 2.40261L9.75191 6.73289L11.1969 8.17793C11.2355 8.1273 11.2723 8.07415 11.3071 8.01845L14.1523 3.46191C14.493 2.91629 15.2528 2.8296 15.7076 3.28445L20.6359 8.21274C21.0907 8.66759 21.0041 9.42737 20.4584 9.76806L15.9019 12.6133C15.8462 12.6481 15.793 12.6848 15.7424 12.7234L17.1874 14.1684L21.5177 11.4645C23.1546 10.4424 23.4147 8.16307 22.0501 6.79852L17.1218 1.87023Z" fill="#ffffff"></path>
            <path d="M3.56525 8.85242C3.6015 8.26612 3.84962 7.68582 4.32883 7.27422L5.77735 8.72274C5.75784 8.72967 5.73835 8.7368 5.71886 8.74414C5.64516 8.7719 5.61855 8.80285 5.60548 8.82181C5.58877 8.84604 5.56651 8.8937 5.56144 8.97583C5.55046 9.15333 5.62872 9.40686 5.82846 9.6066L14.3137 18.0919C14.5135 18.2916 14.767 18.3699 14.9445 18.3589C15.0266 18.3538 15.0743 18.3316 15.0985 18.3149C15.1175 18.3018 15.1484 18.2752 15.1762 18.2015C15.1835 18.182 15.1907 18.1625 15.1976 18.143L16.6461 19.5915C16.2345 20.0707 15.6542 20.3188 15.0679 20.3551C14.2853 20.4035 13.4808 20.0874 12.8995 19.5061L9.36397 15.9705L2.68394 22.6506C2.29342 23.0411 1.66025 23.0411 1.26973 22.6506C0.879206 22.26 0.879206 21.6269 1.26973 21.2363L7.94975 14.5563L4.41425 11.0208C3.83293 10.4395 3.51687 9.63502 3.56525 8.85242Z" fill="#ffffff"></path>
            <path d="M2.00789 2.00786C1.61736 2.39838 1.61736 3.03155 2.00789 3.42207L20.5862 22.0004C20.9767 22.3909 21.6099 22.3909 22.0004 22.0004C22.391 21.6099 22.391 20.9767 22.0004 20.5862L3.4221 2.00786C3.03158 1.61733 2.39841 1.61733 2.00789 2.00786Z" fill="#ffffff"></path>
        </g>
    </svg>
`;
unpinGroupButton.style.backgroundColor = 'var(--primary-color)';
unpinGroupButton.style.border = 'none';
unpinGroupButton.style.borderRadius = '50%';
unpinGroupButton.style.marginLeft = '8px';
unpinGroupButton.style.marginRight = '0';
unpinGroupButton.style.padding = '6px';
unpinGroupButton.style.cursor = 'pointer';
unpinGroupButton.style.display = 'flex';
unpinGroupButton.style.alignItems = 'center';
unpinGroupButton.style.justifyContent = 'center';

unpinGroupButton.addEventListener('mouseover', () => {
    unpinGroupButton.style.backgroundColor = '#3b7bce';
});

unpinGroupButton.addEventListener('mouseout', () => {
    unpinGroupButton.style.backgroundColor = 'var(--primary-color)';
});

unpinGroupButton.onclick = () => {
    const currentUser = firebase.auth().currentUser;
    if (currentUser) {
        const currentUserUID = currentUser.uid;
        
        // Get the friend's email to unpin
        const friendEmailToUnpin = friendEmail; // Use the variable for friend's email

        // Fetch the current user's pinned friends
        db.collection('pinnedFriends').doc(currentUserUID).get()
            .then((doc) => {
                if (doc.exists) {
                    let pinnedFriends = doc.data().pinnedFriends || [];
                    
                    // Remove the friend from the pinned friends list
                    pinnedFriends = pinnedFriends.filter(email => email !== friendEmailToUnpin);
                    
                    // Update the pinned friends list in Firestore
                    return db.collection('pinnedFriends').doc(currentUserUID).update({
                        pinnedFriends: pinnedFriends
                    });
                } else {
                    
                }
            })
            .then(() => {
                
                // Optionally, you can refresh the list of pinned friends to reflect changes
                loadPinnedFriends();
            })
            .catch((error) => {
                console.error('Error unpinning friend:', error);
            });
    } else {
        
    }
};





// View Members button with SVG in a smaller circle
const viewMembersButton = document.createElement('button');
viewMembersButton.innerHTML = `
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" width="20" height="20">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M16 6C14.3432 6 13 7.34315 13 9C13 10.6569 14.3432 12 16 12C17.6569 12 19 10.6569 19 9C19 7.34315 17.6569 6 16 6ZM11 9C11 6.23858 13.2386 4 16 4C18.7614 4 21 6.23858 21 9C21 10.3193 20.489 11.5193 19.6542 12.4128C21.4951 13.0124 22.9176 14.1993 23.8264 15.5329C24.1374 15.9893 24.0195 16.6114 23.5631 16.9224C23.1068 17.2334 22.4846 17.1155 22.1736 16.6591C21.1979 15.2273 19.4178 14 17 14C13.166 14 11 17.0742 11 19C11 19.5523 10.5523 20 10 20C9.44773 20 9.00001 19.5523 9.00001 19C9.00001 18.308 9.15848 17.57 9.46082 16.8425C9.38379 16.7931 9.3123 16.7323 9.24889 16.6602C8.42804 15.7262 7.15417 15 5.50001 15C3.84585 15 2.57199 15.7262 1.75114 16.6602C1.38655 17.075 0.754692 17.1157 0.339855 16.7511C-0.0749807 16.3865 -0.115709 15.7547 0.248886 15.3398C0.809035 14.7025 1.51784 14.1364 2.35725 13.7207C1.51989 12.9035 1.00001 11.7625 1.00001 10.5C1.00001 8.01472 3.01473 6 5.50001 6C7.98529 6 10 8.01472 10 10.5C10 11.7625 9.48013 12.9035 8.64278 13.7207C9.36518 14.0785 9.99085 14.5476 10.5083 15.0777C11.152 14.2659 11.9886 13.5382 12.9922 12.9945C11.7822 12.0819 11 10.6323 11 9ZM3.00001 10.5C3.00001 9.11929 4.1193 8 5.50001 8C6.88072 8 8.00001 9.11929 8.00001 10.5C8.00001 11.8807 6.88072 13 5.50001 13C4.1193 13 3.00001 11.8807 3.00001 10.5Z" fill="#ffffff"></path>
    </svg>
`;


// Apply circular style and smaller size
viewMembersButton.style.backgroundColor = 'var(--primary-color)'; // Replace with your accent color variable or hex code
viewMembersButton.style.border = 'none';
viewMembersButton.style.borderRadius = '50%';
viewMembersButton.style.padding = '6px'; // Reduced padding for a smaller circle
viewMembersButton.style.cursor = 'pointer';
viewMembersButton.style.display = 'flex';
viewMembersButton.style.alignItems = 'center';
viewMembersButton.style.justifyContent = 'center';

// Hover effect to change color
viewMembersButton.addEventListener('mouseover', () => {
    viewMembersButton.style.backgroundColor = '#3b7bce';
});

viewMembersButton.addEventListener('mouseout', () => {
    viewMembersButton.style.backgroundColor = 'var(--primary-color)'; // Reset to the original color
});

viewMembersButton.onclick = () => {
    openViewMembersModal(doc.id);
};
buttonContainer.appendChild(viewMembersButton);



// Edit button
const editButton = document.createElement('button');
editButton.classList.add('edit-button');
editButton.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path d="M12 3.99997H6C4.89543 3.99997 4 4.8954 4 5.99997V18C4 19.1045 4.89543 20 6 20H18C19.1046 20 20 19.1045 20 18V12M18.4142 8.41417L19.5 7.32842C20.281 6.54737 20.281 5.28104 19.5 4.5C18.7189 3.71895 17.4526 3.71895 16.6715 4.50001L15.5858 5.58575M18.4142 8.41417L12.3779 14.4505C12.0987 14.7297 11.7431 14.9201 11.356 14.9975L8.41422 15.5858L9.00257 12.6441C9.08001 12.2569 9.27032 11.9013 9.54951 11.6221L15.5858 5.58575M18.4142 8.41417L15.5858 5.58575" 
            stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </g>
    </svg>`;
editButton.style.backgroundColor = 'var(--primary-color)';
editButton.style.border = 'none';
editButton.style.borderRadius = '50%';
editButton.style.padding = '6px'; 
editButton.style.cursor = 'pointer';
editButton.style.display = 'flex';
editButton.style.alignItems = 'center';
editButton.style.justifyContent = 'center';
editButton.addEventListener('mouseover', () => {
    editButton.style.backgroundColor = '#2980b9';
});
editButton.addEventListener('mouseout', () => {
    editButton.style.backgroundColor = 'var(--primary-color)';
});
editButton.onclick = () => {
    editGroupChat(doc.id, groupName);
};
buttonContainer.appendChild(editButton);



// Delete button
const deleteButton = document.createElement('button');
deleteButton.classList.add('delete-button');
deleteButton.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path d="M10 12V17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M14 12V17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M4 7H20" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M6 10V18C6 19.6569 7.34315 21 9 21H15C16.6569 21 18 19.6569 18 18V10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </g>
    </svg>`;
deleteButton.style.backgroundColor = 'var(--accent-color)';
deleteButton.style.border = 'none';
deleteButton.style.borderRadius = '50%';
deleteButton.style.padding = '6px';
deleteButton.style.cursor = 'pointer';
deleteButton.style.display = 'flex';
deleteButton.style.alignItems = 'center';
deleteButton.style.justifyContent = 'center';
deleteButton.addEventListener('mouseover', () => {
    deleteButton.style.backgroundColor = '#c0392b';
});
deleteButton.addEventListener('mouseout', () => {
    deleteButton.style.backgroundColor = 'var(--accent-color)';
});
deleteButton.onclick = () => {
    deleteGroupChat(doc.id);
};
buttonContainer.appendChild(deleteButton);






                groupItem.onclick = () => {
                    openGroupChat(doc.id);
                    currentGroupId = doc.id; // Set the current group ID
                };

                // Append the button container to the group item
                groupItem.appendChild(buttonContainer);

                // Finally, append the group item to the group list
                groupList.appendChild(groupItem);

                // Append the 'Pinned Group' button before the View Members button
                buttonContainer.appendChild(unpinGroupButton);

                // Add the View Members button
                buttonContainer.appendChild(viewMembersButton);

                buttonContainer.appendChild(editButton);

                buttonContainer.appendChild(deleteButton);

                                // Append group item to the list
                                pinnedGroupsList.appendChild(groupItem);
                            }
                        })
                        .catch((error) => {
                            console.error("Error fetching group:", error);
                        });
                });
            }
        })
        .catch((error) => {
            console.error("Error fetching pinned groups:", error);
        });
}


function openViewMembersModal(groupId) {
    const modal = document.getElementById('viewMembersModal');
    const membersList = document.getElementById('membersList');
    membersList.innerHTML = '';

    db.collection('groupchats').doc(groupId).get().then((doc) => {
        const group = doc.data();
        const participants = group.participants;

        participants.forEach((participantEmail) => {
            db.collection('users').where('email', '==', participantEmail).get()
                .then((querySnapshot) => {
                    querySnapshot.forEach((userDoc) => {
                        const user = userDoc.data();

                        const memberItem = document.createElement('div');
                        memberItem.classList.add('member-item');

                        const nameElement = document.createElement('span');
                        nameElement.textContent = `${user.displayName} (${user.email})`;
                        memberItem.appendChild(nameElement);

                        const removeButton = document.createElement('button');
                        removeButton.classList.add('remove-member-button');
                        removeButton.innerHTML = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <defs>
                                    <style>
                                        .a,.b{fill:none;stroke:#ffffff;stroke-linecap:round;stroke-width:1.5px;}
                                        .a{stroke-linejoin:round;}
                                        .b{stroke-linejoin:bevel;}
                                    </style>
                                </defs>
                                <path class="a" d="M3,21.016l.78984-2.87249C5.0964,13.3918,8.5482,11.016,12,11.016"></path>
                                <circle class="b" cx="12" cy="5.98404" r="5"></circle>
                                <circle class="a" cx="17" cy="18" r="5"></circle>
                                <line class="a" x1="15.58579" x2="18.41421" y1="16.58579" y2="19.41421"></line>
                                <line class="a" x1="18.41421" x2="15.58579" y1="16.58579" y2="19.41421"></line>
                            </g>
                        </svg>`;
                        removeButton.onclick = () => {
                            removeUserFromGroupChat(groupId, user.email);
                        };
                        memberItem.appendChild(removeButton);

                        membersList.appendChild(memberItem);
                    });
                });
        });

        modal.style.display = 'block';
    });

    const closeBtn = document.querySelector('.modal2 .close');
    closeBtn.onclick = function () {
        modal.style.display = 'none';
    };
}

function removeUserFromGroupChat(groupId, userEmail) {
    db.collection('groupchats').doc(groupId).update({
        participants: firebase.firestore.FieldValue.arrayRemove(userEmail)
    }).then(() => {
        alert(`User ${userEmail} removed from the group chat.`);
        openViewMembersModal(groupId); // Refresh the modal view
    }).catch((error) => {
        console.error("Error removing user: ", error);
    });
}

function editGroupChat(groupId, currentGroupName, currentGroupImageURL) {
    // Open modal7 to edit the group chat
    document.getElementById('modal7').style.display = 'block';

    // Pre-fill the group name input with the current group name
    const groupNameInput = document.getElementById('groupNameInput');
    groupNameInput.value = currentGroupName;

    // Set up the "Edit Group Image" button to open file input
    const editGroupImageBtn = document.getElementById('editGroupImageBtn');
    const groupImageInput = document.getElementById('groupImageInput');
    
    editGroupImageBtn.addEventListener('click', function() {
        groupImageInput.click(); // Open file dialog
    });

    // Reset the cropper and load the selected image
    groupImageInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageToCrop = document.getElementById('imageToCrop');
                imageToCrop.style.display = 'block'; // Show the image preview
                imageToCrop.src = e.target.result;   // Load image into modal7

                // Initialize cropper for image cropping
                cropper = new Cropper(imageToCrop, {
                    aspectRatio: 1, // Square aspect ratio
                    viewMode: 1
                });
            };
            reader.readAsDataURL(file);
        }
    });

    // Save changes (group name and image)
    const saveGroupChangesBtn = document.getElementById('saveGroupChangesBtn');
    saveGroupChangesBtn.addEventListener('click', function() {
        const newGroupName = groupNameInput.value.trim();

        if (newGroupName !== '' && newGroupName !== currentGroupName) {
            // Update the group name in Firestore
            db.collection('groupchats').doc(groupId).update({
                groupName: newGroupName
            }).then(() => {
                
            }).catch((error) => {
                console.error('Error updating group name:', error);
            });
        }

        if (cropper) {
            const canvas = cropper.getCroppedCanvas({
                width: 300,
                height: 300
            });

            // Show loading indicator (if any)
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'block';
            }

            // Convert canvas to blob and upload to Firebase Storage
            canvas.toBlob(function(blob) {
                const storageRef = firebase.storage().ref(`group_pictures/${groupId}.png`);

                // Upload the cropped image to Firebase Storage
                storageRef.put(blob).then(snapshot => {
                    return snapshot.ref.getDownloadURL();  // Get the file's download URL
                }).then(downloadURL => {
                    // Update the group chat document with the new image URL
                    return db.collection('groupchats').doc(groupId).update({
                        groupImageURL: downloadURL
                    });
                }).then(() => {
                    // Hide the cropping modal7
                    document.getElementById('modal7').style.display = 'none';

                    // Hide the loading indicator
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }

                    

                    location.reload();
                }).catch(error => {
                    console.error("Error uploading group chat image: ", error);
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                });
            });
        } else {
            // If no new image is selected, just close the modal after updating the group name
            document.getElementById('modal7').style.display = 'none';
        }
    });

    // Cancel the modal
    const cancelCropBtn = document.getElementById('cancelCropBtn');
    cancelCropBtn.addEventListener('click', function() {
        document.getElementById('modal7').style.display = 'none';

        location.reload();
    });
}




function deleteGroupChat(groupId) {
    const confirmation = confirm('Are you sure you want to delete this group chat? This action cannot be undone.');
    if (confirmation) {
        db.collection('groupchats').doc(groupId).collection('messages').get().then((snapshot) => {
            const batch = db.batch();
            snapshot.forEach((doc) => {
                batch.delete(doc.ref);
            });
            return batch.commit();
        }).then(() => {
            return db.collection('groupchats').doc(groupId).delete();
        }).then(() => {
            
        }).catch((error) => {
            console.error('Error deleting group chat:', error);
        });
    }
}


// Function to open a group chat
function openGroupChat(groupId) {
    db.collection('groupchats').doc(groupId).get().then((doc) => {
        if (doc.exists) {
            const group = doc.data();
            document.getElementById('chatWith').textContent = group.groupName;
            loadGroupMessages(groupId);
        }
    }).catch((error) => {
        console.error('Error opening group chat:', error);
    });
}

function createAddFriendButton(friendEmail) {
    const button = document.createElement('button');
    button.className = 'add-friend-icon-button'; // Update class name
    button.onclick = () => sendFriendRequest(friendEmail);

    // Create SVG element
    const svgNS = 'http://www.w3.org/2000/svg';
    const svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('viewBox', '0 -64 640 640');
    svg.setAttribute('xmlns', svgNS);
    svg.setAttribute('fill', '#ffffff'); // Set fill to white

    // Define path with the new SVG data
    const path = document.createElementNS(svgNS, 'path');
    path.setAttribute('d', 'M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z');
    path.setAttribute('fill', '#ffffff'); // Ensure the fill color is white

    // Append path to the SVG container
    svg.appendChild(path);

    // Append SVG to the button
    button.appendChild(svg);

    return button;
}

function createViewMembersButton() {
    const button = document.createElement('button');
    button.className = 'view-members-button'; // Update class name

    // Create SVG element
    const svgNS = 'http://www.w3.org/2000/svg';
    const svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('viewBox', '0 0 24 24');
    svg.setAttribute('xmlns', svgNS);
    svg.setAttribute('fill', 'none'); // Set fill to none
    svg.setAttribute('stroke', '#ffffff'); // Set stroke color as per the SVG provided

    // Define paths and shapes with correct stroke width and style
    const path = document.createElementNS(svgNS, 'path');
    path.setAttribute('d', 'M3,21.016l.78984-2.87249C5.0964,13.3918,8.5482,10.984,12,10.984');
    path.setAttribute('stroke', '#ffffff'); // Ensure path stroke color
    path.setAttribute('stroke-width', '1.5');

    const circle1 = document.createElementNS(svgNS, 'circle');
    circle1.setAttribute('cx', '12');
    circle1.setAttribute('cy', '5.98404');
    circle1.setAttribute('r', '5');
    circle1.setAttribute('stroke', '#ffffff'); // Ensure circle stroke color
    circle1.setAttribute('stroke-width', '1.5');

    const circle2 = document.createElementNS(svgNS, 'circle');
    circle2.setAttribute('cx', '17');
    circle2.setAttribute('cy', '18');
    circle2.setAttribute('r', '5');
    circle2.setAttribute('stroke', '#ffffff'); // Ensure circle stroke color
    circle2.setAttribute('stroke-width', '1.5');

    const circle3 = document.createElementNS(svgNS, 'circle');
    circle3.setAttribute('cx', '17');
    circle3.setAttribute('cy', '18');
    circle3.setAttribute('r', '0.20745');
    circle3.setAttribute('stroke', '#ffffff'); // Ensure circle stroke color
    circle3.setAttribute('stroke-width', '1.5');

    const circle4 = document.createElementNS(svgNS, 'circle');
    circle4.setAttribute('cx', '14.35106');
    circle4.setAttribute('cy', '18');
    circle4.setAttribute('r', '0.20745');
    circle4.setAttribute('stroke', '#ffffff'); // Ensure circle stroke color
    circle4.setAttribute('stroke-width', '1.5');

    const circle5 = document.createElementNS(svgNS, 'circle');
    circle5.setAttribute('cx', '19.47832');
    circle5.setAttribute('cy', '18');
    circle5.setAttribute('r', '0.20745');
    circle5.setAttribute('stroke', '#ffffff'); // Ensure circle stroke color
    circle5.setAttribute('stroke-width', '1.5');

    // Append SVG elements to the SVG container
    svg.appendChild(path);
    svg.appendChild(circle1);
    svg.appendChild(circle2);
    svg.appendChild(circle3);
    svg.appendChild(circle4);
    svg.appendChild(circle5);

    // Append SVG to the button
    button.appendChild(svg);

    return button;
}


function sendFriendRequest(friendEmail) {
    const currentUser = firebase.auth().currentUser;

    if (currentUser) {
        const userId = currentUser.uid;

        db.collection('users').where('email', '==', friendEmail).get()
            .then((querySnapshot) => {
                if (querySnapshot.empty) {
                    console.error('User with this email does not exist.');
                    return;
                }

                const recipientDoc = querySnapshot.docs[0];
                const recipientId = recipientDoc.id;

                db.collection('friendRequests').add({
                    senderId: userId,
                    recipientId: recipientId,
                    status: 'pending',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    
                    alert('Friend request sent!');
                }).catch((error) => {
                    console.error('Error sending friend request:', error);
                });
            })
            .catch((error) => {
                console.error('Error fetching user data:', error);
            });
    }
}


function loadGroupMessages(groupId) {
    currentGroupId = groupId; // Set the currentGroupId when a group is loaded

    db.collection('groupchats').doc(groupId).collection('messages')
        .orderBy('timestamp')
        .onSnapshot((snapshot) => {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = ''; // Clear the chat window

            const messages = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
            }));

            const fetchDisplayNamesPromises = messages.map(async (message) => {
                if (message.sender === firebase.auth().currentUser.email) {
                    return { ...message, senderDisplayName: null };
                } else {
                    const userSnapshot = await db.collection('users')
                        .where('email', '==', message.sender)
                        .get();

                    const senderDisplayName = !userSnapshot.empty 
                        ? userSnapshot.docs[0].data().displayName || message.sender 
                        : message.sender;

                    return { ...message, senderDisplayName };
                }
            });

            Promise.all(fetchDisplayNamesPromises).then(messagesWithDisplayNames => {
                messagesWithDisplayNames.forEach(message => {
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('message-container');

                    if (message.senderDisplayName) {
                        const senderElement = document.createElement('span');
                        senderElement.classList.add('message-sender');
                        senderElement.innerHTML = `${message.senderDisplayName}: `;
                        messageElement.appendChild(senderElement);

                        // Check if user is not friends with the sender
                        const currentUser = firebase.auth().currentUser;
                        db.collection('users').where('email', '==', message.sender).get()
                            .then((snapshot) => {
                                if (!snapshot.empty) {
                                    const friendData = snapshot.docs[0].data();
                                    if (friendData.acceptedFriends && !friendData.acceptedFriends.includes(currentUser.email)) {
                                        const addFriendButton = createAddFriendButton(message.sender);
                                        messageElement.appendChild(addFriendButton); // Append button to message container
                                    }
                                }
                            })
                            .catch((error) => {
                                console.error('Error checking friend status:', error);
                            });
                    }

                    const textElement = document.createElement('span');
                    textElement.classList.add('message-text');
                    textElement.textContent = message.message;
                    messageElement.appendChild(textElement);

                    if (message.sender === firebase.auth().currentUser.email) {
                        messageElement.classList.add('message', 'sent');
                    } else {
                        messageElement.classList.add('message', 'received');
                    }

                    const optionsContainer = document.createElement('div');
                    optionsContainer.classList.add('message-options');
                    optionsContainer.style.display = 'none'; // Initially hidden

                    // Reaction options
                    const reactions = ['👍', '👎', '❤️', '‼', '?'];
                    reactions.forEach(reaction => {
                        const reactionButton = document.createElement('button');
                        reactionButton.textContent = reaction;
                        reactionButton.classList.add('reaction-button');
                        reactionButton.addEventListener('click', () => {
                            addReactionToMessage(groupId, message.id, reaction);
                        });
                        optionsContainer.appendChild(reactionButton);
                    });

                    // Remove Reaction option
                    const removeReactionButton = document.createElement('button');
                    removeReactionButton.textContent = 'Remove';
                    removeReactionButton.classList.add('remove-reaction-button');
                    removeReactionButton.addEventListener('click', () => {
                        removeReactionFromMessage(groupId, message.id);
                    });
                    optionsContainer.appendChild(removeReactionButton);

                    messageElement.appendChild(optionsContainer);

                    messageElement.addEventListener('click', () => {
                        optionsContainer.style.display = optionsContainer.style.display === 'none' ? 'flex' : 'none';
                    });

                    chatMessages.appendChild(messageElement);

                    // Load reactions for this message
                    loadReactions(groupId, message.id, messageElement);
                });

                // Scroll to the bottom of the chat
                chatMessages.scrollTop = chatMessages.scrollHeight;

                checkCurrentGroupChat();

            });
        });
}

// Function to remove reaction
function removeReactionFromMessage(groupId, messageId) {
    db.collection('groupchats').doc(groupId).collection('messages').doc(messageId).update({
        reaction: firebase.firestore.FieldValue.delete()
    }).catch(error => {
        console.error("Error removing reaction: ", error);
    });
}

// Load Reactions
function loadReactions(groupId, messageId, messageElement) {
    db.collection('groupchats').doc(groupId).collection('messages').doc(messageId)
        .onSnapshot((doc) => {
            if (doc.exists && doc.data().reaction) {
                const reaction = doc.data().reaction.reaction; // Only display the reaction emoji
                const currentUser = firebase.auth().currentUser.email; // Get the current user's email
                const sender = doc.data().sender; // Get the sender of the message
                
                const existingReactionIcon = messageElement.querySelector('.message-reaction');
                if (existingReactionIcon) {
                    existingReactionIcon.textContent = reaction; // Update existing reaction
                } else {
                    const reactionIcon = createReactionIcon(reaction);

                    if (sender === currentUser) {
                        // If the current user sent the message, place the reaction at the top left with accent color
                        reactionIcon.style.position = 'absolute';
                        reactionIcon.style.top = '-8px';
                        reactionIcon.style.left = '-10px';
                        reactionIcon.style.backgroundColor = 'var(--accent-color)';
                    } else {
                        // For other users, keep the reaction on the top right with the primary color
                        reactionIcon.style.position = 'absolute';
                        reactionIcon.style.top = '-8px';
                        reactionIcon.style.right = '-10px';
                        reactionIcon.style.backgroundColor = 'var(--primary-color)';
                    }

                    messageElement.prepend(reactionIcon); // Add the reaction icon to the message element
                }
            }
        });
}

function createReactionIcon(reaction) {
    const reactionElement = document.createElement('span');
    reactionElement.classList.add('message-reaction');
    reactionElement.textContent = reaction;
    return reactionElement;
}

// Add Reaction to Firestore
function addReactionToMessage(groupId, messageId, reaction) {
    db.collection('groupchats').doc(groupId).collection('messages').doc(messageId).set({
        reaction: {
            user: firebase.auth().currentUser.email,
            reaction: reaction
        }
    }, { merge: true }).catch((error) => {
        console.error('Error adding reaction:', error);
    });
}


// Function to get the group ID where the current user is a participant
function getGroupId() {
    const currentUser = firebase.auth().currentUser;

    return db.collection('groupchats')
        .where('participants', 'array-contains', currentUser.email) // Check if the user is a participant
        .get()
        .then((querySnapshot) => {
            if (!querySnapshot.empty) {
                // Assuming the first group found is the one we're working with
                const groupDoc = querySnapshot.docs[0];
                const groupId = groupDoc.id; // Get the group ID (document ID)

                return groupId;
            } else {
                console.error('No group found for the current user.');
                return null;
            }
        })
        .catch((error) => {
            console.error('Error retrieving group ID: ', error);
        });
}


// Function to delete messages older than 30 days for a specific group
function deleteGroupMessages(groupId) {
    const thirtyDaysAgo = firebase.firestore.Timestamp.fromDate(new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)); // Calculate the timestamp 30 days ago
    
    // Ask for user confirmation before proceeding
    if (!confirm('Confirm deletion of messages older than 30 days from this group?')) {
        
        return Promise.resolve(); // Return a resolved promise to continue with the code
    }

    // Query messages in the group that are older than 30 days
    db.collection('groupchats').doc(groupId).collection('messages')
        .where('timestamp', '<=', thirtyDaysAgo) // Use '<=' to get messages older than 30 days
        .get()
        .then((querySnapshot) => {
            // Check if there are any messages to delete
            if (querySnapshot.empty) {
                
                return;
            }

            // Create a batch to delete the messages
            const batch = db.batch();

            querySnapshot.forEach((doc) => {
                batch.delete(doc.ref);
            });

            // Commit the batch delete
            return batch.commit().then(() => {
                
            });
        })
        .catch((error) => {
            console.error('Error deleting messages: ', error);
        });
}

// Function to handle the delete button click event
function handleDeleteMessagesButtonClick() {
    const currentUser = firebase.auth().currentUser;

    if (currentGroupId) {
        // If in a group chat, use the group ID
        deleteGroupMessages(currentGroupId).finally(() => {
            // Refresh the page after deletion attempt
            location.reload();
        });
    } else if (currentChatFriend) {
        // If in an individual chat, use the chat ID
        const chatId = getChatId(currentUser.email, currentChatFriend);
        deleteMessages(chatId).finally(() => {
            // Refresh the page after deletion attempt
            location.reload();
        });
    } else {
        console.error('No chat context found for deletion.');
    }
}

// Attach the delete function to the button click event
document.getElementById('deleteMessagesButton').addEventListener('click', handleDeleteMessagesButtonClick);




// Call this function after user logs in to load existing group chats
firebase.auth().onAuthStateChanged(user => {
    if (user) {
        loadGroupChats();
    }
});

document.getElementById('refreshButton').addEventListener('click', loadOnlineFriends);

</script>


<script>
    async function toggleNightMode() {
        document.body.classList.toggle('night-mode');
        const isNightMode = document.body.classList.contains('night-mode');

        // Update localStorage
        localStorage.setItem('nightMode', isNightMode ? 'enabled' : 'disabled');

        // Save the theme preference to Firestore
            try {
                const user = firebase.auth().currentUser;
                if (user) {
                    const userId = user.uid;
                    await db.collection('users').doc(userId).set({
                        nightMode: isNightMode ? 'enabled' : 'disabled'
                    }, { merge: true });
                } else {
                    console.error('No user is signed in');
                }
            } catch (error) {
                console.error('Error updating Firestore:', error);
            }

            // Update theme icon
            updateThemeIcon(isNightMode ? 'moon' : 'sun');
        }
    function updateThemeIcon(state) {
        const themeIcon = document.getElementById('theme-icon');
        const themeContainer = document.querySelector('.theme-icon');

        // Animation effect
        themeContainer.classList.add('active');

        setTimeout(() => {
            if (state === 'moon') {
                themeIcon.innerHTML = `<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>`;
                themeIcon.dataset.state = 'sun';
            } else {
                themeIcon.innerHTML = `<path d="M14.5739 1.11056L13.7826 2.69316C13.7632 2.73186 13.7319 2.76325 13.6932 2.7826L12.1106 3.5739C11.9631 3.64761 11.9631 3.85797 12.1106 3.93167L13.6932 4.72297C13.7319 4.74233 13.7632 4.77371 13.7826 4.81241L14.5739 6.39502C14.6476 6.54243 14.858 6.54243 14.9317 6.39502L15.723 4.81241C15.7423 4.77371 15.7737 4.74232 15.8124 4.72297L17.395 3.93167C17.5424 3.85797 17.5424 3.64761 17.395 3.5739L15.8124 2.7826C15.7737 2.76325 15.7423 2.73186 15.723 2.69316L14.9317 1.11056C14.858 0.963147 14.6476 0.963148 14.5739 1.11056Z" fill="#FFFFFF"></path> <path d="M19.2419 5.07223L18.4633 7.40815C18.4434 7.46787 18.3965 7.51474 18.3368 7.53464L16.0009 8.31328C15.8185 8.37406 15.8185 8.63198 16.0009 8.69276L18.3368 9.4714C18.3965 9.4913 18.4434 9.53817 18.4633 9.59789L19.2419 11.9338C19.3027 12.1161 19.5606 12.1161 19.6214 11.9338L20.4 9.59789C20.42 9.53817 20.4668 9.4913 20.5265 9.4714L22.8625 8.69276C23.0448 8.63198 23.0448 8.37406 22.8625 8.31328L20.5265 7.53464C20.4668 7.51474 20.42 7.46787 20.4 7.40815L19.6214 5.07223C19.5606 4.88989 19.3027 4.88989 19.2419 5.07223Z" fill="#FFFFFF"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M10.4075 13.6642C13.2348 16.4915 17.6517 16.7363 20.6641 14.3703C20.7014 14.341 20.7385 14.3113 20.7754 14.2812C20.9148 14.1674 21.051 14.0479 21.1837 13.9226C21.2376 13.8718 21.2909 13.8201 21.3436 13.7674C21.8557 13.2552 22.9064 13.5578 22.7517 14.2653C22.6983 14.5098 22.6365 14.7517 22.5667 14.9905C22.5253 15.1321 22.4811 15.2727 22.4341 15.4122C22.4213 15.4502 22.4082 15.4883 22.395 15.5262C20.8977 19.8142 16.7886 23.0003 12 23.0003C5.92487 23.0003 1 18.0754 1 12.0003C1 7.13315 4.29086 2.98258 8.66889 1.54252L8.72248 1.52504C8.8185 1.49401 8.91503 1.46428 9.01205 1.43587C9.26959 1.36046 9.5306 1.29438 9.79466 1.23801C10.5379 1.07934 10.8418 2.19074 10.3043 2.72815C10.251 2.78147 10.1987 2.83539 10.1473 2.88989C10.0456 2.99777 9.94766 3.10794 9.8535 3.22023C9.83286 3.24485 9.8124 3.26957 9.79212 3.29439C7.32966 6.30844 7.54457 10.8012 10.4075 13.6642ZM8.99331 15.0784C11.7248 17.8099 15.6724 18.6299 19.0872 17.4693C17.4281 19.6024 14.85 21.0003 12 21.0003C7.02944 21.0003 3 16.9709 3 12.0003C3 9.09163 4.45653 6.47161 6.66058 4.81846C5.41569 8.27071 6.2174 12.3025 8.99331 15.0784Z" fill="#FFFFFF"></path>`;
                themeIcon.dataset.state = 'moon';
            }
            themeContainer.classList.remove('active');
        }, 500); // Duration matches the CSS animation duration
    }

        // Check Firestore for night mode preference
        document.addEventListener('DOMContentLoaded', async (event) => {
            try {
                firebase.auth().onAuthStateChanged(async (user) => {
                    if (user) {
                        const userId = user.uid;
                        try {
                            const doc = await db.collection('users').doc(userId).get();
                            const nightMode = doc.exists ? doc.data().nightMode : null;
                            if (nightMode === 'enabled') {
                                document.body.classList.add('night-mode');
                                updateThemeIcon('moon');
                            } else {
                                updateThemeIcon('sun');
                            }
                        } catch (error) {
                            console.error('Error fetching Firestore document:', error);
                        }

                        // Event listener for toggle button
                        document.getElementById('toggleNightMode').addEventListener('click', toggleNightMode);
                    } else {
                        console.error('No user is signed in');
                    }
                });
            } catch (error) {
                console.error('Error initializing Firebase Authentication:', error);
            }
        });

    // Event listener for toggle button
    document.getElementById('toggleNightMode').addEventListener('click', toggleNightMode);

</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('bugModal');
    const closeModalBtn = document.getElementById('closeModal');
    const disableModalBtn = document.getElementById('disableModal');

    // Check if the modal should be shown
    if (localStorage.getItem('modalDisabled') === 'true') {
        modal.style.display = 'none';
    } else {
        modal.style.display = 'flex'; // Display the modal by default
    }

    // Close modal
    closeModalBtn.addEventListener('click', function() {
        modal.style.display = 'none';
    });

    // Disable modal for current user
    disableModalBtn.addEventListener('click', function() {
        // Set a flag in localStorage to remember the user's preference
        localStorage.setItem('modalDisabled', 'true');
        modal.style.display = 'none';
    });
});
</script>

<script>
document.getElementById('refreshButton').addEventListener('click', () => {
    const button = document.getElementById('refreshButton');
    button.style.transition = 'transform 0.5s ease-in-out';
    button.style.transform = 'rotate(360deg)';

    // Reset the transform after the animation is done
    setTimeout(() => {
        button.style.transform = 'none';
    }, 500);
});
</script>


<script>
function loadSmallProfilePicture() {
    const currentUser = firebase.auth().currentUser;
    const avatarContainer = document.getElementById('smallProfilePictureContainer');
    const defaultAvatar = document.getElementById('defaultAvatar');

    if (currentUser) {
        const uid = currentUser.uid;
        const userDocRef = firestore.collection('users').doc(uid);

        userDocRef.get().then(doc => {
            if (doc.exists) {
                const data = doc.data();
                const profilePictureUrl = data.profilePicture;

                if (profilePictureUrl) {
                    // Create and append the new profile picture
                    const img = document.createElement('img');
                    img.src = profilePictureUrl;
                    img.alt = 'Profile Picture';
                    img.style.width = '40px'; // Ensure the image has the same size as the SVG
                    img.style.height = '40px';
                    img.style.borderRadius = '50%';

                    // Replace the SVG with the new image
                    avatarContainer.innerHTML = '';  // Clear the current content
                    avatarContainer.appendChild(img);
                } else {
                    
                }
            } else {
                console.error("No user document found.");
            }
        }).catch(error => {
            console.error("Error loading profile picture: ", error);
        });
    } else {
        console.error("User is not authenticated.");
    }
}

// Call the function when the page loads
document.addEventListener('DOMContentLoaded', function() {
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            loadSmallProfilePicture();
        }
    });
});

</script>
    
<script>
function loadFriendProfilePicture(friendEmail, avatarContainer) {
    const defaultAvatar = document.getElementById('defaultAvatar');

    // Fetch the friend's document based on their email
    db.collection('users').where('email', '==', friendEmail).get()
        .then((querySnapshot) => {
            if (!querySnapshot.empty) {
                const friendDoc = querySnapshot.docs[0];
                const data = friendDoc.data();
                const profilePictureUrl = data.profilePicture;

                if (profilePictureUrl) {
                    // Create and append the new profile picture
                    const img = document.createElement('img');
                    img.src = profilePictureUrl;
                    img.alt = 'Friend Profile Picture';
                    img.style.width = '40px'; // Ensure the image has the same size as the SVG
                    img.style.height = '40px';
                    img.style.borderRadius = '50%';

                    // Replace the SVG with the new image
                    avatarContainer.innerHTML = '';  // Clear the current content
                    avatarContainer.appendChild(img);
                } else {
                    // Use default avatar if no profile picture is set
                    const defaultAvatarClone = defaultAvatar.cloneNode(true);
                    avatarContainer.innerHTML = ''; // Clear the current content
                    avatarContainer.appendChild(defaultAvatarClone);
                }
            } else {
                console.error("No document found for friend with email: ", friendEmail);
                // Use default avatar if no document is found
                const defaultAvatarClone = defaultAvatar.cloneNode(true);
                avatarContainer.innerHTML = ''; // Clear the current content
                avatarContainer.appendChild(defaultAvatarClone);
            }
        }).catch(error => {
            console.error("Error loading friend's profile picture: ", error);
            // Use default avatar on error
            const defaultAvatarClone = defaultAvatar.cloneNode(true);
            avatarContainer.innerHTML = ''; // Clear the current content
            avatarContainer.appendChild(defaultAvatarClone);
        });
}

// Function to load group chat profile picture or default avatar
function loadGCPicture(groupId, avatarContainer) {
    // Fetch the default group avatar element
    const defaultGroupAvatar = document.querySelector('#defaultGroupAvatar');
    const currentGroupImage = document.getElementById('currentGroupImage'); // Fetch the current group image element

    ;

    // Fetch the group chat document based on its ID
    db.collection('groupchats').doc(groupId).get()
        .then((doc) => {
            if (doc.exists) {
                
                const groupData = doc.data();
                const groupImageURL = groupData.groupImageURL;  // Updated to match your document structure

                

                // Clear the current content inside avatarContainer
                avatarContainer.innerHTML = '';

                if (groupImageURL) {
                    // Create a new Image object
                    const img = new Image();
                    img.src = groupImageURL;
                    img.alt = 'Group Profile Picture';
                    img.style.width = '40px';  // Ensure the image has the same size as the SVG
                    img.style.height = '40px';
                    img.style.borderRadius = '50%';

                    // Handle case where the image fails to load
                    img.onerror = function() {
                        console.error('Failed to load group profile picture from URL:', groupImageURL);
                        
                        const defaultGroupAvatarClone = defaultGroupAvatar.cloneNode(true);
                        defaultGroupAvatarClone.removeAttribute('id'); // Remove the ID to avoid duplication
                        avatarContainer.appendChild(defaultGroupAvatarClone);
                        if (currentGroupImage) {
                            currentGroupImage.src = defaultGroupAvatarClone.src; // Update currentGroupImage
                        }
                    };

                    // On successful image load, append it to the avatar container and update currentGroupImage
                    img.onload = function() {
                        
                        avatarContainer.appendChild(img);
                        if (currentGroupImage) {
                            currentGroupImage.src = groupImageURL; // Update currentGroupImage
                        }
                    };
                } else {
                    // No picture is set, use default group avatar
                    
                    const defaultGroupAvatarClone = defaultGroupAvatar.cloneNode(true);
                    defaultGroupAvatarClone.removeAttribute('id'); // Remove the ID to avoid duplication
                    avatarContainer.appendChild(defaultGroupAvatarClone);
                    if (currentGroupImage) {
                        currentGroupImage.src = defaultGroupAvatarClone.src; // Update currentGroupImage
                    }
                }
            } else {
                console.error("No document found for group with ID:", groupId);
                // If no document is found, use default group avatar
                
                const defaultGroupAvatarClone = defaultGroupAvatar.cloneNode(true);
                defaultGroupAvatarClone.removeAttribute('id'); // Remove the ID to avoid duplication
                avatarContainer.innerHTML = ''; // Clear the current content
                avatarContainer.appendChild(defaultGroupAvatarClone);
                if (currentGroupImage) {
                    currentGroupImage.src = defaultGroupAvatarClone.src; // Update currentGroupImage
                }
            }
        }).catch(error => {
            console.error("Error loading group profile picture:", error);
            // Use default group avatar on error
            
            const defaultGroupAvatarClone = defaultGroupAvatar.cloneNode(true);
            defaultGroupAvatarClone.removeAttribute('id'); // Remove the ID to avoid duplication
            avatarContainer.innerHTML = ''; // Clear the current content
            avatarContainer.appendChild(defaultGroupAvatarClone);
            if (currentGroupImage) {
                currentGroupImage.src = defaultGroupAvatarClone.src; // Update currentGroupImage
            }
        });
}


// Show the "no chat" message
function showNoChatMessage() {
    const noChatMessage = document.getElementById('noChatSelected');
    const chatMessages = document.getElementById('chatMessages');


    // Use !important to ensure visibility is forced
    noChatMessage.style.setProperty('display', 'flex', 'important'); // Show "no chat" message
    chatMessages.style.setProperty('display', 'none', 'important');  // Hide chat messages
}

// Show chat messages
function showChatMessages() {
    const noChatMessage = document.getElementById('noChatSelected');
    const chatMessages = document.getElementById('chatMessages');


    // Use !important to ensure visibility is forced
    noChatMessage.style.setProperty('display', 'none', 'important');  // Hide "no chat" message
    chatMessages.style.setProperty('display', 'block', 'important');  // Show chat messages
}

function checkCurrentFriendChat() {
    // Wait until a current friend chat is set
    if (currentChatFriend) {
        // Once currentChatFriend is set, hide "no chat" message, regardless of group ID
        const noChatMessage = document.getElementById('noChatSelected');
        const chatMessages = document.getElementById('chatMessages');

        // Log for debugging purposes


        // Hide "no chat" message and show chat messages
        noChatMessage.style.setProperty('display', 'none', 'important');  // Hide "no chat" message
        chatMessages.style.setProperty('display', 'block', 'important');  // Show chat messages
    } else {
        // Log for debugging purposes

    }

    return currentChatFriend;
}

// Example of how to use this function
// Call this periodically to check if currentChatFriend has been set
setInterval(() => {
    checkCurrentFriendChat();
}, 1000); // This will check every 1 second if a chat friend is set



// Check if there's a current group chat and hide "no chat" message if active
function checkCurrentGroupChat() {

    if (currentGroupId) {
        // Hide "no chat" message immediately if there's a group chat
        const noChatMessage = document.getElementById('noChatSelected');
        const chatMessages = document.getElementById('chatMessages');
        
        noChatMessage.style.setProperty('display', 'none', 'important');  // Hide "no chat" message
        chatMessages.style.setProperty('display', 'block', 'important');  // Show chat messages
    }

    return currentGroupId;
}


// Call this function when the app first loads
window.onload = function() {
    checkCurrentFriendChat(); // Initially check if there's any active chat
};

// Function to display the help modal
function showHelpModal() {
    const helpModal = document.getElementById('helpModal');
    helpModal.style.display = 'block';
}

// Function to close the help modal
function closeHelpModal() {
    const helpModal = document.getElementById('helpModal');
    helpModal.style.display = 'none';
}

// Function to dynamically update the chat header with group/friend name and avatar
function updateChatHeader(name, id, isGroup = false) {
    // Select the avatar container and the name span
    const avatarContainer = document.getElementById('avatarContainer');
    const chatWith = document.getElementById('chatWith');

    // Update the name in the chat header
    chatWith.innerHTML = name;

    // Clear the previous avatar content before adding a new one
    avatarContainer.innerHTML = '';

    // Create a new avatar element
    const avatarElement = document.createElement('div');
    avatarElement.classList.add('user-avatar');
    avatarElement.style.width = '40px';
    avatarElement.style.height = '40px';
    avatarElement.style.marginRight = '10px';
    avatarElement.style.display = 'inline-block';
    avatarElement.style.verticalAlign = 'middle';

    // Load avatar based on whether it's a group or a friend
    if (isGroup) {
        loadGCPicture(id, avatarElement); // Load group avatar
    } else {
        loadFriendProfilePicture(id, avatarElement); // Load friend avatar
    }

    // Append the new avatar to the container
    avatarContainer.appendChild(avatarElement);
}


</script>

<script>
    document.querySelector('.sidebar-toggle').addEventListener('click', () => {
        document.querySelector('.sidebar').classList.toggle('active');
    });
</script>

<script>
    // Get the button and the online friends container
    const hideButton = document.getElementById('hideButton');
    const onlineFriends = document.getElementById('onlineFriends');

    // Check the saved state in localStorage
    const isHidden = localStorage.getItem('onlineFriendsHidden');

    // Set the initial visibility based on the saved state
    if (isHidden === 'true') {
        onlineFriends.style.display = 'none';
    } else {
        onlineFriends.style.display = 'block';
    }

    // Toggle visibility when the button is clicked
    hideButton.onclick = function() {
        if (onlineFriends.style.display === 'none') {
            onlineFriends.style.display = 'block'; // Show the container
            localStorage.setItem('onlineFriendsHidden', 'false'); // Update the saved state
        } else {
            onlineFriends.style.display = 'none'; // Hide the container
            localStorage.setItem('onlineFriendsHidden', 'true'); // Update the saved state
        }
    };
</script>

<script>
    // Get the second hide button and the group list container
    const hideButton2 = document.getElementById('hideButton2');
    const groupList = document.getElementById('groupList');

    // Check the saved state in localStorage for the group list
    const isGroupListHidden = localStorage.getItem('groupListHidden');

    // Set the initial visibility based on the saved state
    if (isGroupListHidden === 'true') {
        groupList.style.display = 'none';
    } else {
        groupList.style.display = 'block';
    }

    // Toggle visibility when the hideButton2 is clicked
    hideButton2.onclick = function() {
        if (groupList.style.display === 'none') {
            groupList.style.display = 'block'; // Show the group list
            localStorage.setItem('groupListHidden', 'false'); // Update the saved state
        } else {
            groupList.style.display = 'none'; // Hide the group list
            localStorage.setItem('groupListHidden', 'true'); // Update the saved state
        }
    };
</script>


</body>
</html>
